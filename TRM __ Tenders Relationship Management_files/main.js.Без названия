openSubMenuElementCookieName = 'openSubMenuElement';

Bc.pageFilter = {
	toggleFilter: function (target) {
		$('a.tgls').toggle();
		$('.filter-block.show-labels, .filter-block.report-filter, .js-common-search-block').slideToggle();
		$(target).toggleClass('active');
	}
};

function showHideMenu(action){
	// $(".main").addClass("main_left-menu-opened");
	// console.log('main_left-menu-opened');
	// console.log($(".sidebar-menu-item.opened").hasClass('opened'));

	if (action == 'hide') {
		$('#menu, #content, #header').addClass('hide');
		Bc.Cookie.set('tcHideLeftSideMenu', 1, 1);
	} else {
		$('#content, #header, #menu').removeClass('hide');
		Bc.Cookie.set('tcHideLeftSideMenu', 0, 1);
	}
}

/**
 * @deprecated use www/js/general.js:globalLoader()
 */
function preloader(action) {
	globalLoader(action);
}

function resetFormFilters(target) {
	/*в поиск форм targer parent возвращает 0 найденных, где то мб используется... не знаю*/
	$(target).closest('form').find('input[type=text]:not([default]), textarea').each(function(){
		$(this).val('').trigger('change').trigger('input');

	});
	$(target).closest('form').find('input[type=checkbox]:not([default])').each(function(){
		if ($(this).prop('checked')){//избежать input
			$(this).prop('checked', false);
		}
	});

	/*$(target).closest('form').find('textarea').each(function(){
		$(this).text('').trigger('change');
	});*/
	//если это не вызвать - дерево не очиститься
	$(target).closest('form').find('.js-widget-FormElementTreeSelect:data(bcWidget):not([default])').each(function (i, el) {
		$(el).data('bcWidget')._selectAll(0);
	//	$(el).find('select-all[data-state=0]').trigger('click')
	});

	$(target).closest('form').find('input[type=checkbox][default], form input[type=checkbox][default]').each(function(){
		$(this).prop('checked',$(this).attr('default'));
	});
	//т.к. не используется с default из searchNew.php
	/*$('.js-widget-FormElementTreeSelect:data(bcWidget)[default]').each(function (i, el) {
		$(this).data('bcWidget')._setSubtreeSelection($(this).attr('default'), true);
	});*/

	$(target).closest('form').find('[data-widget=form\\/CompanyMultiPicker]').data('bcWidget').reset();
}

function format_num(num){
    var separator = " "; // разделитель
    strNum = num.toString();
    var strNew = strNum.substring(strNum.length);
    var countNum = 0;
    for (var i = strNum.length; i > 0; i--) {
        if ((countNum%3 == 0) && (i != strNum.length)) {
                strNew = separator + strNew;
        }
        strNew = strNum.charAt(i-1) + strNew;
        countNum ++;
    }
    return strNew;
}

$(document).ready(function() {

	if (localStorage.getItem('sidebarLeft') == "hide") {
		$(".mainwrapper").addClass("sbar-hidden");
		$("#content").addClass("menu-closed");
		$("#content").removeClass("menu-opened");
		$(document).trigger('Bc-contentResize');
	}

    Bc.WidgetManager.onPageLoad(function() {//иначе пробелы появляются в цене контракта новый поиск форм... если оставить " "
        $('input[data-mask-type=inn]').mask('999999999?999', {placeholder: ""},{placeholder: ""});
        $('input[data-mask-type=price]').mask('9?9999999999999999', {placeholder: ""});
        $('input[data-mask-type=number]').mask('9?9999999999999999', {placeholder: ""});
        $('input[data-mask-type=percent]').mask('9?99', {placeholder: ""});
    });

	//Деактивируем кнопку обратного звонка
	var phoneFastForm = $('#callback-form input#phone-fast-form').val();
	if (phoneFastForm != undefined && phoneFastForm.length > 0) {
		$('#callback-form .js-order-callback').attr('disabled', true);
	}

	// если телефон автоматически заполнен, то активируем обратно
	if ($('input[name="phone"]') != undefined && $('input[name="phone"]').val() != undefined && $('input[name="phone"]').val().length > 0) {
		$('#callback-form .js-order-callback').attr('disabled', false);
	}

	$('#callback-form input#phone-fast-form').keyup(function(){
		if ($('#callback-form input#phone-fast-form').val().length > 0) {
			$('#callback-form .js-order-callback').attr('disabled', false);
		}
	});

	$('form').submit(function () {
		$('div.bottom_blue_ws_informer').remove();
		preloader('show');
	});

	$('.js-do-reset-current-form').click(function() {
		resetFormFilters(this);
	});

	$('.js-do-reset-ticket-form').click(function() {
		resetFormFilters(this);
		$(this).closest('form').find('#status_id').data('bcWidget').setValue(jQuery.parseJSON($('#default_status_id').val()));
	});

	var wd_scroll;

	$('.bottom-menu-toggle .min-logo').click(function(){
		if($('#menu').hasClass("hide")){
			$('#menu').removeClass('hide');
		}
	});
	//var scrols = $(window).height();
	//$('.menu.fulls').height(scrols-180);
	$(window).scroll(function() {
		if($('#menu.hide').hasClass("hide")){
			wd_scroll = 60;
		} else {
			wd_scroll = 295;
		}
	});

	if(Bc_tip_page_type == 'index-index') {
		$('#header').addClass('black_edition');
	}


	$('.infoblock.client-data .tabs.subform-list-phones .item.item-phones, .infoblock.client-data .tabs.subform-list-emails .item.item-emails, .infoblock.client-data .tabs.subform-list-websites .item.item-websites').addClass('group');

	if(Bc_tip_page_type == 'analytics-calculate') {
		$('.region-filter-checkbox').addClass('group');
		$('.region-filter-checkbox .control-group, .control-group.field-name-additionalFieldsSwitcherHtml, .layout-zone.button-zone .control-group.field-name-submit.field-type-submit, .form-buttons-block a.form-btn-toggle, .form-buttons-block a.form-btn-create-new-report, .analytics-form a.show-report-sample, .form-buttons-block a.form-btn-refresh, .analytics button.print-i, .analytics button.xls-i').addClass('helps-visual');
		$('.region-filter-checkbox .control-group.field-name-regionNestedLvl2').append('<i class="help-in-show">Отметив «галочкой» поле,<br> вы получите результаты только по субъектам. </i>');
		$('.region-filter-checkbox .control-group.field-name-regionNestedLvl3').append('<i class="help-in-show">Отчет будет сформирован по всем<br> населенным пунктам (городам, деревням)</i>');
		$('.layout-zone.button-zone .control-group.field-name-additionalFieldsSwitcherHtml').append(
		'<i class="help-in-show">Разверните дополнительные поля фильтра</i>');
		$('.layout-zone.button-zone .control-group.field-name-submit.field-type-submit').append(
		'<i class="help-in-show">Когда вы заполнили фильтр, нажмите на кнопку.<br> Ваш сформированный отчет появится в разделе «Мои отчеты»</i>');
		$('.form-buttons-block a.form-btn-toggle').append('<i class="help-in-show">Хотите изменить отчет?<br> Внесите изменения в фильтр<br> и сформируйте отчет.</i>');
		$('.analytics-form a.show-report-sample').append('<i class="help-in-show">Посмотрите пример отчета</i>');
		$('.form-buttons-block a.form-btn-create-new-report').append('<i class="help-in-show">На основе настроек этого отчета<br> вы можете создать новый отчет.</i>');
		$('.form-buttons-block a.form-btn-refresh').append('<i class="help-in-show">Если вам нужен этот отчет, но с обновленными данными,<br> нажмите на кнопку «Обновить отчет».</i>');
		$('.analytics button.print-i').append('<i class="help-in-show">Распечатайте отчет</i>');
		$('.analytics button.xls-i').append('<i class="help-in-show">Выгрузите его в таблицу в формате excel</i>');
	}
	if(Bc_tip_page_type == 'settings-index'){
		$('.subform-list-phones .add-button-group, .subform-list-emails .add-button-group, .subform-list-websites .add-button-group, .subform-list-emails .item.item-emails.email_item_primary, .infoblock.client-data .submit-block, .infoblock.client-data .control-group.field-name-password, .infoblock.client-data.admin-block .subform.field-name-employee .control-group.field-name-employee_id, .infoblock.notice-block table tbody tr:nth-of-type(1) td:nth-of-type(2), .infoblock.notice-block table tbody tr:nth-of-type(1) td:nth-of-type(3)').addClass('helps-visual');
		$('.subform-list-phones .add-button-group').append('<i class="help-in-show">Можно добавить номер телефона</i>');
		$('.subform-list-emails .add-button-group').append('<i class="help-in-show">Добавьте e-mail , если у вас несколько важных адресов.</i>');
		$('.subform-list-websites .add-button-group').append('<i class="help-in-show">Добавьте сайт организации,<br> если их у вас несколько. </i>');
		$('.subform-list-emails .item.item-emails.email_item_primary .item-control-block').append('<i class="help-in-show">Наведите курсор на поле с адресом и кликните на кнопку, если хотите сделать этот адрес основным<br> и получать на него письма и уведомления от системы TRM.<br> Или если хотите этот адрес удалить.</i>');
		$('.infoblock.client-data.employee-date .submit-block').append('<i class="help-in-show">Сохраните все изменения, нажав на кнопку.</i>');
		$('.infoblock.client-data .control-group.field-name-password .labels').append('<i class="help-in-show">Здесь можно изменить пароль</i>');
		$('.infoblock.client-data.admin-block .subform.field-name-employee .control-group.field-name-employee_id .controls').append('<i class="help-in-show">Выберите из списка имя сотрудника,<br> которого хотите назначить руководителем.</i>');
		$('.infoblock.client-data.admin-block .submit-block').append('<i class="help-in-show">Сохраните изменения. </i>');
		$('.infoblock.notice-block table tbody tr:nth-of-type(1) td:nth-of-type(2) .checkbox').append('<i class="help-in-show">Отметив событие в колонке «Лента событий»,<br> вы будете видеть новые события<br> на главной странице TRM<br> ежедневно, при первом входе в систему. </i>');
		$('.infoblock.notice-block table tbody tr:nth-of-type(1) td:nth-of-type(3) .checkbox').append('<i class="help-in-show">Уведомление о событии будет приходить<br> на вашу электронную почту.</i>')
	}
	$('.js-toggle-filter').click(function(){
		Bc.pageFilter.toggleFilter(this);
		return false;
	});

	$('.select-analytics-report .selected-report .selecteds').click(function(e) {
		$('.select-analytics-report .selected-report .selecteds i').toggleClass('active');
		$('.select-analytics-report .selected-report ul').slideToggle();
		var firstClick = true;
		$(document).bind('click.myEvent', function(e) {
			if (!firstClick && $(e.target).closest('.select-analytics-report').length == 0) {
				$('.select-analytics-report .selected-report .selecteds i').removeClass('active');
				$('.select-analytics-report .selected-report ul').slideUp();
				$(document).unbind('click.myEvent');
			}
			firstClick = false;
		});
		e.preventDefault();
	});

	$('.analitica-maps .select-year span').click(function(){
		$('.analitica-maps .select-year span').toggleClass('active');
		$('.analitica-maps .select-year ul').slideToggle();
	});

	$('.analytics-form .show-report-sample').click(function(){
        $(document).trigger('Bc-contentResize', [this]);

		$(this).hide();
		setTimeout(function () {
			$(".floatThead-wrapper").mCustomScrollbar({
			axis:"x",
			scrollButtons:{
				enable:true,
				scrollType:"stepless",
				scrollAmount:"auto"
			}
			});
	   }, 200);
	});

	$('.middle-analytics .hide-report-sample').click(function(){
		$('.analytics-form .show-report-sample').show();
	});

	$('.infoblock #searchform .button-zone a.additional-fields-toggler.right').click(function(e) {
	   e.preventDefault();
       var $this = $(this);
       var $currentText = $this.text();

       $this.text($this.attr('data-text'));
       $this.attr('data-text', $currentText);
	});

	// Основной метод печати страницы
	// При печати страницы боковое меню скрывается, но 0-й отступ контента не применяется
	// media="print" + print.css не в помощь этому
	$('.js-do-print').click(function(){
		let ua = navigator.userAgent.toLowerCase();
		let isAndroid = ua.indexOf("android") > -1; //&& ua.indexOf("mobile");
		if (isAndroid) {
			// https://developers.google.com/cloud-print/docs/gadget
			var gadget = new cloudprint.Gadget();
			gadget.setPrintDocument("url", $('title').html(), window.location.href, "utf-8");
			gadget.openPrintDialog();
		} else {
			window.print();
		}
		return false;
	});
	var wd = $(window).width();

	if(wd < 1025){
		$('#menu, #content, #header').addClass('hide');
		$('.min-logo').click(function(e) {
			$('#menu, #header').removeClass('hide');
			$('#menu, #header').addClass('mobile');
			$('.hide-open-menu').show();
			$('#menu').addClass('mob-menu');
			$('.logo').addClass('hide');
			var firstClick = true;
			$(document).bind('click.myEvent', function(e) {
				if (!firstClick && $(e.target).closest('#menu').length == 0) {
					$('#menu, #header').addClass('hide');
					$('#menu, #header').removeClass('mobile');
					$('.hide-open-menu').hide();
					$('.logo').removeClass('hide');
					$('#menu').addClass('mob-menu');
					$(document).unbind('click.myEvent');
				}
				firstClick = false;
			});
			e.preventDefault();
		});
	}

	$('.hide-open-menu').click(function(){
		showHideMenu('hide');

	});
	$('.min-logo').click(function(){
		showHideMenu('show');
	});


    $(".toggle-button").click(function(e){
      	$(".right_column").toggleClass("views");
       	var firstClick2 = true;
        $(document).bind('click.myEvent2', function(e) {
			if (!firstClick2 && $(e.target).closest('.right_column').length == 0) {
				$(".right_column").toggleClass("views");
				$(document).unbind('click.myEvent2');
			}
        	firstClick2 = false;
        });
    	e.preventDefault();
  	});

    $('.message-box .close').click(function(){
        $('.message-box').fadeOut(500);
    });

	$(".tab-block.full").show();
	$(".tab-block, .tab-group.grafick").hide();
	$(".tab-block.full").show();
	$('.settings .full ul li:first').removeClass("active");
	//И никогда так не делать \/
	//$(".tabs-group ul li:first, .group-btn ul li:first, .grafick-tabs li:first").addClass("active").show();
	$(".tab-block:first, .tab-group.grafick:first").show();

	$(".grafick-tabs li").click(function(){
		$(".grafick-tabs li").removeClass("active");
		$(".tab-group.grafick").hide();
		var activeTab = $(this).find("a").attr("href");
		$(activeTab).fadeIn();
		return false;
 	});

	$(".group-btns ul li").click(function(){
		$(".group-btns ul li").removeClass("active");
		$(this).addClass("active");
		$(".all-items").hide();
		$(".tab-block").hide();
		var activeTab = $(this).find("a").attr("href");
		$(activeTab).fadeIn();
		return false;
	});

    $('.default.history').parents('.infoblock').addClass('history-dev');

	//ЗАГРУЗКА ФАЙЛА СТРАНИЦА НАСТРОЙКИ
    $('#photoLoaded').parents('.control-group').addClass('files');
    $('#loadFileSupport').parents('.control-group').addClass('files');

    $('.field-name-photoLoaded .controls').append('<label class="file_upload"><mark>Выберите файл</mark></label>');
    $('.field-name-loadFileSupport .controls').append('<label class="file_upload"><span>Прикрепить скриншот</span><mark>Файл не выбран.</mark><i>Изображение JPEG, PNG, GIF размером до 500кб</i></label>');
	$('#photoLoaded').appendTo('.file_upload');
	$('#loadFileSupport').appendTo('.file_upload');
	//ЗАГРУЗКА ФАЙЛА СТРАНИЦА НАСТРОЙКИ

	$(document).on('click', 'table.new-events td.date_view', function(ev){
		if (!$(ev.target).is('a')) {
			var description = $(this).parents('.js-show-alert-message').data('alert-description');
			var title = $(this).data('alert-title');

			if (description.length == 0) {
				description = title;
			}
		} else {
			$(ev.target).attr('target', '_blank');
		}
	});

	$(document).on('click', '.informer-full-message .ui-widget-content a, #informer-list .informer-msg a', function () {
		$(this).attr('target', '_blank');
	});

	/*scrolbar*/
	$(".popup_bico:not(.tc-page-statistic-index) .horizontal, .infoblock.analytics .middle-analytics .floatThead-wrapper").mCustomScrollbar({
		axis:"x",
		mouseWheel:{
			enable:false,
			scrollAmount:"auto",
			axis:"x",
			preventDefault:false,
			deltaFactor:"auto",
			normalizeDelta:false,
			invert:false,
			disableOver:["table"]
		},
		scrollButtons:{
			enable:true,
			scrollType:"stepless",
			scrollAmount:"auto"
		}
	});

    /* Скролл на странице рассылок */
	$(".tc-page-subscribe-list .horizontal-custom-scroll").mCustomScrollbar({
        axis:"x",
        mouseWheel:{
            enable:false,
            scrollAmount:"auto",
            axis:"x",
            preventDefault:false,
            deltaFactor:"auto",
            normalizeDelta:false,
            invert:false,
            disableOver:["table"]
        },
        scrollButtons:{
            enable:true,
            scrollType:"stepless",
            scrollAmount:"auto"
        }
	});

	/* all available option parameters with their default values */

	$(".vertical,#callback-form").mCustomScrollbar({
		setWidth:false,
		setHeight:false,
		setTop:0,
		setLeft:0,
		axis:"y",
		scrollbarPosition:"inside",
		scrollInertia:950,
		autoDraggerLength:true,
		autoHideScrollbar:false,
		autoExpandScrollbar:false,
		alwaysShowScrollbar:0,
		snapAmount:null,
		snapOffset:0,
		mouseWheel:{
			enable:true,
			scrollAmount:"auto",
			axis:"y",
			preventDefault:false,
			deltaFactor:"auto",
			normalizeDelta:false,
			invert:false,
			disableOver:["select","option","keygen","datalist","textarea"]
		},
		scrollButtons:{
			enable:true,
			scrollType:"stepless",
			scrollAmount:"auto"
		},
		keyboard:{
			enable:true,
			scrollType:"stepless",
			scrollAmount:"auto"
		},
		contentTouchScroll:25,
		advanced:{
			autoExpandHorizontalScroll:false,
			autoScrollOnFocus:"input,textarea,select,button,datalist,keygen,a[tabindex],area,object,[contenteditable='true']",
			updateOnContentResize:true,
			updateOnImageLoad:true,
			updateOnSelectorChange:false,
			releaseDraggableSelectors:false
		},
		theme:"light",
		callbacks:{
			onInit:false,
			onScrollStart:false,
			onScroll:false,
			onTotalScroll:false,
			onTotalScrollBack:false,
			whileScrolling:false,
			onTotalScrollOffset:0,
			onTotalScrollBackOffset:0,
			alwaysTriggerOffsets:true,
			onOverflowY:false,
			onOverflowX:false,
			onOverflowYNone:false,
			onOverflowXNone:false
		},
		live:false,
		liveSelector:null
	});

}, 30);

function setScrollWidth(parentElem, $scrollElem) {
    var scrollWidth = parentElem.offsetWidth;
    $scrollElem.css('width', scrollWidth);
}

// @TODO Переписать потом так, чтобы на вход fixedScroll принимал обертку/таблицу, а не внутри себя искал
function fixedScroll() {
	var scroll = $('.mCSB_scrollTools.mCSB_scrollTools_horizontal');
    var windowScrollTop = $(window).scrollTop();
    var windowHeight = $(window).height();
	/*12503 Короче тут гвоздь в виде класса _mCS_3 для отчетов аналитики, потому что кастомный скролл не хочет работать с несколькими таблицами на странице. */
    var tableWrapper = document.querySelector('.horizontal') || document.querySelector('.infoblock.analitic-info .floatThead-wrapper') || document.querySelector('.infoblock.analytics ._mCS_3');
    if (!tableWrapper) {
    	return;
    }
    var tableWrapperWidth = tableWrapper.offsetWidth;
    var tableWrapperHeight = tableWrapper.offsetHeight;
    var tableWrapperTop = tableWrapper.getBoundingClientRect().top + -($(".main").get(0).getBoundingClientRect().top);
    var scrollHeight = scroll.height();

    if((tableWrapperHeight + scrollHeight + tableWrapperTop) > (windowScrollTop + windowHeight)) {
        scroll.stop().addClass('fix-scroll');
    }

    scroll.css('width', tableWrapperWidth);
    scroll.css('right', $(window).width() - tableWrapper.getBoundingClientRect().right);

    $(window).scroll(function() {
        windowScrollTop = $(window).scrollTop();

        if ((tableWrapperHeight + scrollHeight + tableWrapperTop) > (windowScrollTop + windowHeight)) {
            scroll.stop().addClass('fix-scroll');
        } else {
            scroll.stop().removeClass('fix-scroll');
        }
    });

    $(window).resize(function() {
        windowHeight = $(window).height();
        setScrollWidth(tableWrapper, scroll);
    });

    $(document).on('Bc-contentResize', function () {
        setScrollWidth(tableWrapper, scroll);
    });
}

// @TODO отрефакторить
$(window).load(function () {

	if($('.destination').length>0){
		$(function() {
			var h = $(window).height();
			var o = $(".infoblock.stt").height();
			var hf = $(".infoblock.stt .destination").height();

			if(h<o){
				$(".infoblock.stt .destination").removeClass('no-padding');
				$(".infoblock.stt .destination").addClass('no-before');
			}

			var hr_width1 = $('#container .cols.col-12').width();
			$(".infoblock.stt .destination").stop().css({"position":"fixed"});

			let scrollHandler = function() {
				hr_width1 = $('.infoblock.stt').width();
				var s = $(window).scrollTop();
				if ((s + h) < (o + hf)) {
					$(".infoblock.stt .destination").removeClass('no-padding');
					$(".infoblock.stt .destination").addClass('no-before');
					$(".infoblock.stt .destination").stop().css({"position":"fixed"});
				} else {
					$(".infoblock.stt .destination").addClass('no-padding');
					$(".infoblock.stt .destination").removeClass('no-before');
					$(".infoblock.stt .destination").stop().css({"position":"relative"});
				}
			};

			$(window).scroll(scrollHandler);

			$('.tenderCard__tabs li.hvr-rectangle-out').click(function() {
				setTimeout(function () {
					h = $(window).height();
					o = $(".infoblock.stt").height();
					hf = $(".infoblock.stt .destination").height();

					scrollHandler();
				}, 1);
			});
		});
	}

	$('.analytics-form .show-report-sample').click(function(){
		$(this).hide();
		setTimeout(function () {
			$(".floatThead-wrapper").mCustomScrollbar({
				axis:"x",
				mouseWheel:{
					enable:false,
					scrollAmount:"auto",
					axis:"x",
					preventDefault:false,
					deltaFactor:"auto",
					normalizeDelta:false,
					invert:false,
					disableOver:["table"]
				},
				scrollButtons:{
					enable:true,
					scrollType:"stepless",
					scrollAmount:"auto"
				}
			});

			if($('.floatThead-wrapper').length>0) {
				var hr_width = $('.floatThead-wrapper').width();
				$('.mCSB_scrollTools.mCSB_scrollTools_horizontal').width(hr_width);
				$('.mCSB_scrollTools.mCSB_scrollTools_horizontal').css({
					'position':'fixed',
					'left':'auto',
					'right':'auto',
					'z-index':'999'
				});
			}
	    }, 1100);
	});

	$(".infoblock.analytics .floatThead-wrapper").mCustomScrollbar({
			axis:"x",
			mouseWheel:{
				enable:false,
				scrollAmount:"auto",
				axis:"x",
				preventDefault:false,
				deltaFactor:"auto",
				normalizeDelta:false,
				invert:false,
				disableOver:["table"]
			},
			scrollButtons:{
				enable:true,
				scrollType:"stepless",
				scrollAmount:"auto"
			}
	});

	var maxheight = 0;
	$("body").each(function () {
		if ($(this).height() > maxheight) {
			maxheight = $(this).height();
		}
	});

	//$("div.callback-wrap").height(maxheight);

    //прижимаем скролл к низу экрана
    var ffd = document.getElementById('scr-block');

    if(ffd){
    	var tip_topper = $("table.default.application tbody tr");
    	var hr_width = $('.horizontal').width();

		if(tip_topper.length > 5){
			tip_topper.eq(-2).addClass('last');
			tip_topper.eq(-3).addClass('last');
			tip_topper.eq(-1).addClass('last');
			tip_topper.eq(-4).addClass('last');
			tip_topper.eq(-5).addClass('last');
		} else if(tip_topper.length > 4) {
			tip_topper.eq(-2).addClass('last');
			tip_topper.eq(-3).addClass('last');
			tip_topper.eq(-1).addClass('last');
			tip_topper.eq(-4).addClass('last');

		} else if(tip_topper.length >= 3) {
			tip_topper.eq(-2).addClass('last');
			tip_topper.eq(-1).addClass('last');
		} else if(tip_topper.length >= 2) {
			tip_topper.eq(-1).addClass('last');
		} else if(tip_topper.length >= 1) {
			tip_topper.eq(-1).addClass('last');
		}
    }
	var tips =$('.infoblock.favorite-page .default.favorit tbody tr');

	if(('.infoblock.favorite-page .default.favorit').length > 0) {
    	var tips =$('.infoblock.favorite-page .default.favorit tbody tr');
    	var hr_width = $('.horizontal').width();

		if(tips.length > 5){
			tips.eq(-2).addClass('last');
			tips.eq(-3).addClass('last');
			tips.eq(-1).addClass('last');
			tips.eq(-4).addClass('last');
			tips.eq(-5).addClass('last');
		} else if(tips.length > 4) {
			tips.eq(-2).addClass('last');
			tips.eq(-3).addClass('last');
			tips.eq(-1).addClass('last');
			tips.eq(-4).addClass('last');
		} else if(tips.length >= 3) {
			tips.eq(-2).addClass('last');
			tips.eq(-1).addClass('last');
		} else if(tips.length >= 2) {
			tips.eq(-1).addClass('last');
		} else if(tips.length >= 1) {
			tips.eq(-1).addClass('last');
		}
	}

	if($('.horizontal ').length > 0 && !($('.popup_bico').hasClass('tc-page-statistic-index'))) {
		$(fixedScroll);
	}

    $(document).on('Bc-statistics-page-inited', function () {
        $(fixedScroll);
    });

	$('.paginator-button-more').click(function(){
		setTimeout(function() {
			$(fixedScroll);
		}, 2000);
	});

    $(document).on('Bc-floating-head-inited', function () {
        $(".infoblock.analitic-info .floatThead-wrapper").mCustomScrollbar({
			axis:"x",
			mouseWheel:{
				enable:false,
				scrollAmount:"auto",
				axis:"x",
				preventDefault:false,
				deltaFactor:"auto",
				normalizeDelta:false,
				invert:false,
				disableOver:["table"]
			},
			scrollButtons:{
				enable:true,
				scrollType:"stepless",
				scrollAmount:"auto"
			}
        });

        $(fixedScroll);
    });
});

//стилизация input type="file"
$(function(){
    var wrapper = $( ".file_upload" ),
        inp = wrapper.find( "input" ),
        btn = wrapper.find( ".buttons" ),
        lbl = wrapper.find( "mark" );

    // Crutches for the :focus style:
    inp.focus(function(){
        wrapper.addClass( "focus" );
    }).blur(function(){
        wrapper.removeClass( "focus" );
    });

    var file_api = ( window.File && window.FileReader && window.FileList && window.Blob ) ? true : false;

    inp.change(function(){
        var file_name;
        if( file_api && inp[ 0 ].files[ 0 ] )
            file_name = inp[ 0 ].files[ 0 ].name;
        else
            file_name = inp.val().replace( "C:\\fakepath\\", '' );

        if( ! file_name.length )
            return;

        if( lbl.is( ":visible" ) ){
            lbl.text( file_name );
            btn.text( "Выбрать" );
        }else
            btn.text( file_name );
    }).change();

});
$( window ).resize(function(){
    $( ".file_upload input" ).triggerHandler( "change" );
});

$(function() {
	// для аналитики 15 сек для закрытия зеленого информера
	var path = window.location.pathname, substring = "analytics";
	var timeToReload = 0;
	if (path.indexOf(substring) > -1) {
		timeToReload = 15000;
	} else {
		timeToReload = 7000;
	}
	//TODO отключили исчезновение информеров
	//setTimeout(closeInformer, timeToReload);

	// закрываем информационные окна автоматически
	function closeInformer() {
		$('div.error-block').slideUp('fast');
	}

	//connectInformerSocket();
	$('div.bottom_blue_ws_informer').fadeOut();
	$('span.bottom_blue_ws_informer_close').click(function(){
		$('div.bottom_blue_ws_informer').fadeOut('slow');
	});
});

function connectInformerSocket() {
	if (window.Bc_isDevMode) return;

	var wsProtocol = 'ws';
	if (window.location.protocol == "https:") {
		wsProtocol = 'wss';
	}

	var ws = new WebSocket(wsProtocol+'://31.44.81.122:55888');
	ws.onopen = function () {
		// subscribe to some channels
		// console.log('socket open!');
	};

	ws.onmessage = function (e) {
		//$('div.bottom_blue_ws_informer').hide('fast');
		var wsData = $.parseJSON(e.data);
		var empId = wsData['to'];
		var val = wsData['value'];

		if (empId == $('input#employee_id_ws_value').val() && val != '' && val != null) {
			$('div.bottom_blue_ws_informer_container').html(val);
			$('div.bottom_blue_ws_informer').fadeIn('fast');
			setTimeout(function(){$('div.bottom_blue_ws_informer').fadeOut('slow')},10000);

			var $evTab = $('table.new-events').get(0); // проверка на существование таблицы событий
			if ($evTab !== undefined) {
				// вставим новое событие с анимацией
				$('<tr data-informer-type="ticketEnd" class="js-show-alert-message">' +
						'<td><p>Сейчас</p></td>' +
						'<td class="planing"><div class="new_adv">'+val+'</div></td>' +

						'</tr>').hide().prependTo('table.new-events > tbody').fadeIn('slow');
				var $i = 1;
				$('table.new-events > tbody td.numeric').each(function(){
					$(this).html($i);
					$i++;
				});
				// увеличим счетчик событий на один
				var countAllEvents = $('.js-show-alert-message').length;
				countAllEvents = countAllEvents ? countAllEvents + 1 : 1;
				$('li[counter-type="allEvents"] .odometer').html(countAllEvents);
			}
		}
	};

	ws.onclose = function (e) {
		// console.log('Socket is closed. Reconnect will be attempted in 1 second.', e.reason);
		setTimeout(function () {
			connectInformerSocket();
		}, 1000)
	};

	ws.onerror = function (err) {
		//console.error('Socket encountered error: ', err.message, 'Closing socket');
		ws.close()
	};
}

$(document).ready(function(){
	$('.video_zaglushka').click(function(e) {
		$('.tip-block').removeClass('hidden');
		$('.tip-block').show();
		var video = $(this).parents('.video_container').data('type-video');
		$('.video-wrap-container[data-show-video='+video+']').fadeIn(500);

		var firstClick = true;
		$(document).bind('click.myEvent', function(e) {
			if (!firstClick && !e.target.classList.contains('video-wrap-container')) {
				$('.tip-block').hide();
				$('.video-wrap-container[data-show-video='+video+']').fadeOut(100, function() {
					var html = $('.video-wrap-container[data-show-video='+video+']').html();
					$('.video-wrap-container[data-show-video='+video+']').html("");
					$('.video-wrap-container[data-show-video='+video+']').html(html);
				});
				$(document).unbind('click.myEvent');
			}
			firstClick = false;
		});
		e.preventDefault();
	});
});

$(function(){

	// если документ был удален, то деактивируем ссылку
	$('a.add_doc_informer_link').hover(function(){
		var docId = $(this).attr('docId');
		var a = $(this);
		var fileName = a.html();
		$.ajax({
			type: 'POST',
			url: '/tc/document/ajax-check-exist-doc/',
			data: {document_id : docId},
			success: function (response) {
				// если документ удалён
				if (response.data.status == 1) {
					a.removeClass('add_doc_informer_link');
					a.replaceWith('<span title="Файл удалён" style="color:#ccc; text-decoration: line-through;">'+fileName+'</span>');
				}
			}
		});
	});

	if (!window.Bc_isDevMode) {
		/*cometApi.start({
			// node: "192.168.56.1:8087",
			node: "ws.bicotender.ru",
			// wss: true,
			dev_id: 0,
			user_id: window.Bc_employee_id,
			user_key: window.Bc_employeeCometUserKey
		});

		cometApi.subscription("tcPopupInformer.newMessage", function (e) {
			Bc.Informer.showNewNewsPopup(e.data);
		});

		cometApi.subscription("system.ping", function (e) {});

		$.ajax({
			type: 'POST',
			url: '/tc/news/ajax-get-popup-data-for-last-item/',
			success: function (response) {

				if (response && response.bc_ajax_data && response.bc_ajax_data.status == 'ok') {
					Bc.Informer.showNewNewsPopup(response.bc_ajax_data.popupConfig);
				}
		});
			}*/
	}

});

$(document).ready(function(){
	// после загрузки страницы вызываем функцию
	// обрезание с остветлением
	// cutLongString($('.new_event .title_event'), 200, true);
	// обрезание без остветления
	// cutLongString($('.new_event .title_event'), 75, false);
});

/**
 * Функция для сокращения длинного текста
 * @var object element - элемент, в котром необходимо укоротить текст
 * @var int count_lit - лимит символов
 * @var bool light - true|false задать осветление последних символов или нет
 */
function cutLongString(element, count_lit, light){
	// текст в блоке
	var text = element.html();
	// длина текста в блоке
	var all_len = text.length;
	// хранилище для нового текста
	var new_text;

	// если текст больше заданного лилмита, то обрезаем его
	if (all_len > count_lit){
		// обрезаем текст и добавляем три точки в конец
		new_text = text.substr(0, (count_lit - 3)) + '...';
		// если необходимо задать осветление последним символам
		if(light){
			// кусок обычного текста
			var first_part_text = new_text.substr(0, (count_lit - 10));
			// кусок текста, который будет осветлен
			var light_part_text = new_text.substr((count_lit - 10), count_lit);
			// переменная, для хранения осветленного текста
			var light_text = "";
			// цвета для последний 10 символов
			var array_color = ["#d4d4d4", "#c4c4c4", "#b4b4b4", "#a4a4a4", "#949494", "#848484", "#747474", "#646464", "#545454", "#444444"];
			// перебираем по одному символу текст, который будет осветлен
			for(var i = 0; i < 10; i ++){
				// оборачиваем каждый символ в span и задаем ему цвет
				light_text += "<span style='color: " + array_color[i] + "'>" + light_part_text.substr(i, 1) + "</span>";
			}
			// склеиваем две части текста
			new_text = first_part_text + light_text;
		}
		// заменяем текст в блоке
		element.html(new_text);
	}
}

// Новый дизайн ЛК
$(document).ready(function() {
	var controlWidth = 980;
	var prevDocumentWidth = window.innerWidth;
	var isSideBarFirstTimeHide = false;

	if (prevDocumentWidth < controlWidth) {
		$(".mainwrapper").addClass("sbar-hidden");
		$("#content").addClass("menu-closed");
		$("#content").removeClass("menu-opened");
        localStorage.setItem('sidebarLeft', 'hide');
	}

	$(".sidebar-account__product-main").click(function(){
		$(this).find(".sidebar-account__product-main-arr").toggleClass("open");
		$(".sidebar-account__product-list").slideToggle();
	});
	if ($(".sidebar-menu-item").hasClass("opened")) {
		$(".sidebar-menu-item.opened").find(".sidebar-menu__item-list").show();
	}
	$(".sidebar-menu-item").click(function(e) {
		if (!$(e.target).parent().hasClass("sidebar-menu__item-list-item") ) {
			var menu_item = $(this);
			if (menu_item.hasClass("opened")) {
				menu_item.removeClass("opened");
				menu_item.find(".sidebar-menu__item-list").slideUp();
			} else {
				menu_item.addClass("opened");
				menu_item.find(".sidebar-menu__item-list").slideDown();
			}
		}
	});
	var sidebar_account_height = $(".sidebar-account").height();
	$(window).scroll(function(){
		var sidebarmenu_height = $(".sidebar-menu").height(),
			container_height = $("#container").height();
		if (($(window).scrollTop() >= sidebar_account_height) && ($("body").width() > 779) && (container_height > sidebarmenu_height)) {
			$('.sidebar-menu').addClass('fixed');
		}
		else {
			$('.sidebar-menu').removeClass('fixed');
		}
	});

	$(".sidebar-hide").click(function() {
		$(".mainwrapper").toggleClass("sbar-hidden");
		$("#content").toggleClass("menu-closed");
		$("#content").toggleClass("menu-opened");
		if ($(".mainwrapper").hasClass("sbar-hidden")) {
			localStorage.setItem('sidebarLeft', 'hide');
			var LeftinformerRedesign = "120px";
		} else {
			localStorage.removeItem("sidebarLeft");
			var LeftinformerRedesign = "370px";
		}
		var widthContent = $("#container").width();
		$(".widget-informer-newDesign").width(widthContent).css({"left":LeftinformerRedesign});

        $(document).trigger('Bc-contentResize', [this]);
	});

	$('.sidebar_hide').toggle("fast",function(){
		$('.sidebar__main').css('display','none');
	});

	$('.menu-wrapper').on('click', function() {
		$('div.mobile-menu-wrapper').slideToggle('fast');
        $('div.menu-wrapper').toggleClass('opened');
	});

	$('.manager-callback-btn-mobile').on('click', function() {
		$('form.js-callback-form-mobile').slideToggle('slow');
	});

	var checkSbar = localStorage.getItem('sidebarLeft');

	$(".h-panel-sf-input").keyup(function(){
		if ($(this).val().length > 2) $(".heading-panel-searchform").addClass("active");
		else $(".heading-panel-searchform").removeClass("active");
	});

	function arbitr_scroll_fix(){
		if ($(window).width() < 1025) {
			$(".arbitrage_table_wrapper").each(function() {
				$(this).mCustomScrollbar({
					axis: "x",
					scrollButtons: {
						enable: true,
						scrollType: "stepless",
						scrollAmount: "auto"
					},
					theme: "dark"
				});
			});
		}
	}

	arbitr_scroll_fix();

	$(window).resize(function(){
		arbitr_scroll_fix();

		var currentDocumentWidth = window.innerWidth,
			isWindowExpanded = currentDocumentWidth > prevDocumentWidth,
			isWindowNarrowed = currentDocumentWidth < prevDocumentWidth,
			isSidebarHidden = localStorage.getItem('sidebarLeft') === 'hide',
			isSidebarVisible = !isSidebarHidden;


		if (!isSideBarFirstTimeHide && (isWindowNarrowed) && (currentDocumentWidth <= controlWidth) && isSidebarVisible) {
            isSideBarFirstTimeHide = true;
            $(".mainwrapper").addClass("sbar-hidden");
			$("#content").addClass("menu-closed");
			$("#content").removeClass("menu-opened");
            localStorage.setItem('sidebarLeft', 'hide');
		}

        if ((isWindowExpanded) && (currentDocumentWidth > controlWidth)) {
            isSideBarFirstTimeHide = false;
            $(".mainwrapper").removeClass("sbar-hidden");
			$("#content").removeClass("menu-closed");
			$("#content").addClass("menu-opened");
			localStorage.removeItem('sidebarLeft');
        }

        prevDocumentWidth = currentDocumentWidth;
	});

	var checkToggleStatusHelper = function() {
		this.getStatusFromLS();
	};

	checkToggleStatusHelper.prototype = {
		saveStatusInLS: function(status) {
			if(status == undefined) {
				status = this.headerToggleStatus
			}
			localStorage.setItem("hts", status);
		},
		changeStatus: function() {
			if(this.headerToggleStatus == 0) {
				this.headerToggleStatus = 1;
			}else{
				this.headerToggleStatus = 0;
			}
			this.saveStatusInLS();
		},
		getStatusFromLS: function() {
			var headerToggleStatus = localStorage.getItem("hts");
			if(headerToggleStatus === null) {
				this.saveStatusInLS(0);
				this.getStatusFromLS();
			}else{
				this.headerToggleStatus = parseInt(headerToggleStatus);
			}
		}
	};

	var toggleHelper =  new checkToggleStatusHelper();

	//необходимо для интеграции между старой и новой версии поисковой формы #11805 (шапка min max)
	try{
		if(toggleHelper.headerToggleStatus === 1 && !Bc_isNewSearchTender) {
			$("#header").addClass("min");
		}

		$(".toggle-header").on("click", function() {
			if (!Bc_isNewSearchTender){
				$("#header").toggleClass("min");
				toggleHelper.changeStatus();
			}
		});
	}catch(e){

	}
	$('body').on('change', '.video_tabs_block input,.news_tabs_block input', function(e){
		console.log('checked');
		console.log($(this).attr('id'));
		$(this).parents('section').find('label[for="'+$(this).attr('id')+'"]').trigger('click');
	});
});

/**
 * JavaScript API for comet-server.com
 * I will be glad to new orders for something a development.
 *
 * Version 4.02 
 *
 *
 * @author Trapenok Victor, Levhav@ya.ru, 89244269357
 *
 * Levhav@ya.ru
 * Skype:Levhav
 * 89244269357
 * @link http://comet-server.com
 *
 * (҂`_´)
 * <,︻╦╤─ ҉ - - - - - - --
 * _/﹋\_
 *
 */

if( !window._tabSignal)
{
    var _tabSignal = function(opt)
    {
        this.slotArray = new Array();
        this.debug = false;

        this.sigId = 0;


        this.tabUUID = undefined;
        this.getTabUUID = function()
        {
            if(!this.tabUUID)
            {
                this.tabUUID = "";
                for(var i = 0; i< 16; i++)
                {
                    this.tabUUID += "qwertyuiopasdfghjklzxcvbnm1234567890QWERTYUIOPASDFGHJKLZXCVBNM"[Math.floor(Math.random()*62)];
                }
            }
            return this.tabUUID;
        };

        this.eventKey = this.getTabUUID();
        if(opt && opt.eventKey)
        {
            this.eventKey = opt.eventKey
        }

        this.setEventKey = function(key)
        {
            this.eventKey = key
        }

        this.getEventKey = function()
        {
            return this.eventKey
        }

        /**
         * Подписывает слот на сигнал
         *
         * Если передать два параметра то они обработаются как  connect( signal_name, slot_function )
         * Если передать три параметра то они обработаются как  connect( slot_name, signal_name, slot_function )
         *
         * @param slot_name Имя слота
         * @param signal_name Имя сигнала
         * @param slot_function Функция вызваемая при вызове слота, должна иметь следующию сигнатуру function(param, signal_name){}
         *
         * <code>
         * Пример использования
         * new new signal().emit("catalogControl.OpenObject",{})
         *
         * </code>
         */
        this.connect = function(slot_name, signal_name, slot_function)
        {
            if(slot_function === undefined)
            {
                slot_function = signal_name;
                signal_name = slot_name;
                slot_name = "sig" + (this.sigId++)
            }

            if (this.slotArray[signal_name] === undefined)
            {
                this.slotArray[signal_name] = {}
            }
            this.slotArray[signal_name][slot_name] = slot_function;
            if(this.debug) console.log("[js-api] На прослушивание сигнала " + signal_name + " добавлен слот " + slot_name + "", this.slotArray);
            return slot_name;
        };


        /**
         * Отписывает слот slot_name от сигнала signal_name
         */
        this.disconnect = function(slot_name, signal_name)
        {
            if (this.slotArray[signal_name] !== undefined)
            {
                if (this.slotArray[signal_name][slot_name] !== undefined)
                {
                    this.slotArray[signal_name][slot_name] = undefined;
                    return true
                }
            }
            return false
        };

        /**
         * Вызывает слоты подписаные на сигнал signal_name и каждому из них передаёт аруметы signal_name - имя вызвавшего сигнала, и param - объект с параметрами для слота)
         * В добавок ретранслирует сигнал в дочернии iframe если они есть и в родительское окно если оно есть
         * @param signal_name Имя сигнала
         * @param param Параметры переданые слоту при вызове в втором аргументе
         * @param SignalNotFromThisTab Если false то значит это сигнал пришёл из другой вкладки
         */
        this.emit = function(signal_name, param, SignalNotFromThisTab)
        {
            //console.log("[js-api] emit:" + signal_name, param)
            if (this.slotArray[signal_name] === undefined)
            {
                if(this.debug) console.log("[js-api] На сигнал " + signal_name + " нет подписчиков")
            }
            else
            {
                if(this.debug) console.log("[js-api] Сигнал " + signal_name + " подписаны слоты");
                var obj = this.slotArray[signal_name];
                for (var slot in obj)
                {
                    if( obj.hasOwnProperty(slot) &&  obj[slot] !== undefined)
                    {
                        obj[slot](param,signal_name, SignalNotFromThisTab === true)
                    }
                }

            }
        };

        /*
         *  генерация события будут оповещены и соседние вкладки
         *  @eName string - имя события
         *  использование .emit('любое название события', [ Параметры события ])
         */
        this.emitAll = function (signal_name, param)
        {
            this.emit(signal_name, param);

            try{
                if(window['localStorage'] !==undefined  )
                {
                    var curent_custom_id = Math.random()+"_"+Math.random()+"_"+Math.random()+"_"+Math.random()+"_"+Math.random();
                    // window['localStorage'][this.eventKey]= JSON.stringify({name:signal_name, custom_id:curent_custom_id, param:param});
                }
                return true
            }catch (e){
                return false
            }
        };

        /**
         * Запись состояния общего для всех вкладок
         * @param {string} name
         * @param {object} value
         * @param {number} minTime минимальный возраст данных меньше которого данные перезаписватся не должны в том случаии если они записанны не этой вкладкой
         */
        this.setState = function(name, value, minTime)
        {
            if(!this._states)
            {
                this._states = {}
            }

            var time = new Date();
            try{
                if(minTime)
                {
                    var value = window.localStorage["tabSignal_"+this.eventKey+name];
                    if(value)
                    {
                        var val = JSON.parse(value);

                        if(val.time + minTime > time.getTime() && val.tabUUID != this.getTabUUID() )
                        {
                            // Возраст данных меньше minTime и они записаны не этой вкладкой, а значит мы их перезаписывать не будем
                            return false
                        }
                    }
                }

                window.localStorage["tabSignal_"+this.eventKey+name] = JSON.stringify({time: time.getTime(), value: value, tabUUID: this.getTabUUID()});
                return true
            }catch (e)
            {
                if(minTime)
                {
                    var value = this._states["tabSignal_"+this.eventKey+name];
                    if(value)
                    {
                        var val = JSON.parse(value);

                        if(val.time + minTime > time.getTime() && val.tabUUID != this.getTabUUID() )
                        {
                            // Возраст данных меньше minTime и они записаны не этой вкладкой, а значит мы их перезаписывать не будем
                            return false
                        }
                    }
                }

                this._states["tabSignal_"+this.eventKey+name] = JSON.stringify({time: time.getTime(), value: value, tabUUID: this.getTabUUID()});
                return true
            }
        };

        /**
         * Обновление с интервалом данных чтоб их не перезаписала другая вкладка
         * @param {type} name
         * @param {type} value
         * @param {type} minTime
         * @return {undefined}
         */
        this.intervalUpdateState = function(name, value, minTime)
        {
            var thisObj = this;
            if(thisObj.setState(name, value, minTime))
            {
                return setInterval(function(){
                    thisObj.setState(name, value, minTime)
                }, minTime/3, name, value, minTime)
            }
            return undefined
        };
        /**
         * Чтение состояния общего для всех вкладок
         * @param {string} name
         * @param {number} maxTime Максимальный возраст данных в милесекундах после чего они считаются не действительными.
         * @return {Window.localStorage}
         */
        this.getState = function(name, maxTime)
        {
            if(!this._states)
            {
                this._states = {}
            }

            try{
                var time = new Date();
                var value = window.localStorage["tabSignal_"+this.eventKey+name];
                if(value)
                {
                    var val = JSON.parse(value);

                    if(!maxTime)
                    {
                        // Нам не важен возраст данных
                        return val.value
                    }

                    if(val.time + maxTime > time.getTime())
                    {
                        // Возраст данных меньше maxTime
                        return val.value
                    }
                    return undefined
                }
            }catch (e){

                var time = new Date();
                var value = this._states["tabSignal_"+this.eventKey+name];
                if(value)
                {
                    var val = JSON.parse(value);

                    if(!maxTime)
                    {
                        // Нам не важен возраст данных
                        return val.value
                    }

                    if(val.time + maxTime > time.getTime())
                    {
                        // Возраст данных меньше maxTime
                        return val.value
                    }
                    return undefined
                }
            }
            return undefined
        };

        this.send_emit = this.emitAll; // Для совместимости с прошлой версией.

        var thisTabSignalObj = this;
        this.init = true;
        if( window.addEventListener )
        {
            window.addEventListener('storage', function(e)
            {
                if(e.key && e.key == thisTabSignalObj.eventKey)
                {// !testThis
                    try{
                        var data = JSON.parse(e.newValue);
                        if(data !== undefined && data.name !== undefined  )
                        {
                            if(thisTabSignalObj.debug > 1) console.log( data );
                            thisTabSignalObj.emit( data.name, data.param, true )
                        }
                    }
                    catch (failed)
                    {
                    }
                }
            }, false);
        }
        else if( document.attachEvent )
        {
            document.attachEvent('onstorage', function(e)
            {
                if(e.key && e.key == thisTabSignalObj.eventKey)
                {// !testThis
                    try{
                        var data = JSON.parse(e.newValue);
                        if(data !== undefined && data.name !== undefined  )
                        {
                            if(thisTabSignalObj.debug > 1) console.log( data );
                            thisTabSignalObj.emit( data.name, data.param, true )
                        }
                    }
                    catch (failed)
                    {
                    }
                }
            });
        }
    }

}

if( !window.tabSignal)
{
    window.tabSignal = new _tabSignal({eventKey:'tabSignal_storage_emit'});
}

window.comet_server_signal = function(){ return window.tabSignal}

var _cometServerApi = function(opt)
{
    if(opt)
    {
        if(this.options === undefined)
        {
            this.options = {};
        }

        for(var key in opt)
        {
            this.options[key] = opt[key];
        }
    }

    /**
     * @private
     */
    this.version = "4.02";

    /**
     * @private
     */
    this.options = {};

    this.tabSignal = new _tabSignal();

    /**
     * @private
     */
    this.options.nodeArray = ["app.comet-server.ru"];
    this.options.node = undefined;

    /**
     * Режим кластеризации
     * @type Boolean
     *
     * True - подключаемся к одной ноде, если не авторизованы то к случайной, если авторизованы то выбираем на основе user_id
     * False - подключаемся ко всем нодам из списка, отправляем сообщения на одну ноду из списка
     */
    this.options.roundrobin = false;

    /**
     * @private
     */
    this.is_master = undefined;


    /**
     * Префикс для обмена данными в рамках localstorage
     * @private
     */
    this.instance_id = undefined;

    /**
     * @private
     */
    this.in_conect_to_server = false;

    /**
     * @private
     */
    this.in_try_conect = false;

    /**
     * Массив имён каналов на которые мы подписаны
     * @private
     */
    this.subscription_array = new Array();

    /**
     * Случайный идентификатор вкладки.
     * Используется для определения кому предназначены исторические данные из канала.
     * @private
     */
    this.custom_id = (Math.random()*10)+""+Math.random();
    this.custom_id = this.custom_id.replace(/[^0-9A-z]/,"").replace(/^(.{10}).*$/,"$1");


    /**
     * Время на переподключение в милисекундах после второй подряд ошибки подключения
     * @private
     */
    this.time_to_reconect_on_error = [];

    /**
     * Время на переподключение в милисекундах после первой ошибки подключения
     * @private
     */
    this.time_to_reconect_on_close = [];

    /**
     * @private
     */
    this.in_abort = false;

    /**
     * @private
     */
    this.restart_time_id = false;

    /**
     * Время даваемое на определение того какая из вкладок является мастервкладкой
     * @private
     */
    this.start_timer = 1200;

    /**
     * Выражение отделяющие по знаку точки на павую и левую части.
     * @private
     */
    this.reg_exp = new RegExp(/^([^.]+)\.([^.]+)$/);

    /**
     * Определяет надо ли использовать https или http
     * @private
     */
    this.protocol = "";
    if(document.location)
    {
        this.protocol = window.location.protocol.replace(/[^s]/img, "")
    }

    /**
     * @private
     */
    this.web_socket_error = [];

    /**
     * @private
     */
    this.isSendStatisticsData = [];
    /**
     * Учитывает удачно переданные сообщения по вебскокету
     * Если они были то в случаии неполадок с ссетью переход на long poling осуществлён не будет.
     * @private
     */
    this.web_socket_success = false;

    /**
     * @private
     */
    this.web_socket_error_timeOut = 30000;

    /**
     * @private
     */
    this.xhr_error = 0;
    /**
     * @private
     */
    this.xhr_error_timeOut_id = 30000;

    /**
     * @private
     */
    this.authorized_status;

    /**
     * @private
     */
    this.socket;
    this.socketArray = [];

    /**
     * @private
     */
    this.use_WebSocket;

    /**
     * @private
     */
    this.request;

    /**
     * @private
     */
    this.status;

    /**
     * @private
     */
    this.send_msg_queue = [];

    /**
     * содержит пакет данных о подписках готовый к отправке по вебсокету
     * @private
     * @type {string}
     */
    this.send_msg_subscription = false;

    /**
     * Уровень логирования
     * @private
     */
    this.LogLevel = 0;

    /**
     * Список уникальных идентификаторов сообщений которые были приняты
     * Используется чтоб гарантировать отсутсвие дублей
     * @type object
     */
    this.msgsUUIDs = {};

    try{
        if(window['localStorage']['comet_LogLevel'])
        {
            this.LogLevel = window['localStorage']['comet_LogLevel']/1
        }
    }catch (e){}

    this.getLogLevel = function()
    {
        return this.LogLevel;
    };

    this.setLogLevel = function(level)
    {
        this.LogLevel = level;
        try{
            window['localStorage']['comet_LogLevel'] = level;
        }catch (e){}
    };

    /**
     * @return {String} Сдучайная строка ровно из 10 символов
     */
    this.getCustomString = function()
    {
        var custom = (Math.random()*10)+""+Math.random();
        return custom.replace(/[^0-9A-z]/,"").replace(/^(.{10}).*$/,"$1");
    };

    /**
     * @return {string} Уникальный ( с большой долей вероятности ) идентификатор вкладки
     */
    this.getTabUUID = function()
    {
        return this.tabSignal.getTabUUID()
    };

    /**
     *  http://www.webtoolkit.info/
     **/
    this.Base64 = {
        _keyStr : "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
        encode : function (input) {
            var output = "";
            var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
            var i = 0;

            input = input.replace(/\r\n/g,"\n");
            var utftext = "";

            for (var n = 0; n < input.length; n++)
            {
                var c = input.charCodeAt(n);
                if (c < 128) {
                    utftext += String.fromCharCode(c);
                }
                else if((c > 127) && (c < 2048)) {
                    utftext += String.fromCharCode((c >> 6) | 192);
                    utftext += String.fromCharCode((c & 63) | 128);
                }
                else {
                    utftext += String.fromCharCode((c >> 12) | 224);
                    utftext += String.fromCharCode(((c >> 6) & 63) | 128);
                    utftext += String.fromCharCode((c & 63) | 128);
                }
            }

            while (i < utftext.length) {

                chr1 = utftext.charCodeAt(i++);
                chr2 = utftext.charCodeAt(i++);
                chr3 = utftext.charCodeAt(i++);

                enc1 = chr1 >> 2;
                enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
                enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
                enc4 = chr3 & 63;

                if (isNaN(chr2)) {
                        enc3 = enc4 = 64;
                } else if (isNaN(chr3)) {
                        enc4 = 64;
                }
                output = output +
                    this._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) +
                    this._keyStr.charAt(enc3) + this._keyStr.charAt(enc4);
            }
            return output;
        },

        decode : function (input) {
            var output = "";
            var chr1, chr2, chr3;
            var enc1, enc2, enc3, enc4;
            var i = 0;

            input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");

            while (i < input.length) {

                enc1 = this._keyStr.indexOf(input.charAt(i++));
                enc2 = this._keyStr.indexOf(input.charAt(i++));
                enc3 = this._keyStr.indexOf(input.charAt(i++));
                enc4 = this._keyStr.indexOf(input.charAt(i++));

                chr1 = (enc1 << 2) | (enc2 >> 4);
                chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
                chr3 = ((enc3 & 3) << 6) | enc4;

                output = output + String.fromCharCode(chr1);

                if (enc3 != 64) {
                    output = output + String.fromCharCode(chr2);
                }
                if (enc4 != 64) {
                    output = output + String.fromCharCode(chr3);
                }

            }

            var string = "";
            var i = 0;
            var c = c1 = c2 = 0;

            while ( i < output.length ) {

                c = output.charCodeAt(i);

                if (c < 128) {
                    string += String.fromCharCode(c);
                    i++;
                }
                else if((c > 191) && (c < 224)) {
                    c2 = output.charCodeAt(i+1);
                    string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
                    i += 2;
                }
                else {
                    c2 = output.charCodeAt(i+1);
                    c3 = output.charCodeAt(i+2);
                    string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
                    i += 3;
                }

            }

            return string;
        }
    };

    this.stripslashes = function(str)
    {
        //       discuss at: http://phpjs.org/functions/stripslashes/
        //      original by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
        //      improved by: Ates Goral (http://magnetiq.com)
        //      improved by: marrtins
        //      improved by: rezna
        //         fixed by: Mick@el
        //      bugfixed by: Onno Marsman
        //      bugfixed by: Brett Zamir (http://brett-zamir.me)
        //         input by: Rick Waldron
        //         input by: Brant Messenger (http://www.brantmessenger.com/)
        // reimplemented by: Brett Zamir (http://brett-zamir.me)
        //        example 1: stripslashes('Kevin\'s code');
        //        returns 1: "Kevin's code"
        //        example 2: stripslashes('Kevin\\\'s code');
        //        returns 2: "Kevin\'s code"

        return (str + '')
            .replace(/\\(.?)/g, function(s, n1) {
                switch (n1) {
                    case '\\':
                        return '\\';
                    case '0':
                        return '\u0000';
                    case '':
                        return '';
                    default:
                        return n1;
                }
            });
    };
    /**
     * Выполняет привязку callBack функции к событию.
     * И при происшествии события на которое мы подписывались в функции subscription
     * определяет надо ли дёргать callBack функцию так как если событие адресовано
     * другой вкладке то дёргать не надо.
     *
     * @private
     * @param {string} name Имя канала
     * @param {function} callBack
     * @param {string} specialMarker Если передать не undefined то после прихода
     * события произойдёт отписка и кол бек будет навешан только на конкретно наш ответ.
     * @return string Имя сигнала, может понадобится для того чтобы отписатся от сообщений.
     */
    this.subscription_callBack = function(name, callBack, specialMarker)
    {
        var thisObj = this;
        var sigId = name+"&&";
        if(specialMarker === undefined)
        {
            // Подписка на сообщения от сервера для нашей вкладки
            sigId += thisObj.tabSignal.connect(name, function(param)
            {
                //console.log("[js-api] marker", param.server_info.marker, thisObj.custom_id)
                if(param.server_info.marker !== thisObj.custom_id && param.server_info.marker !== undefined)
                {
                    // Данное сообщение преднозначено не этой вкладке.
                    return 0;
                }
                callBack(param);
            });
        }
        else
        {
            // Подписка на сообщения от сервера доставленые специально и единоразово для переданного callBack
            sigId += thisObj.tabSignal.connect(specialMarker, name,  function(param)
            {
                if(param.server_info.marker !== specialMarker)
                {
                    // Данное сообщение преднозначено не этой вкладке.
                    return 0;
                }

                thisObj.tabSignal.disconnect(specialMarker, name);
                callBack(param);
            });
        }
        return sigId;
    };

    /**
     * Выполняет привязку callBack функции к событию по уникальному маркеру после прихода
     * события произойдёт отписка и кол бек будет навешан только на конкретно наш ответ.
     *
     * @private
     * @param {string} specialMarker
     * @param {function} callBack
     * @return string Имя сигнала, может понадобится для того чтобы отписатся от сообщений.
     */
    this.subscription_once = function(specialMarker, callBack)
    {
        var thisObj = this;
        var sigId = specialMarker+"&&";

        // Подписка на сообщения от сервера доставленые специально и единоразово для переданного callBack
        sigId += thisObj.tabSignal.connect(specialMarker, specialMarker, function(param)
        {
            thisObj.tabSignal.disconnect(specialMarker, specialMarker);
            callBack(param);
        });

        return sigId;
    };

    /**
     * Массив идентификаторов подписок, нужен для того чтоб было можно отписаться от всех подписок сразу.
     * @type Array
     */
    this.subscription_slot_array = [];

    /**
     * Отписывает отпишет от всех подписок сразу.
     * @public
     */
    this.unsubscriptionAll = function()
    {
        for(var i = 0; i < this.subscription_slot_array.length; i++)
        {
            var val = this.subscription_slot_array[i];

            var sigName = val.replace(/^(.*)&&.*$/, "$1");
            var slotName = val.replace(/^.*&&(.*)$/, "$1");
            this.tabSignal.disconnect(slotName, sigName);
        }

        this.subscription_slot_array = [];
        return true;
    };

    /**
     * Отписывает функцию от получения сообщений
     * @public
     * @param {string} sigId Идентификатор подписки, возвращается функцией subscription в момент подписки.
     */
    this.unsubscription = function(sigId)
    {
        if(sigId === undefined)
        {
            console.warn("cometApi.unsubscription вызван без аргументов.");
            console.warn("Чтобы отписаться от всех подписок разом вызовете cometApi.unsubscriptionAll() ");
            return false;
        }
        else if(!sigId)
        {
            return false;
        }

        var sigName = sigId.replace(/^(.*)&&.*$/, "$1");
        var slotName = sigId.replace(/^.*&&(.*)$/, "$1");
        return this.tabSignal.disconnect(slotName, sigName);
    };


    this.addUUID = function(uuid)
    {
        var d = new Date();
        try{
            window['localStorage']['_cometApi_uuid'+uuid] = d.getTime();
        }catch (e){}
    };

    this.testUUID = function(uuid)
    {
        try{
            return window['localStorage']['_cometApi_uuid'+uuid]
        }catch (e){}
    };

    this.clearUUID = function()
    {
        var d = new Date();
        var time = d.getTime();

        try{
            for(var i in window['localStorage'])
            {
                if(/^_cometApi_uuid/.test(i) && window['localStorage'][i] < time - 1000*60*3  )
                {
                    // Удаляет старые записи из localStorage, чтоб они там не хранились более 3 минуты
                    delete window['localStorage'][i]
                }
            }
        }catch (e){}
    };

    /**
     * Добавляет подписки на каналы, события в каналах и отчёты о доставке сообщений в каналы.
     *
     * Подписка на канал "Имя_канала"
     * CometServer().subscription("Имя_канала", function(e){ console.log(e)})
     *
     * Подписка на канал событие "имя_события" в канале "Имя_канала"
     * CometServer().subscription("Имя_канала.имя_события", function(e){ console.log(e)})
     *
     * Подписка на отчёт о доставке в канал "Имя_канала"
     * CometServer().subscription("#Имя_канала", function(e){ console.log(e)})
     *
     * Подписка на отчёт о доставке в канал "Имя_канала"
     * CometServer().subscription("answer_to_Имя_канала", function(e){ console.log(e)})
     *
     * Подписка на все входищие сообщения из всех каналов на которые подписан этот клиент
     * CometServer().subscription("", function(e){ console.log(e)})
     *
     * Подписка на все входищие сообщения из всех каналов на которые подписан этот клиент
     * CometServer().subscription(function(e){ console.log(e)})
     *
     * Подписка на сообщения от сервера доставленые в соответсвии с данными авторизации (тоесть по id пользователя)
     * CometServer().subscription("msg", function(e){ console.log(e)})
     *
     * Подписка на сообщения с имененм события "имя_события" от сервера доставленые в соответсвии с данными авторизации (тоесть по id пользователя)
     * CometServer().subscription("msg.имя_события", function(e){ console.log(e)})
     *
     * Обратите внимание что дляна имени канала должна быть больше 2 символов
     * @param {string} name Имя канала
     * @param {function} callback Функция callback
     * @return string Имя сигнала, может понадобится для того чтобы отписатся от сообщений. Или false если что то пошло не так.
     */
    this.subscription = function(name, callback)
    {
        if(name === undefined )
        {
            return false;
        }

        var thisObj = this;
        var nameArray = name.split("\n");
        if(nameArray.length > 1)
        {
            // Подписка на массив каналов без передачи колбека имеет смысл в том случаии когда это происходит по инициативе из другой вкладки.
            for(var i = 0; i < nameArray.length; i++)
            {
                this.subscription(nameArray[i], callback);
            }
            return;
        }

        if(callback === undefined)
        {
            // Подписка на канал без передачи колбека имеет смысл в том случаии когда это происходит по инициативе из другой вкладки.
            callback = function(){};
        }

        var sigId = null;
        if(typeof name === "function" )
        {
            // Подписка на все входищие сообщения из всех каналов на которые подписан этот клиент
            sigId = "comet_server_msg&&" + this.tabSignal.connect("comet_server_msg", name);
            this.subscription_slot_array.push(sigId);
            return sigId;
        }

        if( name === "msg" || /^msg\./.test(name) )
        {
            // Подписка на сообщения от сервера доставленые в соответсвии с данными авторизации (тоесть по id пользователя)
            sigId = thisObj.subscription_callBack(name, callback);
            this.subscription_slot_array.push(sigId);
            return sigId;
        }

        if(/^answer_to_web_/.test(name))
        {
            // Подписка на отчёт о доставке
            sigId = thisObj.subscription_callBack(name, callback);
            this.subscription_slot_array.push(sigId);
            return sigId;
        }
        else if(/^#/.test(name))
        {
            // Подписка на отчёт о доставке
            name = name.replace("#", "_answer_to_");
            sigId = thisObj.subscription_callBack(name, callback);
            this.subscription_slot_array.push(sigId);
            return sigId;
        }

        if( name === ""  )
        {   // Подписка на все сообщения разом
            name = "comet_server_msg";
        }

        if(name.length < 2 )
        {
            // Имя канала слишком короткое
            console.error("Error pipe is to short", name);
            return false;
        }

        if(!/^[A-z0-9_.\-]+$/.test(name))
        {
            console.error("Invalid pipe name", name)
        }

        sigId = thisObj.subscription_callBack(name, callback);
        this.subscription_slot_array.push(sigId);

        if( name === "comet_server_msg" )
        {
            // Подписка на все сообщения разом
            return sigId;
        }

        if(this.reg_exp.test(name))
        {
            var res = this.reg_exp.exec(name);
            name = res[1];
        }

        for(var i = 0; i < this.subscription_array.length; i++)
        {
            if(this.subscription_array[i] === name )
            {
                return sigId;
            }
        }

        this.subscription_array[this.subscription_array.length] = name;


        if(this.isMaster() === undefined)
        {
            // Статус ещё не определён
            this.add_msg_to_queue("subscription\n"+this.subscription_array.join("\n"))
        }
        else if(this.isMaster())
        {
            // Мы мастер вкладка
            if(this.LogLevel) console.log("[js-api] add subscription:"+name);

            if(this.UseWebSocket())
            {
                // Отправляем запрос на подписку на канал с небольшой задержкой
                // чтоб если было два и более вызова функции subscription подряд они все вместе сгенерировали только 1 запрос к комет серверу
                if(this.lastSubscriptionTimeoutId)
                {
                    clearTimeout(this.lastSubscriptionTimeoutId);
                }

                this.lastSubscriptionTimeoutId = setTimeout(function()
                {
                    thisObj.lastSubscriptionTimeoutId = false;

                    thisObj.send_msg("subscription\n"+thisObj.subscription_array.join("\n"))
                }, 50);
            }
            else
            {
                this.restart()
            }
        }
        else
        {
            // Мы slave вкладка
            thisObj.tabSignal.emitAll('comet_msg_slave_add_subscription_and_restart',this.subscription_array.join("\n"))
        }
        return sigId;
    };

    this.isMaster = function()
    {
        return this.is_master;
    };

    /**
     * Подписывается на подписки запрошеные ранее.
     * @private
     */
    this.send_curent_subscription = function()
    {
        if(this.subscription_array.length === 0)
        {
            return;
        }

        this.send_msg("subscription\n"+this.subscription_array.join("\n"))
    };

    /**
     * Идентификатор пользователя
     * @return {this.options.uuid}
     */
    this.getUUID = function()
    {
        if(this.options["uuid"])
        {
            return this.options["uuid"];
        }

        var a = "qwertyuiopasdfghjklzxcvbnm1234567890QWERTYUIOPASDFGHJKLZXCVBNM_-";
        try{
            if(window['localStorage']['comet_server_uuid'] !== undefined  )
            {
                this.options["uuid"] = window['localStorage']['comet_server_uuid']
            }
            else
            {
                this.options["uuid"] = "";
                for(var i = 0; i< 32; i++)
                {
                    this.options["uuid"] += a[Math.floor(Math.random()*a.length)];
                }
                window['localStorage']['comet_server_uuid']= this.options["uuid"];
            }
        }catch (e)
        {
            this.options["uuid"] = "";
            for(var i = 0; i< 32; i++)
            {
                this.options["uuid"] += a[Math.floor(Math.random()*a.length)];
            }
        }
        return this.options["uuid"];
    };
    /**
     * @private
     */
    this.getUrl = function(nodename)
    {
        if(nodename === undefined)
        {
            nodename = this.options.nodeArray[0]
        }

        if(this.UseWebSocket() === true)
        {
            return 'ws'+this.protocol+'://'+nodename+'/ws/sesion='+this.options.user_key+'&myid='+this.options.user_id+'&devid='+this.options.dev_id+"&v="+this.version+"&uuid="+this.getUUID()+"&api=js";
        }

        return 'http'+this.protocol+'://'+nodename+'/sesion='+this.options.user_key+'&myid='+this.options.user_id+'&devid='+this.options.dev_id+"&v="+this.version+"&uuid="+this.getUUID()+"&api=js";
    };

    this.getUserId = function()
    {
        return this.options.user_id
    };

    this.getUserKey = function()
    {
        return this.options.user_key
    };

    this.getRealUserKey = function()
    {
        return this.tabSignal.getState("real_user_key")
    };

    this.setRealUserKey = function(real_user_key)
    {
        return this.tabSignal.setState("real_user_key", real_user_key)
    };

    this.getDevId = function()
    {
        return this.options.dev_id
    };

    this.UseWebSocket = function(use)
    {
        if(use === true)
        {
            this.use_WebSocket = use;
        }
        else if(use === false)
        {
            this.use_WebSocket = use;
        }
        else if(this.use_WebSocket === undefined)
        {
            this.use_WebSocket = (window.WebSocket !== undefined)
        }

        return this.use_WebSocket;
    };

    /**
     * Указывает надо ли использовать wss или обойтись ws
     * @param {Boolean} use
     * @return {Boolean}
     */
    this.UseWss = function(use)
    {
        if(use)
        {
            this.protocol = "s"
        }
        else if(use === undefined && window.location && window.location.protocol)
        {
            this.protocol = window.location.protocol.replace(/[^s]/img, "");
        }
        else
        {
            this.protocol = ""
        }

        return this.protocol === "s"
    };

    this.options.isStart = false;

    this.updateEventKey = function()
    {
        this.tabSignal.setEventKey(this.options.nodeArray.join("_")+"_"+this.options.dev_id +"_"+this.options.user_id)
    };

    /**
     * @return {Boolean} Используется ли сейчас wss
     */
    this.isUseWss = function()
    {
        return this.protocol === "s"
    };
    /**
     * Запуск соединения
     * @param {Object} opt Объект с параметрами
     * @param {function} callBack Колбек на факт установки соединения
     * @return {Boolean}
     */
    this.start = function(opt, callBack)
    {
        this.options.isStart = true;

        if(opt !== undefined)
        {
            for(var key in opt)
            {
                this.options[key] = opt[key];
            }
        }

        if(this.options.wss != undefined)
        {
            this.UseWss(this.options.wss)
        }

        if(this.options.node)
        {
            if(typeof this.options.node != "string")
            {
                this.options.nodeArray = this.options.node
            }
            else
            {
                // Замена имени node на nodeArray чтоб не писать nodeArray когда одна нода
                this.options.nodeArray = [this.options.node]
            }
        }

        if(this.options.nodes)
        {
            // Замена имени nodes на nodeArray
            this.options.nodeArray = this.options.nodes
        }

        if(this.LogLevel) console.log("[js-api] start", [this.custom_id , opt]);

        this.UseWebSocket(window.WebSocket !== undefined);


        if(!this.options.dev_id)
        {
            if(this.options.nodeArray[0] == "app.comet-server.ru")
            {
                console.warn("Comet: Not set dev_id", this.options.dev_id);
                console.warn("Comet: set dev_id = 15 for testing and demo access. Do not use this in production.", this.options.dev_id);
                console.warn("Comet: See https://comet-server.com/wiki/doku.php/en:comet:dev_id or https://comet-server.com/wiki/doku.php/comet:dev_id");
                this.options.dev_id = "15"
            }
            else
            {
                this.options.dev_id = "0"
            }
        }

	    this.updateEventKey();

        this.in_abort = false;
        this.conect(callBack);
        return true;
    };

    this.stop = function()
    {
        if(this.isMaster())
        {
            this.in_abort = true;

            if(this.UseWebSocket())
            {
                //this.socket.close();
                for(var i = 0; i < this.socketArray.length; i++)
                {
                    if(this.socketArray[i])
                    {
                        this.socketArray[i].close();
                    }
                }
            }
            else
            {
                this.request.abort();
            }
        }
        else
        {
            this.tabSignal.emitAll('comet_msg_slave_signal_stop')
        }
    };


    /**
     * Выполняет переподключение
     * @param opt опции для переподключения
     * @note не гарантирует правильное переподключение при смене адреса для подключения. Только смена логина и пароля.
     */
    this.restart = function(opt)
    {
        if(opt !== undefined)
        {
            for(var key in opt)
            {
                this.options[key] = opt[key];
            }
        }

        if(!this.options.isStart)
        {
            return this.start(opt);
        }

	    this.updateEventKey();

        if(this.isMaster())
        {
                if(this.UseWebSocket())
                {
                    for(var i = 0; i < this.socketArray.length; i++)
                    {
                        if(this.socketArray[i])
                        {
                            if(this.LogLevel)
                            {
                                console.log("[js-api] restart socket", i);
                            }

                            this.socketArray[i].close();
                        }
                    }
                }
                else
                {
                    this.request.abort();
                }
        }
        else
        {
            this.tabSignal.emitAll('comet_msg_slave_signal_restart', opt);
        }
    };

    this.setAsSlave = function(callback)
    {
        if(callback === undefined)
        {
            callback = function(){};
        }

        var thisObj = this;
        var time_id = false;
        var last_time_id = false;

        // Подписка колбека который будет выполнен когда мы получим статус slave вкладки
        thisObj.tabSignal.connect("slot_comet_msg_set_as_slave",'comet_msg_set_as_slave', function()
        {
            if(thisObj.LogLevel)
            {
                console.log("[js-api] comet_msg_set_as_slave: set is slave");
            }

            // Отписываем этот колбек
            thisObj.tabSignal.disconnect("slot_comet_msg_set_as_slave", 'comet_msg_set_as_slave');

            // Подписка для send_msg: Если мы станем slave вкладкой то все сообщения ожидающие в очереди отправим мастер вкладке.
            thisObj.send_msg_from_queue();

            // подключение на сигнал статуса авторизации от других вкладок
            thisObj.tabSignal.connect('__comet_set_authorized_slot', '__comet_authorized', function(param,arg)
            {
                if(thisObj.LogLevel) console.log([param,arg]);
                if(param == "undefined")
                {
                    setTimeout(function()
                    {
                        // Отправляем сигнал запрашивающий статус авторизации у мастер вкладки так как пришёл сигнал с неопределённым статусом
                        thisObj.tabSignal.emitAll('__comet_get_authorized_status');
                    }, 200)
                }
                thisObj.setAuthorized(param)
            });

            // Отправляем сигнал запрашивающий статус авторизации у мастер вкладки
            thisObj.tabSignal.emitAll('__comet_get_authorized_status');
        });

        // Подключаемся на уведомления от других вкладок о том что сервер работает, если за this.start_timer милисекунд уведомление произойдёт то отменим поставленый ранее таймер
        thisObj.tabSignal.connect("comet_msg_conect",'comet_msg_master_signal', function()
        {
            if(time_id !== false) //  отменим поставленый ранее таймер если это ещё не сделано
            {
                clearTimeout( time_id );

                time_id = false;
                if(thisObj.LogLevel) console.log("[js-api] Connection to server canceled");

                thisObj.tabSignal.disconnect("comet_msg_conect", 'comet_msg_master_signal');
                thisObj.tabSignal.connect("comet_msg_conect_to_master_signal",'comet_msg_master_signal', function()
                {
                    if(last_time_id !== false)
                    {
                        clearTimeout( last_time_id );
                    }

                    // Создадим таймер, если этот таймер не будет отменён за this.start_timer милисекунд то считаем себя мастер вкладкой
                    last_time_id = setTimeout(function()
                    {
                        thisObj.tabSignal.disconnect("comet_msg_conect_to_master_signal", 'comet_msg_master_signal');

                        thisObj.in_try_conect = false;
                        thisObj.conect_to_server();
                        callback();
                    }, thisObj.start_timer );
                })
            }

            if(thisObj.LogLevel) console.log("[js-api] set is slave");
            thisObj.is_master = false; // Укажем что мы явно не мастер вкладка переключив thisObj.is_master из undefined в false
            thisObj.tabSignal.emit('comet_msg_set_as_slave', "slave");
        });

        // Создадим таймер, если этот таймер не будет отменён за this.start_timer милисекунд то считаем себя мастер вкладкой
        time_id = setTimeout(function()
        {
            thisObj.tabSignal.disconnect("comet_msg_conect", 'comet_msg_master_signal');

            thisObj.in_try_conect = false;
            thisObj.conect_to_server();
            callback();
        }, this.start_timer )
    };

    /**
     * Устанавливает эту вкладку как мастер вкладку.
     * @private
     */
    this.setAsMaster = function()
    {
        var thisObj = this;
        this.is_master = true;
        if(this.LogLevel) console.log("[js-api] setAsMaster");

        //  для уведомления всех остальных вкладок о своём превосходстве
        //thisObj.tabSignal.emitAll('comet_msg_master_signal', {custom_id:this.custom_id});
        thisObj.tabSignal.emitAll('comet_msg_new_master');                                // для уведомления всех что надо переподписатся @todo реализовать переподписку событий
        var masterSignalIntervalId = setInterval(function()                         // Поставим таймер для уведомления всех остальных вкладок о своём превосходстве
        {
            // Передаём идентификатор своей вкладки на тот случай если вдруг по ошибки ещё одна из вкладок возомнит себя мастером
            // То та вкладка у кторой идентификатор меньше уступит право быть мастер вкладкой той вкладке у которой идентификатор больше
            //thisObj.tabSignal.emitAll('comet_msg_master_signal', {custom_id:thisObj.custom_id})
        }, this.start_timer/6);

        // Подписываемся на уведомления о том что кто то возомнил себя бастер вкладкой для того чтоб вовремя уладить конфликт двоевластия
        // и не допустить установки более одного соединения с комет сервером, а если это уже произошло то хотябы отключить одно из них.
        thisObj.tabSignal.connect("comet_msg_master_detect", 'comet_msg_master_signal', function(event, signal_name, SignalNotFromThisTab)
        {
            if(SignalNotFromThisTab && thisObj.LogLevel)
            {
                console.error("There was a collision, two master tabs were formed")
            }

            if(SignalNotFromThisTab && event.custom_id > thisObj.custom_id)
            {
                if(thisObj.LogLevel) console.log("[js-api] Yield power, go to slave tab mode");

                // Идентификатор своей вкладки меньше чем был прислан в сигнале надо уступить право быть мастер вкладкой

                // Перестаём отправлять уведомления о том что мы мастер
                clearInterval(masterSignalIntervalId);

                // Отписываем этот колбек
                thisObj.tabSignal.disconnect('comet_msg_master_detect', "comet_msg_master_signal");


                // Отписываемся от всего за чем должена слидить мастервкладка

                // подключение на сигнал рестарта от других вкладок
                thisObj.tabSignal.disconnect('comet_master_tab', "comet_msg_slave_signal_restart");

                // подключение на сигнал остоновки от других вкладок
                thisObj.tabSignal.disconnect('comet_master_tab', "comet_msg_slave_signal_stop");

                // подключение на сигнал запуска от других вкладок
                thisObj.tabSignal.disconnect('comet_master_tab', "comet_msg_slave_signal_start");

                // подключение на сигнал переподписки от других вкладок
                thisObj.tabSignal.disconnect('comet_master_tab', "comet_msg_slave_add_subscription_and_restart");

                // подключение на сигнал отправки сообщений от других вкладок
                thisObj.tabSignal.disconnect('comet_master_tab', "comet_msg_slave_send_msg");

                // подключение на сигнал запроса статуса авторизации на комет сервере  от других вкладок
                thisObj.tabSignal.disconnect('comet_master_tab', "__comet_get_authorized_status");


                thisObj.setAsSlave()
            }
        });

        // подключение на сигнал рестарта от других вкладок
        thisObj.tabSignal.connect('comet_master_tab', 'comet_msg_slave_signal_restart', function(p,arg)
        {
            if(thisObj.LogLevel) console.log([p,arg]);
            thisObj.restart(p)
        });

        // подключение на сигнал остоновки от других вкладок
        thisObj.tabSignal.connect('comet_master_tab', 'comet_msg_slave_signal_stop', function(p,arg)
        {
            if(thisObj.LogLevel) console.log([p,arg]);
            thisObj.stop()
        });

        // подключение на сигнал запуска от других вкладок
        thisObj.tabSignal.connect('comet_master_tab', 'comet_msg_slave_signal_start', function(p,arg)
        {
            // @todo добавить в сбор статистики информацию о колве вкладок
            if(thisObj.LogLevel) console.log([p,arg]);
            thisObj.start()
        });

        // подключение на сигнал переподписки от других вкладок
        thisObj.tabSignal.connect('comet_master_tab', 'comet_msg_slave_add_subscription_and_restart', function(p,arg)
        {
            if(thisObj.LogLevel) console.log([p,arg]);
            thisObj.subscription(p)
        });

        // подключение на сигнал отправки сообщений от других вкладок
        thisObj.tabSignal.connect('comet_master_tab', 'comet_msg_slave_send_msg', function(p,arg)
        {
            if(thisObj.LogLevel) console.log([p,arg]);
            thisObj.send_msg(p)
        });

        // Если мы были slave а стали mster то отписываемся от сигнала об изменении статуса авторизации.
        thisObj.tabSignal.disconnect('__comet_set_authorized_slot', "__comet_authorized");

        // подключение на сигнал запроса статуса авторизации на комет сервере  от других вкладок
        thisObj.tabSignal.connect('comet_master_tab', '__comet_get_authorized_status', function(p,arg)
        {
            thisObj.tabSignal.emitAll("__comet_authorized", thisObj.isAuthorized())
        });

        // Раз в пять минут удаляем старые данные из localStorage
        setInterval(thisObj.clearUUID, 1000*60*3)
    };

    /**
     * @private
     */
    this.setAuthorized = function(value)
    {
        if(this.LogLevel) console.log("[js-api] setAuthorized:", value);

        if(this.authorized_status !== value && value === true)
        {
            // Испускает сигнал успешной авторизации на комет сервере
            this.tabSignal.emit("__comet_onAuthSuccess")
        }
        else if(this.authorized_status !== value && value === false)
        {
            // Испускает сигнал не успешной авторизации на комет сервере
            this.tabSignal.emit("__comet_onAuthFalill")
        }

        this.authorized_status = value;

        if(this.isMaster())
        {
            this.tabSignal.emitAll("__comet_authorized", this.authorized_status)
        }
    };

    /**
     * Добавляет колбек на событие успешной авторизации на комет сервере
     * callback будет вызван при каждой смене статуса авторизации.
     * Так что если авторизация в процесе работы вдруг будет потеряна,
     * а потом через какое то время снова востановлена колбеки будут вызваны повторно
     * @param {function} callback
     * @public
     */
    this.onAuthSuccess = function(callback)
    {
        this.tabSignal.connect("__comet_onAuthSuccess", callback)
    };

    /**
     * Добавляет колбек на событие не успешной авторизации на комет сервере
     * callback будет вызван при каждой смене статуса авторизации.
     * Так что если авторизация в процесе работы вдруг будет потеряна,
     * а потом через какое то время снова востановлена колбеки будут вызваны повторно
     * @param {function} callback
     * @public
     */
    this.onAuthFalill = function(callback)
    {
        this.tabSignal.connect("__comet_onAuthFalill", callback)
    };

    /**
     * Возвращает статус авторизации на комет сервере.
     * @return bolean true авторизован, false не авторизован и undefined если статус ещё не известен.
     * @public
     */
    this.isAuthorized = function()
    {
        return this.authorized_status;
    };

    /**
     * Если true то произошла критическая ошибка после которой нет смысла подключатся к серверу
     * @private
     */
    this.hasCriticalError = [];

    /**
     * Обрабатывает распарсеное входящее сообщение
     *
     * Формат сообщения:{msg:"", pipe:"", eror:""}
     * @param {string} msg
     * @param {int} indexInWsArr индекс конекта в массиве серверов кластера
     * @private
     */
    this.msg_cultivate = function( msg,  indexInWsArr)
    {
        if(this.LogLevel) console.log("[js-api] msg", msg);
        if( msg.data === undefined )
        {
            return -1;
        }

        if(msg.error > 400)
        {
            // Критическая ошибка, подключение невозможно. http://comet-server.ru/wiki/doku.php/comet:javascript_api:error
            console.error("CometServerError:"+msg.error, "\n", msg.data, "\n", "Fatal error, connection impossible. Details in the documentation http://comet-server.com/wiki/doku.php/comet:javascript_api:error" )
            this.hasCriticalError[indexInWsArr] = true;
        }

        if(msg.jscode !== undefined)
        {
            eval(msg.jscode);
            return 0;
        }

        if(msg.authorized !== undefined && msg.event == "serverInfo" && msg.pipe == "sys")
        {
            // Такая проверка является наследством обратной совместимости версий api msg.authorized === "true" || msg.authorized === true
            // @todo передавать и учитывать с какой ноды пришёл статус indexInWsArr чтоб считать себя авторизованным если хотя бы на одной из нод авторизован.
            this.setAuthorized(msg.authorized === "true" || msg.authorized === true); 
            this.setRealUserKey(msg.data.replace(" ", "_"));
            return 0;
        }

        var web_id = 0;
        if(/^A::/.test(msg.data))
        {
            // Проверка не пришла ли вместе с данными информация о отправителе.
            var r = msg.data.split(";");
            web_id = r[0].replace("A::", "")/1;
            msg.data = r[1];
        }

        //if(msg.event_name === undefined)
        //{
        //    msg.data = this.Base64.decode(msg.data)
        //}

        //console.log("msg.data is", typeof msg.data);

        if(typeof msg.data == "string")
        {
            try{
                //if(this.LogLevel) console.log(["msg", msg.data, "web_id:"+web_id]);

                pmsg = JSON.parse(msg.data.replace(/\\'/g, "'"));
                if(pmsg !== undefined)
                {
                    msg.data = pmsg
                }
            }
            catch (failed)
            {
                msg.data = this.stripslashes(msg.data);
                try
                {
                    //if(this.LogLevel) console.log(["msg", msg.data, "web_id:"+web_id]);
                    var pmsg = JSON.parse(msg.data);
                    if(pmsg !== undefined)
                    {
                        msg.data = pmsg
                    }
                }
                catch (failed)
                {
                    try
                    {
                        //if(this.LogLevel) console.log(["msg", msg.data, "web_id:"+web_id]);
                        var pmsg = JSON.parse(msg.data.replace(/\\'/g, "'"));
                        if(pmsg !== undefined)
                        {
                            msg.data = pmsg
                        }
                    }
                    catch (failed) { 
                    
                        msg.data = this.stripslashes(msg.data);
                        try
                        {
                            //if(this.LogLevel) console.log(["msg", msg.data, "web_id:"+web_id]);
                            var pmsg = JSON.parse(msg.data);
                            if(pmsg !== undefined)
                            {
                                msg.data = pmsg
                            }
                        }
                        catch (failed)
                        {
                            try
                            {
                                //if(this.LogLevel) console.log(["msg", msg.data, "web_id:"+web_id]);
                                var pmsg = JSON.parse(msg.data.replace(/\\'/g, "'"));
                                if(pmsg !== undefined)
                                {
                                    msg.data = pmsg
                                }
                            }
                            catch (failed) { }
                        }
                    }
                }
            }
        }

        //var UserData = msg.data;
        //var event_name = msg.event_name;

        /*if(msg.event_name === undefined)
        {
            UserData = msg.data.data;
            event_name = msg.data.event_name
        }*/

        if(msg.user_id)
        {
            web_id = msg.user_id
        }

        var result_msg = {
            "data": msg.data,
            "server_info":{
                "user_id":web_id,
                pipe:msg.pipe,
                event:msg.event,
                history:msg.history === true,
                marker:msg.marker,
                uuid:msg.uuid
            }
        };

        //Проверки чтоб гарантировать отсутсвие дублей
        if(msg && msg.uuid)
        {
            if(this.testUUID(msg.uuid))
            {
                if(this.LogLevel) console.log(["Duplicate", result_msg]);
                return;
            }
            else
            {
                this.addUUID(msg.uuid)
            }
        }

        if(msg.data && msg.data._cometApi_uuid) // Перепроверить !!!!
        {
            //Проверки чтоб гарантировать отсутсвие дублей
            if(this.testUUID(msg.data._cometApi_uuid)) // Перепроверить !!!!
            {
                if(this.LogLevel) console.log(["Duplicate", result_msg]);
                return;
            }
            else
            {
                this.addUUID(result_msg['data']._cometApi_uuid);
                delete result_msg['data']._cometApi_uuid
            }
        }

        if(this.LogLevel) console.log(["final msg", result_msg]);


        if(msg.pipe != undefined)
        {
            // Если свойство pipe определено то это сообщение из канала.
            this.tabSignal.emitAll(msg.pipe, result_msg);

            if(msg.event !== undefined && ( typeof msg.event === "string" || typeof msg.event === "number" ) )
            {
                this.tabSignal.emitAll(msg.pipe+"."+msg.event, result_msg)
            }
        }
        else if(msg.event !== undefined && ( typeof msg.event === "string" || typeof msg.event === "number" ) )
        {
            // Сообщение доставленое по id с указанием msg.event
            this.tabSignal.emitAll("msg."+msg.event, result_msg);
            this.tabSignal.emitAll("msg", result_msg)
        }
        else
        {
            // Сообщение доставленое по id без указания msg.event
            this.tabSignal.emitAll("msg", result_msg)
        }

        if(msg.marker)
        {
            this.tabSignal.emitAll(msg.marker, result_msg);
        }

        this.tabSignal.emitAll("comet_server_msg", result_msg);
        return 1;
    };

    /**
     * Вернёт true если хоть одно соединение установлено и активно
     * @return {Boolean}
     */
    this.socketArrayTest = function()
    {
        for(var i = 0; i < this.socketArray.length; i++)
        {
            var socket = this.socketArray[i];
            if(socket &&  socket.readyState === 1)
                return true;
        }

        if(this.LogLevel > 3 ) console.log("[js-api] socketArrayTest:false");
        return false;
    };


    this.messageHistory = [];
    this.isSendErrorReport = false;

    /**
     * Отправляет данные по вебсокету (по первому из списка, и если он не доступен то по второму.)
     * @param {string} data
     * @return {boolean}
     */
    this.socketArraySend = function(data)
    {
        var count = 0;
        for(var i = 0; i < this.socketArray.length; i++)
        {
            var socket = this.socketArray[i];
            if(socket &&  socket.readyState === 1)
            {
                try
                {
                    if(this.messageHistory.length < 1000)
                    {
                        var now = new Date();
                        this.messageHistory.push({data:data, time:now.getTime()})
                    }

                    socket.send(data);
                }
                catch (ex)
                {
                    if(this.LogLevel )
                    {
                        console.log("[js-api] Failed to send data ", data, ex);
                        continue;
                    }
                }

                // Отправлять подписки всем а не первому попавшемуся (тоесть кластер поддержания надёжности а не кластер деления нагрузки) [ От TV seregaTV]
                //return true;
                count++;
            }
        }

        // Отправлять подписки всем а не первому попавшемуся (тоесть кластер поддержания надёжности а не кластер деления нагрузки) [От TV seregaTV]
        if(count) return true;

        return false;
    };

    /**
     * Отправляет все сообщения из очереди на комет сервер.
     * @private
     */
    this.send_msg_from_queue = function()
    {
        var thisObj = this
        if(this.isMaster() === undefined)
        {
            return false;
        }
        else if(this.isMaster() === false)
        {
            // Отправка запроса на отправку сообщения мастервкладке
            if(this.send_msg_subscription !== false)
            {
                this.tabSignal.emitAll('comet_msg_slave_add_subscription_and_restart',this.send_msg_subscription);
                this.send_msg_subscription = false;
            }

            if(this.send_msg_queue.length > 0)
            {
                for(var i = 0; i < this.send_msg_queue.length; i++)
                {
                    this.tabSignal.emitAll('comet_msg_slave_send_msg',this.send_msg_queue[i]);
                }
                this.send_msg_queue = []
            }
            return true;
        }
        else if(this.isMaster())
        {
            if(!this.UseWebSocket())
            {
                return false;
            }

            if(this.socketArrayTest())
            {
                if(this.send_msg_subscription !== false)
                {
                    if(this.LogLevel ) console.error("WebSocket-send-subscription:"+this.send_msg_subscription);
                    this.socketArraySend(this.send_msg_subscription);
                    this.send_msg_subscription = false;
                }

                if(this.send_msg_queue.length > 0)
                {
                    var j = 10;
                    // Отправляет сообщения из очереди не сразу а с 20мс интервалом.
                    for(var i = 0; i < this.send_msg_queue.length; i++)
                    {
                        j+= 20;

                        // Потом убрать setTimeout
                        setTimeout( function(ri)
                        {
                            if(this.LogLevel ) console.log("[js-api] WebSocket-send-msg:", ri);
                            thisObj.socketArraySend(ri);
                        }, j, this.send_msg_queue[i])
                    }
                    this.send_msg_queue = []
                }
                return true;
            }
        }
        return false;
    };

    /**
     * Добавляет сообщения в очередь.
     * @private
     */
    this.add_msg_to_queue = function(msg)
    {
        var MsgType = false;
        MsgType = msg.split("\n");
        MsgType = MsgType[0];

        if(this.LogLevel ) console.log("[js-api] add_msg_to_queue:", msg);
        if(MsgType === "subscription")
        {
            // Проверка если сообщение о подписке на канал то его отправлять вне очереди
            // При этом нет необходимости отправлять предыдущие сообщение подписку.
            this.send_msg_subscription = msg;//.replace(/subscription\n/mg, "");
        }
        else
        {
            this.send_msg_queue.push(msg)
        }
    };

    /**
     * отправка сообщения по веб сокету.
     * @private
     * @param {string} msg Текст сообщения в виде одной строки
     */
    this.send_msg = function(msg)
    {
        if(this.isMaster() === undefined)
        {
            if(this.LogLevel > 3 ) console.log("[js-api] isMaster:undefined");
            this.add_msg_to_queue(msg);
            return false;
        }
        else if(this.isMaster() === false)
        {
            if(this.LogLevel > 3 ) console.log("[js-api] isMaster:false");
            this.tabSignal.emitAll('comet_msg_slave_send_msg',msg);
        }
        else if(this.isMaster())
        {
            if(this.LogLevel > 3 ) console.log("[js-api] isMaster:true");
            if(!this.UseWebSocket())
            {
                console.warn("WebSocket-send-msg: not use");
                return false;
            }

            if(this.socketArrayTest())
            {
                this.send_msg_from_queue();

                if(this.LogLevel > 2 ) console.log("[js-api] WebSocket-send-msg:"+msg);
                this.socketArraySend(msg);
                return true;
            }
            else
            {
                this.add_msg_to_queue(msg);
                return false;
            }
        }
    };

    /**
     * Вернёт true в случаи отправки
     * Отчёт о доставке прийдёт в канал _answer
     * @param {string} pipe_name имя канала, должно начинатся с web_
     * @param {string} event_name имя события в канале
     * @param {string} msg Сообщение
     * @return boolean
     * @version 2
     *
     * @todo добавить в версии 3 колбек на конкретное сообщение.
     */
    this.web_pipe_send = function(pipe_name, event_name, msg)
    {
        if(msg === undefined)
        {
            msg = event_name;
            event_name = "undefined";

            if(/[.]/.test(pipe_name))
            {
                event_name = pipe_name.replace(/^[^.]*\.(.*)$/, "$1");
                pipe_name = pipe_name.replace(/^(.*?)\.(.*)/, "$1");
            }
        }

        if(msg === undefined)
        {
            return false;
        }

        if(!/^web_/.test(pipe_name))
        {
            console.error("Invalid channel name `"+pipe_name+"`. The channel should begin with web_", pipe_name);
            return;
        }

        if(this.LogLevel) console.log(["web_pipe_send", pipe_name, msg]);
        return this.send_msg("web_pipe2\n"+pipe_name+"\n"+event_name+"\n*\n"+JSON.stringify(msg));
    };

    this.getTrackPipeUsers = function(pipe_name, callBack)
    {
        if(!/^track_/.test(pipe_name))
        {
            console.error("Invalid channel name `"+pipe_name+"`. The channel should begin with track_", pipe_name);
            return;
        }

        var marker = this.getCustomString();
        this.subscription_once(marker, callBack);
        /*if(callBack !== undefined)
        {
            this.subscription(pipe_name);
        }*/

        if(this.LogLevel) console.log(["track_pipe_users", pipe_name]);
        return this.send_msg("track_pipe_users\n"+pipe_name+"\n"+marker);
    };

    this.getUserData = function(user_id, callBack)
    {
        if(!user_id || /[^0-9]/.test(user_id))
        {
                console.error("Invalid user_id=`"+user_id+"`. The user_id should is integer");
                return;
        }

        if(callBack === undefined)
            {
                return;
            }

            var marker = this.getCustomString();
            this.subscription_once(marker, callBack);

        if(this.LogLevel) console.log(["user_data", user_id]);
        return this.send_msg("user_data\n"+marker+"\n"+user_id);
    };

    /**
     * Вернёт true в случаи отправки
     * Отчёт о доставке прийдёт в канал _answer
     * @param {string} pipe_name имя канала, должно начинатся с web_
     * @param {string} event_name имя события в канале
     * @param {string} msg Сообщение
     * @param {int} count Количество попыток отправки = 3
     * @param {int} interval Интервал между попытками = 1000
     * @return boolean
     * @version 0.1
     *
     * Отправляет событе в канал count раз с интервалом interval,
     * но гарантирует что максимум одно сообщение будет доставлено и обработанно (минимум 0), а остальные будут отброшены как дубликаты
     */
    this.multi_web_pipe_send = function(pipe_name, event_name, msg, count, interval)
    {
        if(!count)
        {
            count = 3
        }

        if(!interval)
        {
            interval = 1000
        }

        var uuid = "jsapi";
        for(var i = 0; i< 11; i++)
        {
            uuid += "qwertyuiopasdfghjklzxcvbnm1234567890QWERTYUIOPASDFGHJKLZXCVBNM"[Math.floor(Math.random()*62)];
        }

        msg._cometApi_uuid = uuid;

        var thisObj = this
        for(var i = 1; i< count; i++)
        {
            setTimeout(function(pipe_name, event_name, msg){
                thisObj.web_pipe_send(pipe_name, event_name, msg)
            }, i*interval, pipe_name, event_name, msg)
        }

        return this.web_pipe_send(pipe_name, event_name, msg)
    };

    /**
     * Отправляет статистику о использование плагинов
     * @param {string} plugin_name Имя плагина
     * @param {string} plugin_version Версия плагина
     * @param {string} plugin_data Данные плагина
     * @return {Boolean}
     */
    this.sendStatistics = function(plugin_name, plugin_version, plugin_data)
    {
        if(this.LogLevel) console.log(["sendStatistics", plugin_name, plugin_version, plugin_data]);
        return this.send_msg("statistics\n"+JSON.stringify(
                {
                    url:window.location.href,
                    dev_id:this.options.dev_id,
                    version: this.version,
                    plugin: {
                        name:plugin_name,
                        version:plugin_version,
                        data:plugin_data
                    }
                }));
    };


    /**
     * Отправляет запрос на получение истории по каналу pipe_name
     * @param {string} pipe_name
     * @param {function} callBack колбек для ответа от сервера
     * @return {Boolean}
     */
    this.get_pipe_log = function(pipe_name, callBack)
    {
        if(!pipe_name)
        {
            console.trace("In CppComet API in get_pipe_log function argument `pipe_name` is required")
            return false;
        }

        if(!this.UseWebSocket())
        {
            return false;
        }

        var marker = this.getCustomString();
        if(callBack !== undefined)
        {
            this.subscription(pipe_name, callBack);

            //marker = this.getCustomString();
            //this.subscription_once(marker, callBack);
        }

        this.send_msg("pipe_log\n"+pipe_name+"\n"+marker+"\n");
        return true;
    };

    /**
     * Отправляет запрос на получение количества подписчиков в канале pipe_name
     * @param {string} pipe_name
     * @param {function} callBack колбек для ответа от сервера
     * @return {Boolean}
     */
    this.count_users_in_pipe = function(pipe_name, callBack)
    {
        if(!this.UseWebSocket())
        {
            return false;
        }
        var marker = this.getCustomString();
        this.subscription_once(marker, callBack);
        this.send_msg("pipe_count\n"+pipe_name+"\n"+marker+"\n");
        return true;
    };

    /**
     * Вернёт false если мы не подключены к серверу
     * @private
     */
    this.isConnected = function()
    {
        for(var i in this.web_socket_error)
        {
            if(this.web_socket_error[i] == 0)
            {
                return true;
            }
        }
        
        return false;
    };
    
    /**
     * Обеспечивает работу с ссоединением с сервером
     * @private
     */
    this.conect_to_server = function()
    {
        var thisObj = this;

        if(this.in_conect_to_server)
        {
            if(this.LogLevel) console.log("[js-api] Connection to the server is already installed.");
            return;
        }

        if(this.LogLevel) console.log("[js-api] Connecting to the server");
        this.in_conect_to_server = true;
        if(!this.isMaster()) this.setAsMaster();

        if(this.UseWebSocket())
        {
            function initSocket(socket, indexInArr)
            {
                if(!thisObj.time_to_reconect_on_error[indexInArr]) thisObj.time_to_reconect_on_error[indexInArr] = 300;
                if(!thisObj.time_to_reconect_on_close[indexInArr]) thisObj.time_to_reconect_on_close[indexInArr] = 30;
                if(!thisObj.web_socket_error[indexInArr]) thisObj.web_socket_error[indexInArr] = 0;

                socket.onopen = function()
                {
                    if(thisObj.LogLevel) console.log("[js-api] WS Connection established.");

                    if(thisObj.send_msg_subscription === false) thisObj.send_curent_subscription(); // Подписываемся на то что были подписаны до разрыва соединения

                    // Отправка сообщений из очереди.
                    thisObj.send_msg_from_queue();

                    if(thisObj.options.nostat !== true)
                    {
                        setTimeout(function()
                        {
                            if(thisObj.isSendStatisticsData[indexInArr])
                            {
                                return;
                            }

                            thisObj.isSendStatisticsData[indexInArr] = true;
                            // Отправка данных по использованию сервиса
                            thisObj.send_msg("statistics\n"+JSON.stringify({url:window.location.href, dev_id:thisObj.options.dev_id, version: thisObj.version}));
                        }, 5000)
                    }
                };

                socket.onclose = function(event)
                {
                    //this.in_conect_to_server = false;
                    if (event.wasClean || thisObj.in_abort === true)
                    {
                        if(thisObj.LogLevel) console.log("[js-api] WS The connection is closed cleanly");
                    }
                    else
                    {
                        if(thisObj.hasCriticalError[indexInArr])
                        {
                            console.warn('Fatal error, connection impossible.');
                            return;
                        }

                        if(thisObj.LogLevel) console.log("[js-api] WS Connection failure"); // например, "убит" процесс сервера
                        socket.close();
                        thisObj.web_socket_error[indexInArr]++; // Увеличение колва ошибок вебсокетов

                        /*if(thisObj.web_socket_error_timeOut_id !== undefined )
                         {
                         clearTimeout(thisObj.web_socket_error_timeOut_id)
                         }

                         // Если ошибки происходят редко то обнулим сщётчик
                         thisObj.web_socket_error_timeOut_id = setTimeout(function()
                         {
                         thisObj.web_socket_error_timeOut_id = undefined;
                         thisObj.web_socket_error = 0;
                         }, thisObj.time_to_reconect_on_error[indexInArr]*2 )*/

                        if( thisObj.web_socket_error[indexInArr] > 2 && thisObj.web_socket_success !== true && !thisObj.isUseWss())
                        {
                            // Если за время thisObj.web_socket_error_timeOut произошло более 2 ошибок вебсокетов то принудительно включим wss
                            thisObj.UseWss(true);
                            console.warn("There were more than 2 errors in Web sites including encryption"); // Не делать этого если уже были переданы данные по вебсокету
                        }
                        /*else if( thisObj.web_socket_error[indexInArr] > 3 && thisObj.web_socket_success !== true && thisObj.isUseWss())
                         {
                         // Если за время thisObj.web_socket_error_timeOut произошло более 3 ошибок вебсокетов то перейдём на long poling
                         // Такое возможно если человек использует прокси который не поддерживает вебсокеты
                         // Переход произойдёт примерно через 3 секунды работы
                         thisObj.UseWebSocket(false);
                         thisObj.UseWss();
                         console.error("Произошло более 3 ошибок вебсокетов то перейдём на long poling"); // Не делать этого если уже были переданы данные по вебсокету
                         }*/
                        else if(thisObj.web_socket_error[indexInArr] > 5)
                        {
                            // Если 3 ошибки подряд то увеличим время до следующего переподключения
                            thisObj.time_to_reconect_on_error[indexInArr] *= 3;
                        }
                        else if(thisObj.web_socket_error[indexInArr] > 3)
                        {
                            // Если 5 ошибок подряд то ещё больше увеличим время до следующего переподключения
                            thisObj.time_to_reconect_on_error[indexInArr] += 2000;
                        }

                        if(thisObj.web_socket_error[indexInArr] === 0)
                        {
                            // Если это первый обрыв соединения подряд то переподключаемся быстрее
                            setTimeout(function()
                            {
                                //thisObj.conect_to_server();
                                var conect = function()
                                {
                                    if(navigator.onLine === false)
                                    {
                                        setTimeout(conect, 300);
                                        return;
                                    }

                                    var node = thisObj.options.nodeArray[indexInArr];
                                    var socket = new WebSocket(thisObj.getUrl(node));

                                    thisObj.socketArray[indexInArr] = socket;
                                    initSocket(socket, indexInArr);
                                };

                                conect()
                            }, thisObj.time_to_reconect_on_close[indexInArr] );
                        }
                        else
                        {
                            // Если это не первый обрыв соединения подряд но данные уже отправлялись то отправляем отчёт об ошибке
                            if(thisObj.web_socket_success == true)
                            {
                                //thisObj.errorReportSend();
                            }

                            // Если это не первый обрыв соединения подряд то переподключаемся не сразу
                            setTimeout(function()
                            {
                                var conect = function()
                                {
                                    if(navigator.onLine === false)
                                    {
                                        setTimeout(conect, 300);
                                        return;
                                    }

                                    //thisObj.conect_to_server();
                                    var node = thisObj.options.nodeArray[indexInArr];
                                    var socket = new WebSocket(thisObj.getUrl(node));

                                    thisObj.socketArray[indexInArr] = socket;
                                    initSocket(socket, indexInArr);
                                };

                                conect()
                            }, thisObj.time_to_reconect_on_error[indexInArr] );
                        }
                    }
                    if(thisObj.LogLevel) console.log("[js-api] WS Code: " + event.code + " reason: " + event.reason);
                };

                socket.onmessage = function(event)
                {
                    thisObj.web_socket_success = true;
                    thisObj.web_socket_error[indexInArr] = 0;               // Если успешно подключились сбрасываем сщётчик ошибок
                    thisObj.time_to_reconect_on_error[indexInArr] = 1000;   // Если успешно подключились сбрасываем сщётчик ошибок

                    if(thisObj.LogLevel > 1) console.log("[js-api] \x1b[1;32mWS Incoming message\x1b[0m:"+event.data);
                    var lineArray = event.data.replace(/^\s+|\s+$/, '').split("\n");
                    for(var i = 0; i < lineArray.length; i++)
                    {
                        var rj = {};
                        try{
                            rj = JSON.parse(lineArray[i].replace(/\\'/g, "'"));
                        }
                        catch (failed)
                        {
                            if(thisObj.LogLevel) console.error(failed);
                            continue;
                        }

                        thisObj.msg_cultivate(rj, indexInArr);
                    }
                };

                socket.onerror = function(error)
                {
                    //thisObj.in_conect_to_server = false;
                    if(thisObj.LogLevel) console.log("[js-api] Error " + error.message);

                };
            }

            thisObj.socketArray = [];
            var random_node = thisObj.options.user_id % thisObj.options.nodeArray.length;
            if(!random_node)
            {
                random_node = Math.floor(Math.random()*thisObj.options.nodeArray.length)
            }

            for(var i = 0; i < thisObj.options.nodeArray.length; i++)
            {
                if(thisObj.hasCriticalError[i])
                {
                    // Если true то произошла критическая ошибка после которой нет смысла подключатся к серверу
                    continue;
                }


                if(thisObj.options.roundrobin == true && random_node != i)
                {
                    // Если есть опция roundrobin то подключатся будем только к одной ноде на основе своего user_id или случайной ноде если user_id не задан.
                    continue;
                }

                var node = thisObj.options.nodeArray[i];

                // console.log("[js-api] conect to " + thisObj.getUrl(node))
                var socket = new window.WebSocket(thisObj.getUrl(node));

                thisObj.socketArray.push(socket);
                initSocket(socket, thisObj.socketArray.length -  1 );
            }
        }
        else
        {
            try {
                thisObj.request = new XMLHttpRequest();
            } catch (trymicrosoft) {
                try {
                    thisObj.request = new ActiveXObject("Msxml2.XMLHTTP");
                } catch (othermicrosoft) {
                    try {
                        thisObj.request = new ActiveXObject("Microsoft.XMLHTTP");
                    } catch (failed) {
                        thisObj.request = false;
                    }
                }
            }

            thisObj.request.onreadystatechange = function()
            {
                if( thisObj.request.status === 200 && thisObj.in_abort !== true)
                {
                    var re = thisObj.request.responseText;

                    if(thisObj.LogLevel) console.log("[js-api] Incoming message:"+re);
                    var lineArray = re.replace(/^\s+|\s+$/, '').split('\n');
                    for(var i = 0; i < lineArray; i++)
                    {
                        try{
                            if(thisObj.LogLevel) console.log(lineArray[i]);
                            var rj = JSON.parse(lineArray[i])
                        }
                        catch (failed)
                        {
                            thisObj.in_conect_to_server = false;
                            if(thisObj.LogLevel) console.log("[js-api] Error in xhr, reconnection via "+(thisObj.time_to_reconect_on_error[0]) +" seconds.");
                            setTimeout(function(){thisObj.conect_to_server()}, thisObj.time_to_reconect_on_error[0] );
                            return false;
                        }


                        thisObj.msg_cultivate(rj)
                    }

                    thisObj.in_conect_to_server = false;
                    thisObj.conect_to_server();
                }
                else
                {
                    thisObj.in_conect_to_server = false;
                    if(thisObj.in_abort !== true)
                    {
                        thisObj.xhr_error += 1;
                        if( thisObj.xhr_error > 30 )
                        {
                            thisObj.time_to_reconect_on_error[0] = 90000;
                        }
                        else if( thisObj.xhr_error > 10 )
                        {
                            thisObj.time_to_reconect_on_error[0] = 30000;
                        }
                        else if( thisObj.xhr_error > 3 )
                        {
                            thisObj.time_to_reconect_on_error[0] = 10000;
                        }

                        if(thisObj.LogLevel || 1) console.log("[js-api] Error in xhr, reconnection via "+(thisObj.time_to_reconect_on_error[0]) +" seconds.");
                        setTimeout(function(){ thisObj.conect_to_server() }, thisObj.time_to_reconect_on_error[0] );

                        setTimeout(function(){ thisObj.xhr_error = 0 }, thisObj.xhr_error_timeOut_id )
                    }
                }
            };

            thisObj.request.open("POST", thisObj.getUrl(), true);
            thisObj.request.send(thisObj.subscription_array.join("\n")); // Именно здесь отправляются данные
        }

    };

    /**
     * Пытается установить соединение с сервером или наладить обмен сообщениями и мониторинг работоспособности мастервкладки.
     * @private
     */
    this.conect = function(callback)
    {
        if(this.isMaster())
        {
            return this.conect_to_server();
        }

        if(this.in_try_conect)
        {
            if(this.LogLevel) console.log("[js-api] The connection to the server is already installed on another tab");
            this.tabSignal.emitAll('comet_msg_slave_signal_start');
            return false;
        }

        this.in_try_conect = true;
        if(this.LogLevel) console.log("[js-api] Trying to connect to the server");

        this.setAsSlave(callback)
    };

    return this;
};
var cometServerApi = _cometServerApi

/**
 * Api работы с комет серевером comet-server.ru
 * @type cometServerApi
 */
var cometApi = new cometServerApi();


/**
 * @return _cometServerApi
 */
function CometServer()
{
    return cometApi; //Object.assign({}, _cometServerApi);
}

emptyInformers = false;
Bc.menuInformer = {
	ajaxing: false,

	onLoad: function () {

		var t = this;

		//this.updateInformer();

		//setInterval(
		//	function() {
		//		t.updateInformer()
		//	},
		//	30000
		//);
	},

	updateInformer: function() {
        var t = this;

		if (
			!Bico.isBrowserTabActive() ||
			t.ajaxing
		) {
			return;
		}

		t.ajaxing = true;
		$.ajax({
			url: '/tc/informer/ajax-get-menu-informer/',
			type: 'POST',
			data: {},
			success: function (data) {

				t.ajaxing = false;

				if (data != null && data['status'] == 'ok') {
					Bc.menuInformer.resetMenuInformers();
					if (Object.keys(data.data).length > 0) {

						Bc.menuInformer.resetMenuInformers();
						Bc.menuInformer.buildInformers(data.data);

					} else {
						emptyInformers = true;
					}
				}
			}
		});
	},

	buildInformers: function (informers) {
		$.each(informers, function(index, count){
			if (parseInt(count) != 0) {
				$('#tcMenuInformer-' + index).show();
				$('#tcMenuInformer-' + index).parents('.has-informer-parent').addClass('has-informer-counter');
				$('#tcMenuInformer-' + index + ' .js-menu-informer-count').text(count);
			}
		});
	},
	
	resetMenuInformers: function () {
		$('.has-informer-counter').removeClass('has-informer-counter');
		$('.js-menu-informer-wraper').hide();
	},

	markMenuInformerIsWathed: function (employeeId, entity) {
		var ajaxData = {
			'employeeId': employeeId,
			'entity': entity
		};
		$.ajax({
			url: '/tc/informer/ajax-reset-menu-informer/',
			type: 'POST',
			data: ajaxData,
			success: function (data) {
				if (data != null && data['status'] == 'ok') {
					if (Object.keys(data.data).length > 0) {
						// Bc.menuInformer.onLoad();
					} else {
						emptyInformers = true;
					}
				}
			}
		});
	}
};

$(document).ready(function(){
	Bc.menuInformer.onLoad();
});
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.moment=t()}(this,function(){"use strict";var e,i;function c(){return e.apply(null,arguments)}function o(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function u(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function l(e){return void 0===e}function d(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function h(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function f(e,t){var n,s=[];for(n=0;n<e.length;++n)s.push(t(e[n],n));return s}function m(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function _(e,t){for(var n in t)m(t,n)&&(e[n]=t[n]);return m(t,"toString")&&(e.toString=t.toString),m(t,"valueOf")&&(e.valueOf=t.valueOf),e}function y(e,t,n,s){return Ot(e,t,n,s,!0).utc()}function g(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function p(e){if(null==e._isValid){var t=g(e),n=i.call(t.parsedDateParts,function(e){return null!=e}),s=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&n);if(e._strict&&(s=s&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return s;e._isValid=s}return e._isValid}function v(e){var t=y(NaN);return null!=e?_(g(t),e):g(t).userInvalidated=!0,t}i=Array.prototype.some?Array.prototype.some:function(e){for(var t=Object(this),n=t.length>>>0,s=0;s<n;s++)if(s in t&&e.call(this,t[s],s,t))return!0;return!1};var r=c.momentProperties=[];function w(e,t){var n,s,i;if(l(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),l(t._i)||(e._i=t._i),l(t._f)||(e._f=t._f),l(t._l)||(e._l=t._l),l(t._strict)||(e._strict=t._strict),l(t._tzm)||(e._tzm=t._tzm),l(t._isUTC)||(e._isUTC=t._isUTC),l(t._offset)||(e._offset=t._offset),l(t._pf)||(e._pf=g(t)),l(t._locale)||(e._locale=t._locale),0<r.length)for(n=0;n<r.length;n++)l(i=t[s=r[n]])||(e[s]=i);return e}var t=!1;function M(e){w(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===t&&(t=!0,c.updateOffset(this),t=!1)}function S(e){return e instanceof M||null!=e&&null!=e._isAMomentObject}function D(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function k(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=D(t)),n}function a(e,t,n){var s,i=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),a=0;for(s=0;s<i;s++)(n&&e[s]!==t[s]||!n&&k(e[s])!==k(t[s]))&&a++;return a+r}function Y(e){!1===c.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function n(i,r){var a=!0;return _(function(){if(null!=c.deprecationHandler&&c.deprecationHandler(null,i),a){for(var e,t=[],n=0;n<arguments.length;n++){if(e="","object"==typeof arguments[n]){for(var s in e+="\n["+n+"] ",arguments[0])e+=s+": "+arguments[0][s]+", ";e=e.slice(0,-2)}else e=arguments[n];t.push(e)}Y(i+"\nArguments: "+Array.prototype.slice.call(t).join("")+"\n"+(new Error).stack),a=!1}return r.apply(this,arguments)},r)}var s,O={};function T(e,t){null!=c.deprecationHandler&&c.deprecationHandler(e,t),O[e]||(Y(t),O[e]=!0)}function x(e){return e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function b(e,t){var n,s=_({},e);for(n in t)m(t,n)&&(u(e[n])&&u(t[n])?(s[n]={},_(s[n],e[n]),_(s[n],t[n])):null!=t[n]?s[n]=t[n]:delete s[n]);for(n in e)m(e,n)&&!m(t,n)&&u(e[n])&&(s[n]=_({},s[n]));return s}function P(e){null!=e&&this.set(e)}c.suppressDeprecationWarnings=!1,c.deprecationHandler=null,s=Object.keys?Object.keys:function(e){var t,n=[];for(t in e)m(e,t)&&n.push(t);return n};var W={};function H(e,t){var n=e.toLowerCase();W[n]=W[n+"s"]=W[t]=e}function R(e){return"string"==typeof e?W[e]||W[e.toLowerCase()]:void 0}function C(e){var t,n,s={};for(n in e)m(e,n)&&(t=R(n))&&(s[t]=e[n]);return s}var F={};function L(e,t){F[e]=t}function U(e,t,n){var s=""+Math.abs(e),i=t-s.length;return(0<=e?n?"+":"":"-")+Math.pow(10,Math.max(0,i)).toString().substr(1)+s}var N=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,G=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,V={},E={};function I(e,t,n,s){var i=s;"string"==typeof s&&(i=function(){return this[s]()}),e&&(E[e]=i),t&&(E[t[0]]=function(){return U(i.apply(this,arguments),t[1],t[2])}),n&&(E[n]=function(){return this.localeData().ordinal(i.apply(this,arguments),e)})}function A(e,t){return e.isValid()?(t=j(t,e.localeData()),V[t]=V[t]||function(s){var e,i,t,r=s.match(N);for(e=0,i=r.length;e<i;e++)E[r[e]]?r[e]=E[r[e]]:r[e]=(t=r[e]).match(/\[[\s\S]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"");return function(e){var t,n="";for(t=0;t<i;t++)n+=x(r[t])?r[t].call(e,s):r[t];return n}}(t),V[t](e)):e.localeData().invalidDate()}function j(e,t){var n=5;function s(e){return t.longDateFormat(e)||e}for(G.lastIndex=0;0<=n&&G.test(e);)e=e.replace(G,s),G.lastIndex=0,n-=1;return e}var Z=/\d/,z=/\d\d/,$=/\d{3}/,q=/\d{4}/,J=/[+-]?\d{6}/,B=/\d\d?/,Q=/\d\d\d\d?/,X=/\d\d\d\d\d\d?/,K=/\d{1,3}/,ee=/\d{1,4}/,te=/[+-]?\d{1,6}/,ne=/\d+/,se=/[+-]?\d+/,ie=/Z|[+-]\d\d:?\d\d/gi,re=/Z|[+-]\d\d(?::?\d\d)?/gi,ae=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,oe={};function ue(e,n,s){oe[e]=x(n)?n:function(e,t){return e&&s?s:n}}function le(e,t){return m(oe,e)?oe[e](t._strict,t._locale):new RegExp(de(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,s,i){return t||n||s||i})))}function de(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var he={};function ce(e,n){var t,s=n;for("string"==typeof e&&(e=[e]),d(n)&&(s=function(e,t){t[n]=k(e)}),t=0;t<e.length;t++)he[e[t]]=s}function fe(e,i){ce(e,function(e,t,n,s){n._w=n._w||{},i(e,n._w,n,s)})}var me=0,_e=1,ye=2,ge=3,pe=4,ve=5,we=6,Me=7,Se=8;function De(e){return ke(e)?366:365}function ke(e){return e%4==0&&e%100!=0||e%400==0}I("Y",0,0,function(){var e=this.year();return e<=9999?""+e:"+"+e}),I(0,["YY",2],0,function(){return this.year()%100}),I(0,["YYYY",4],0,"year"),I(0,["YYYYY",5],0,"year"),I(0,["YYYYYY",6,!0],0,"year"),H("year","y"),L("year",1),ue("Y",se),ue("YY",B,z),ue("YYYY",ee,q),ue("YYYYY",te,J),ue("YYYYYY",te,J),ce(["YYYYY","YYYYYY"],me),ce("YYYY",function(e,t){t[me]=2===e.length?c.parseTwoDigitYear(e):k(e)}),ce("YY",function(e,t){t[me]=c.parseTwoDigitYear(e)}),ce("Y",function(e,t){t[me]=parseInt(e,10)}),c.parseTwoDigitYear=function(e){return k(e)+(68<k(e)?1900:2e3)};var Ye,Oe=Te("FullYear",!0);function Te(t,n){return function(e){return null!=e?(be(this,t,e),c.updateOffset(this,n),this):xe(this,t)}}function xe(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function be(e,t,n){e.isValid()&&!isNaN(n)&&("FullYear"===t&&ke(e.year())&&1===e.month()&&29===e.date()?e._d["set"+(e._isUTC?"UTC":"")+t](n,e.month(),Pe(n,e.month())):e._d["set"+(e._isUTC?"UTC":"")+t](n))}function Pe(e,t){if(isNaN(e)||isNaN(t))return NaN;var n,s=(t%(n=12)+n)%n;return e+=(t-s)/12,1===s?ke(e)?29:28:31-s%7%2}Ye=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},I("M",["MM",2],"Mo",function(){return this.month()+1}),I("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),I("MMMM",0,0,function(e){return this.localeData().months(this,e)}),H("month","M"),L("month",8),ue("M",B),ue("MM",B,z),ue("MMM",function(e,t){return t.monthsShortRegex(e)}),ue("MMMM",function(e,t){return t.monthsRegex(e)}),ce(["M","MM"],function(e,t){t[_e]=k(e)-1}),ce(["MMM","MMMM"],function(e,t,n,s){var i=n._locale.monthsParse(e,s,n._strict);null!=i?t[_e]=i:g(n).invalidMonth=e});var We=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,He="January_February_March_April_May_June_July_August_September_October_November_December".split("_");var Re="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function Ce(e,t){var n;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=k(t);else if(!d(t=e.localeData().monthsParse(t)))return e;return n=Math.min(e.date(),Pe(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e}function Fe(e){return null!=e?(Ce(this,e),c.updateOffset(this,!0),this):xe(this,"Month")}var Le=ae;var Ue=ae;function Ne(){function e(e,t){return t.length-e.length}var t,n,s=[],i=[],r=[];for(t=0;t<12;t++)n=y([2e3,t]),s.push(this.monthsShort(n,"")),i.push(this.months(n,"")),r.push(this.months(n,"")),r.push(this.monthsShort(n,""));for(s.sort(e),i.sort(e),r.sort(e),t=0;t<12;t++)s[t]=de(s[t]),i[t]=de(i[t]);for(t=0;t<24;t++)r[t]=de(r[t]);this._monthsRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+s.join("|")+")","i")}function Ge(e){var t=new Date(Date.UTC.apply(null,arguments));return e<100&&0<=e&&isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e),t}function Ve(e,t,n){var s=7+t-n;return-((7+Ge(e,0,s).getUTCDay()-t)%7)+s-1}function Ee(e,t,n,s,i){var r,a,o=1+7*(t-1)+(7+n-s)%7+Ve(e,s,i);return o<=0?a=De(r=e-1)+o:o>De(e)?(r=e+1,a=o-De(e)):(r=e,a=o),{year:r,dayOfYear:a}}function Ie(e,t,n){var s,i,r=Ve(e.year(),t,n),a=Math.floor((e.dayOfYear()-r-1)/7)+1;return a<1?s=a+Ae(i=e.year()-1,t,n):a>Ae(e.year(),t,n)?(s=a-Ae(e.year(),t,n),i=e.year()+1):(i=e.year(),s=a),{week:s,year:i}}function Ae(e,t,n){var s=Ve(e,t,n),i=Ve(e+1,t,n);return(De(e)-s+i)/7}I("w",["ww",2],"wo","week"),I("W",["WW",2],"Wo","isoWeek"),H("week","w"),H("isoWeek","W"),L("week",5),L("isoWeek",5),ue("w",B),ue("ww",B,z),ue("W",B),ue("WW",B,z),fe(["w","ww","W","WW"],function(e,t,n,s){t[s.substr(0,1)]=k(e)});I("d",0,"do","day"),I("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),I("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),I("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),I("e",0,0,"weekday"),I("E",0,0,"isoWeekday"),H("day","d"),H("weekday","e"),H("isoWeekday","E"),L("day",11),L("weekday",11),L("isoWeekday",11),ue("d",B),ue("e",B),ue("E",B),ue("dd",function(e,t){return t.weekdaysMinRegex(e)}),ue("ddd",function(e,t){return t.weekdaysShortRegex(e)}),ue("dddd",function(e,t){return t.weekdaysRegex(e)}),fe(["dd","ddd","dddd"],function(e,t,n,s){var i=n._locale.weekdaysParse(e,s,n._strict);null!=i?t.d=i:g(n).invalidWeekday=e}),fe(["d","e","E"],function(e,t,n,s){t[s]=k(e)});var je="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_");var Ze="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_");var ze="Su_Mo_Tu_We_Th_Fr_Sa".split("_");var $e=ae;var qe=ae;var Je=ae;function Be(){function e(e,t){return t.length-e.length}var t,n,s,i,r,a=[],o=[],u=[],l=[];for(t=0;t<7;t++)n=y([2e3,1]).day(t),s=this.weekdaysMin(n,""),i=this.weekdaysShort(n,""),r=this.weekdays(n,""),a.push(s),o.push(i),u.push(r),l.push(s),l.push(i),l.push(r);for(a.sort(e),o.sort(e),u.sort(e),l.sort(e),t=0;t<7;t++)o[t]=de(o[t]),u[t]=de(u[t]),l[t]=de(l[t]);this._weekdaysRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+u.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+o.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+a.join("|")+")","i")}function Qe(){return this.hours()%12||12}function Xe(e,t){I(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function Ke(e,t){return t._meridiemParse}I("H",["HH",2],0,"hour"),I("h",["hh",2],0,Qe),I("k",["kk",2],0,function(){return this.hours()||24}),I("hmm",0,0,function(){return""+Qe.apply(this)+U(this.minutes(),2)}),I("hmmss",0,0,function(){return""+Qe.apply(this)+U(this.minutes(),2)+U(this.seconds(),2)}),I("Hmm",0,0,function(){return""+this.hours()+U(this.minutes(),2)}),I("Hmmss",0,0,function(){return""+this.hours()+U(this.minutes(),2)+U(this.seconds(),2)}),Xe("a",!0),Xe("A",!1),H("hour","h"),L("hour",13),ue("a",Ke),ue("A",Ke),ue("H",B),ue("h",B),ue("k",B),ue("HH",B,z),ue("hh",B,z),ue("kk",B,z),ue("hmm",Q),ue("hmmss",X),ue("Hmm",Q),ue("Hmmss",X),ce(["H","HH"],ge),ce(["k","kk"],function(e,t,n){var s=k(e);t[ge]=24===s?0:s}),ce(["a","A"],function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e}),ce(["h","hh"],function(e,t,n){t[ge]=k(e),g(n).bigHour=!0}),ce("hmm",function(e,t,n){var s=e.length-2;t[ge]=k(e.substr(0,s)),t[pe]=k(e.substr(s)),g(n).bigHour=!0}),ce("hmmss",function(e,t,n){var s=e.length-4,i=e.length-2;t[ge]=k(e.substr(0,s)),t[pe]=k(e.substr(s,2)),t[ve]=k(e.substr(i)),g(n).bigHour=!0}),ce("Hmm",function(e,t,n){var s=e.length-2;t[ge]=k(e.substr(0,s)),t[pe]=k(e.substr(s))}),ce("Hmmss",function(e,t,n){var s=e.length-4,i=e.length-2;t[ge]=k(e.substr(0,s)),t[pe]=k(e.substr(s,2)),t[ve]=k(e.substr(i))});var et,tt=Te("Hours",!0),nt={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:He,monthsShort:Re,week:{dow:0,doy:6},weekdays:je,weekdaysMin:ze,weekdaysShort:Ze,meridiemParse:/[ap]\.?m?\.?/i},st={},it={};function rt(e){return e?e.toLowerCase().replace("_","-"):e}function at(e){var t=null;if(!st[e]&&"undefined"!=typeof module&&module&&module.exports)try{t=et._abbr,require("./locale/"+e),ot(t)}catch(e){}return st[e]}function ot(e,t){var n;return e&&((n=l(t)?lt(e):ut(e,t))?et=n:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),et._abbr}function ut(e,t){if(null!==t){var n,s=nt;if(t.abbr=e,null!=st[e])T("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),s=st[e]._config;else if(null!=t.parentLocale)if(null!=st[t.parentLocale])s=st[t.parentLocale]._config;else{if(null==(n=at(t.parentLocale)))return it[t.parentLocale]||(it[t.parentLocale]=[]),it[t.parentLocale].push({name:e,config:t}),null;s=n._config}return st[e]=new P(b(s,t)),it[e]&&it[e].forEach(function(e){ut(e.name,e.config)}),ot(e),st[e]}return delete st[e],null}function lt(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return et;if(!o(e)){if(t=at(e))return t;e=[e]}return function(e){for(var t,n,s,i,r=0;r<e.length;){for(t=(i=rt(e[r]).split("-")).length,n=(n=rt(e[r+1]))?n.split("-"):null;0<t;){if(s=at(i.slice(0,t).join("-")))return s;if(n&&n.length>=t&&a(i,n,!0)>=t-1)break;t--}r++}return et}(e)}function dt(e){var t,n=e._a;return n&&-2===g(e).overflow&&(t=n[_e]<0||11<n[_e]?_e:n[ye]<1||n[ye]>Pe(n[me],n[_e])?ye:n[ge]<0||24<n[ge]||24===n[ge]&&(0!==n[pe]||0!==n[ve]||0!==n[we])?ge:n[pe]<0||59<n[pe]?pe:n[ve]<0||59<n[ve]?ve:n[we]<0||999<n[we]?we:-1,g(e)._overflowDayOfYear&&(t<me||ye<t)&&(t=ye),g(e)._overflowWeeks&&-1===t&&(t=Me),g(e)._overflowWeekday&&-1===t&&(t=Se),g(e).overflow=t),e}function ht(e,t,n){return null!=e?e:null!=t?t:n}function ct(e){var t,n,s,i,r,a=[];if(!e._d){var o,u;for(o=e,u=new Date(c.now()),s=o._useUTC?[u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()]:[u.getFullYear(),u.getMonth(),u.getDate()],e._w&&null==e._a[ye]&&null==e._a[_e]&&function(e){var t,n,s,i,r,a,o,u;if(null!=(t=e._w).GG||null!=t.W||null!=t.E)r=1,a=4,n=ht(t.GG,e._a[me],Ie(Tt(),1,4).year),s=ht(t.W,1),((i=ht(t.E,1))<1||7<i)&&(u=!0);else{r=e._locale._week.dow,a=e._locale._week.doy;var l=Ie(Tt(),r,a);n=ht(t.gg,e._a[me],l.year),s=ht(t.w,l.week),null!=t.d?((i=t.d)<0||6<i)&&(u=!0):null!=t.e?(i=t.e+r,(t.e<0||6<t.e)&&(u=!0)):i=r}s<1||s>Ae(n,r,a)?g(e)._overflowWeeks=!0:null!=u?g(e)._overflowWeekday=!0:(o=Ee(n,s,i,r,a),e._a[me]=o.year,e._dayOfYear=o.dayOfYear)}(e),null!=e._dayOfYear&&(r=ht(e._a[me],s[me]),(e._dayOfYear>De(r)||0===e._dayOfYear)&&(g(e)._overflowDayOfYear=!0),n=Ge(r,0,e._dayOfYear),e._a[_e]=n.getUTCMonth(),e._a[ye]=n.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=a[t]=s[t];for(;t<7;t++)e._a[t]=a[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[ge]&&0===e._a[pe]&&0===e._a[ve]&&0===e._a[we]&&(e._nextDay=!0,e._a[ge]=0),e._d=(e._useUTC?Ge:function(e,t,n,s,i,r,a){var o=new Date(e,t,n,s,i,r,a);return e<100&&0<=e&&isFinite(o.getFullYear())&&o.setFullYear(e),o}).apply(null,a),i=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[ge]=24),e._w&&void 0!==e._w.d&&e._w.d!==i&&(g(e).weekdayMismatch=!0)}}var ft=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,mt=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,_t=/Z|[+-]\d\d(?::?\d\d)?/,yt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],gt=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],pt=/^\/?Date\((\-?\d+)/i;function vt(e){var t,n,s,i,r,a,o=e._i,u=ft.exec(o)||mt.exec(o);if(u){for(g(e).iso=!0,t=0,n=yt.length;t<n;t++)if(yt[t][1].exec(u[1])){i=yt[t][0],s=!1!==yt[t][2];break}if(null==i)return void(e._isValid=!1);if(u[3]){for(t=0,n=gt.length;t<n;t++)if(gt[t][1].exec(u[3])){r=(u[2]||" ")+gt[t][0];break}if(null==r)return void(e._isValid=!1)}if(!s&&null!=r)return void(e._isValid=!1);if(u[4]){if(!_t.exec(u[4]))return void(e._isValid=!1);a="Z"}e._f=i+(r||"")+(a||""),kt(e)}else e._isValid=!1}var wt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;function Mt(e,t,n,s,i,r){var a=[function(e){var t=parseInt(e,10);{if(t<=49)return 2e3+t;if(t<=999)return 1900+t}return t}(e),Re.indexOf(t),parseInt(n,10),parseInt(s,10),parseInt(i,10)];return r&&a.push(parseInt(r,10)),a}var St={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Dt(e){var t,n,s,i=wt.exec(e._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));if(i){var r=Mt(i[4],i[3],i[2],i[5],i[6],i[7]);if(t=i[1],n=r,s=e,t&&Ze.indexOf(t)!==new Date(n[0],n[1],n[2]).getDay()&&(g(s).weekdayMismatch=!0,!(s._isValid=!1)))return;e._a=r,e._tzm=function(e,t,n){if(e)return St[e];if(t)return 0;var s=parseInt(n,10),i=s%100;return(s-i)/100*60+i}(i[8],i[9],i[10]),e._d=Ge.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),g(e).rfc2822=!0}else e._isValid=!1}function kt(e){if(e._f!==c.ISO_8601)if(e._f!==c.RFC_2822){e._a=[],g(e).empty=!0;var t,n,s,i,r,a,o,u,l=""+e._i,d=l.length,h=0;for(s=j(e._f,e._locale).match(N)||[],t=0;t<s.length;t++)i=s[t],(n=(l.match(le(i,e))||[])[0])&&(0<(r=l.substr(0,l.indexOf(n))).length&&g(e).unusedInput.push(r),l=l.slice(l.indexOf(n)+n.length),h+=n.length),E[i]?(n?g(e).empty=!1:g(e).unusedTokens.push(i),a=i,u=e,null!=(o=n)&&m(he,a)&&he[a](o,u._a,u,a)):e._strict&&!n&&g(e).unusedTokens.push(i);g(e).charsLeftOver=d-h,0<l.length&&g(e).unusedInput.push(l),e._a[ge]<=12&&!0===g(e).bigHour&&0<e._a[ge]&&(g(e).bigHour=void 0),g(e).parsedDateParts=e._a.slice(0),g(e).meridiem=e._meridiem,e._a[ge]=function(e,t,n){var s;if(null==n)return t;return null!=e.meridiemHour?e.meridiemHour(t,n):(null!=e.isPM&&((s=e.isPM(n))&&t<12&&(t+=12),s||12!==t||(t=0)),t)}(e._locale,e._a[ge],e._meridiem),ct(e),dt(e)}else Dt(e);else vt(e)}function Yt(e){var t,n,s,i,r=e._i,a=e._f;return e._locale=e._locale||lt(e._l),null===r||void 0===a&&""===r?v({nullInput:!0}):("string"==typeof r&&(e._i=r=e._locale.preparse(r)),S(r)?new M(dt(r)):(h(r)?e._d=r:o(a)?function(e){var t,n,s,i,r;if(0===e._f.length)return g(e).invalidFormat=!0,e._d=new Date(NaN);for(i=0;i<e._f.length;i++)r=0,t=w({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[i],kt(t),p(t)&&(r+=g(t).charsLeftOver,r+=10*g(t).unusedTokens.length,g(t).score=r,(null==s||r<s)&&(s=r,n=t));_(e,n||t)}(e):a?kt(e):l(n=(t=e)._i)?t._d=new Date(c.now()):h(n)?t._d=new Date(n.valueOf()):"string"==typeof n?(s=t,null===(i=pt.exec(s._i))?(vt(s),!1===s._isValid&&(delete s._isValid,Dt(s),!1===s._isValid&&(delete s._isValid,c.createFromInputFallback(s)))):s._d=new Date(+i[1])):o(n)?(t._a=f(n.slice(0),function(e){return parseInt(e,10)}),ct(t)):u(n)?function(e){if(!e._d){var t=C(e._i);e._a=f([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),ct(e)}}(t):d(n)?t._d=new Date(n):c.createFromInputFallback(t),p(e)||(e._d=null),e))}function Ot(e,t,n,s,i){var r,a={};return!0!==n&&!1!==n||(s=n,n=void 0),(u(e)&&function(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0}(e)||o(e)&&0===e.length)&&(e=void 0),a._isAMomentObject=!0,a._useUTC=a._isUTC=i,a._l=n,a._i=e,a._f=t,a._strict=s,(r=new M(dt(Yt(a))))._nextDay&&(r.add(1,"d"),r._nextDay=void 0),r}function Tt(e,t,n,s){return Ot(e,t,n,s,!1)}c.createFromInputFallback=n("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),c.ISO_8601=function(){},c.RFC_2822=function(){};var xt=n("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Tt.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:v()}),bt=n("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Tt.apply(null,arguments);return this.isValid()&&e.isValid()?this<e?this:e:v()});function Pt(e,t){var n,s;if(1===t.length&&o(t[0])&&(t=t[0]),!t.length)return Tt();for(n=t[0],s=1;s<t.length;++s)t[s].isValid()&&!t[s][e](n)||(n=t[s]);return n}var Wt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Ht(e){var t=C(e),n=t.year||0,s=t.quarter||0,i=t.month||0,r=t.week||0,a=t.day||0,o=t.hour||0,u=t.minute||0,l=t.second||0,d=t.millisecond||0;this._isValid=function(e){for(var t in e)if(-1===Ye.call(Wt,t)||null!=e[t]&&isNaN(e[t]))return!1;for(var n=!1,s=0;s<Wt.length;++s)if(e[Wt[s]]){if(n)return!1;parseFloat(e[Wt[s]])!==k(e[Wt[s]])&&(n=!0)}return!0}(t),this._milliseconds=+d+1e3*l+6e4*u+1e3*o*60*60,this._days=+a+7*r,this._months=+i+3*s+12*n,this._data={},this._locale=lt(),this._bubble()}function Rt(e){return e instanceof Ht}function Ct(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function Ft(e,n){I(e,0,0,function(){var e=this.utcOffset(),t="+";return e<0&&(e=-e,t="-"),t+U(~~(e/60),2)+n+U(~~e%60,2)})}Ft("Z",":"),Ft("ZZ",""),ue("Z",re),ue("ZZ",re),ce(["Z","ZZ"],function(e,t,n){n._useUTC=!0,n._tzm=Ut(re,e)});var Lt=/([\+\-]|\d\d)/gi;function Ut(e,t){var n=(t||"").match(e);if(null===n)return null;var s=((n[n.length-1]||[])+"").match(Lt)||["-",0,0],i=60*s[1]+k(s[2]);return 0===i?0:"+"===s[0]?i:-i}function Nt(e,t){var n,s;return t._isUTC?(n=t.clone(),s=(S(e)||h(e)?e.valueOf():Tt(e).valueOf())-n.valueOf(),n._d.setTime(n._d.valueOf()+s),c.updateOffset(n,!1),n):Tt(e).local()}function Gt(e){return 15*-Math.round(e._d.getTimezoneOffset()/15)}function Vt(){return!!this.isValid()&&(this._isUTC&&0===this._offset)}c.updateOffset=function(){};var Et=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,It=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function At(e,t){var n,s,i,r=e,a=null;return Rt(e)?r={ms:e._milliseconds,d:e._days,M:e._months}:d(e)?(r={},t?r[t]=e:r.milliseconds=e):(a=Et.exec(e))?(n="-"===a[1]?-1:1,r={y:0,d:k(a[ye])*n,h:k(a[ge])*n,m:k(a[pe])*n,s:k(a[ve])*n,ms:k(Ct(1e3*a[we]))*n}):(a=It.exec(e))?(n="-"===a[1]?-1:(a[1],1),r={y:jt(a[2],n),M:jt(a[3],n),w:jt(a[4],n),d:jt(a[5],n),h:jt(a[6],n),m:jt(a[7],n),s:jt(a[8],n)}):null==r?r={}:"object"==typeof r&&("from"in r||"to"in r)&&(i=function(e,t){var n;if(!e.isValid()||!t.isValid())return{milliseconds:0,months:0};t=Nt(t,e),e.isBefore(t)?n=Zt(e,t):((n=Zt(t,e)).milliseconds=-n.milliseconds,n.months=-n.months);return n}(Tt(r.from),Tt(r.to)),(r={}).ms=i.milliseconds,r.M=i.months),s=new Ht(r),Rt(e)&&m(e,"_locale")&&(s._locale=e._locale),s}function jt(e,t){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*t}function Zt(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function zt(s,i){return function(e,t){var n;return null===t||isNaN(+t)||(T(i,"moment()."+i+"(period, number) is deprecated. Please use moment()."+i+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),n=e,e=t,t=n),$t(this,At(e="string"==typeof e?+e:e,t),s),this}}function $t(e,t,n,s){var i=t._milliseconds,r=Ct(t._days),a=Ct(t._months);e.isValid()&&(s=null==s||s,a&&Ce(e,xe(e,"Month")+a*n),r&&be(e,"Date",xe(e,"Date")+r*n),i&&e._d.setTime(e._d.valueOf()+i*n),s&&c.updateOffset(e,r||a))}At.fn=Ht.prototype,At.invalid=function(){return At(NaN)};var qt=zt(1,"add"),Jt=zt(-1,"subtract");function Bt(e,t){var n=12*(t.year()-e.year())+(t.month()-e.month()),s=e.clone().add(n,"months");return-(n+(t-s<0?(t-s)/(s-e.clone().add(n-1,"months")):(t-s)/(e.clone().add(n+1,"months")-s)))||0}function Qt(e){var t;return void 0===e?this._locale._abbr:(null!=(t=lt(e))&&(this._locale=t),this)}c.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",c.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var Xt=n("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});function Kt(){return this._locale}function en(e,t){I(0,[e,e.length],0,t)}function tn(e,t,n,s,i){var r;return null==e?Ie(this,s,i).year:((r=Ae(e,s,i))<t&&(t=r),function(e,t,n,s,i){var r=Ee(e,t,n,s,i),a=Ge(r.year,0,r.dayOfYear);return this.year(a.getUTCFullYear()),this.month(a.getUTCMonth()),this.date(a.getUTCDate()),this}.call(this,e,t,n,s,i))}I(0,["gg",2],0,function(){return this.weekYear()%100}),I(0,["GG",2],0,function(){return this.isoWeekYear()%100}),en("gggg","weekYear"),en("ggggg","weekYear"),en("GGGG","isoWeekYear"),en("GGGGG","isoWeekYear"),H("weekYear","gg"),H("isoWeekYear","GG"),L("weekYear",1),L("isoWeekYear",1),ue("G",se),ue("g",se),ue("GG",B,z),ue("gg",B,z),ue("GGGG",ee,q),ue("gggg",ee,q),ue("GGGGG",te,J),ue("ggggg",te,J),fe(["gggg","ggggg","GGGG","GGGGG"],function(e,t,n,s){t[s.substr(0,2)]=k(e)}),fe(["gg","GG"],function(e,t,n,s){t[s]=c.parseTwoDigitYear(e)}),I("Q",0,"Qo","quarter"),H("quarter","Q"),L("quarter",7),ue("Q",Z),ce("Q",function(e,t){t[_e]=3*(k(e)-1)}),I("D",["DD",2],"Do","date"),H("date","D"),L("date",9),ue("D",B),ue("DD",B,z),ue("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),ce(["D","DD"],ye),ce("Do",function(e,t){t[ye]=k(e.match(B)[0])});var nn=Te("Date",!0);I("DDD",["DDDD",3],"DDDo","dayOfYear"),H("dayOfYear","DDD"),L("dayOfYear",4),ue("DDD",K),ue("DDDD",$),ce(["DDD","DDDD"],function(e,t,n){n._dayOfYear=k(e)}),I("m",["mm",2],0,"minute"),H("minute","m"),L("minute",14),ue("m",B),ue("mm",B,z),ce(["m","mm"],pe);var sn=Te("Minutes",!1);I("s",["ss",2],0,"second"),H("second","s"),L("second",15),ue("s",B),ue("ss",B,z),ce(["s","ss"],ve);var rn,an=Te("Seconds",!1);for(I("S",0,0,function(){return~~(this.millisecond()/100)}),I(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),I(0,["SSS",3],0,"millisecond"),I(0,["SSSS",4],0,function(){return 10*this.millisecond()}),I(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),I(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),I(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),I(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),I(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),H("millisecond","ms"),L("millisecond",16),ue("S",K,Z),ue("SS",K,z),ue("SSS",K,$),rn="SSSS";rn.length<=9;rn+="S")ue(rn,ne);function on(e,t){t[we]=k(1e3*("0."+e))}for(rn="S";rn.length<=9;rn+="S")ce(rn,on);var un=Te("Milliseconds",!1);I("z",0,0,"zoneAbbr"),I("zz",0,0,"zoneName");var ln=M.prototype;function dn(e){return e}ln.add=qt,ln.calendar=function(e,t){var n=e||Tt(),s=Nt(n,this).startOf("day"),i=c.calendarFormat(this,s)||"sameElse",r=t&&(x(t[i])?t[i].call(this,n):t[i]);return this.format(r||this.localeData().calendar(i,this,Tt(n)))},ln.clone=function(){return new M(this)},ln.diff=function(e,t,n){var s,i,r;if(!this.isValid())return NaN;if(!(s=Nt(e,this)).isValid())return NaN;switch(i=6e4*(s.utcOffset()-this.utcOffset()),t=R(t)){case"year":r=Bt(this,s)/12;break;case"month":r=Bt(this,s);break;case"quarter":r=Bt(this,s)/3;break;case"second":r=(this-s)/1e3;break;case"minute":r=(this-s)/6e4;break;case"hour":r=(this-s)/36e5;break;case"day":r=(this-s-i)/864e5;break;case"week":r=(this-s-i)/6048e5;break;default:r=this-s}return n?r:D(r)},ln.endOf=function(e){return void 0===(e=R(e))||"millisecond"===e?this:("date"===e&&(e="day"),this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms"))},ln.format=function(e){e||(e=this.isUtc()?c.defaultFormatUtc:c.defaultFormat);var t=A(this,e);return this.localeData().postformat(t)},ln.from=function(e,t){return this.isValid()&&(S(e)&&e.isValid()||Tt(e).isValid())?At({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},ln.fromNow=function(e){return this.from(Tt(),e)},ln.to=function(e,t){return this.isValid()&&(S(e)&&e.isValid()||Tt(e).isValid())?At({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},ln.toNow=function(e){return this.to(Tt(),e)},ln.get=function(e){return x(this[e=R(e)])?this[e]():this},ln.invalidAt=function(){return g(this).overflow},ln.isAfter=function(e,t){var n=S(e)?e:Tt(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=R(l(t)?"millisecond":t))?this.valueOf()>n.valueOf():n.valueOf()<this.clone().startOf(t).valueOf())},ln.isBefore=function(e,t){var n=S(e)?e:Tt(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=R(l(t)?"millisecond":t))?this.valueOf()<n.valueOf():this.clone().endOf(t).valueOf()<n.valueOf())},ln.isBetween=function(e,t,n,s){return("("===(s=s||"()")[0]?this.isAfter(e,n):!this.isBefore(e,n))&&(")"===s[1]?this.isBefore(t,n):!this.isAfter(t,n))},ln.isSame=function(e,t){var n,s=S(e)?e:Tt(e);return!(!this.isValid()||!s.isValid())&&("millisecond"===(t=R(t||"millisecond"))?this.valueOf()===s.valueOf():(n=s.valueOf(),this.clone().startOf(t).valueOf()<=n&&n<=this.clone().endOf(t).valueOf()))},ln.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},ln.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},ln.isValid=function(){return p(this)},ln.lang=Xt,ln.locale=Qt,ln.localeData=Kt,ln.max=bt,ln.min=xt,ln.parsingFlags=function(){return _({},g(this))},ln.set=function(e,t){if("object"==typeof e)for(var n=function(e){var t=[];for(var n in e)t.push({unit:n,priority:F[n]});return t.sort(function(e,t){return e.priority-t.priority}),t}(e=C(e)),s=0;s<n.length;s++)this[n[s].unit](e[n[s].unit]);else if(x(this[e=R(e)]))return this[e](t);return this},ln.startOf=function(e){switch(e=R(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.weekday(0),"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},ln.subtract=Jt,ln.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},ln.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},ln.toDate=function(){return new Date(this.valueOf())},ln.toISOString=function(e){if(!this.isValid())return null;var t=!0!==e,n=t?this.clone().utc():this;return n.year()<0||9999<n.year()?A(n,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):x(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",A(n,"Z")):A(n,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},ln.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",t="";this.isLocal()||(e=0===this.utcOffset()?"moment.utc":"moment.parseZone",t="Z");var n="["+e+'("]',s=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",i=t+'[")]';return this.format(n+s+"-MM-DD[T]HH:mm:ss.SSS"+i)},ln.toJSON=function(){return this.isValid()?this.toISOString():null},ln.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},ln.unix=function(){return Math.floor(this.valueOf()/1e3)},ln.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},ln.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},ln.year=Oe,ln.isLeapYear=function(){return ke(this.year())},ln.weekYear=function(e){return tn.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},ln.isoWeekYear=function(e){return tn.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},ln.quarter=ln.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},ln.month=Fe,ln.daysInMonth=function(){return Pe(this.year(),this.month())},ln.week=ln.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},ln.isoWeek=ln.isoWeeks=function(e){var t=Ie(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},ln.weeksInYear=function(){var e=this.localeData()._week;return Ae(this.year(),e.dow,e.doy)},ln.isoWeeksInYear=function(){return Ae(this.year(),1,4)},ln.date=nn,ln.day=ln.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t,n,s=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(t=e,n=this.localeData(),e="string"!=typeof t?t:isNaN(t)?"number"==typeof(t=n.weekdaysParse(t))?t:null:parseInt(t,10),this.add(e-s,"d")):s},ln.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},ln.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var t=(n=e,s=this.localeData(),"string"==typeof n?s.weekdaysParse(n)%7||7:isNaN(n)?null:n);return this.day(this.day()%7?t:t-7)}return this.day()||7;var n,s},ln.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},ln.hour=ln.hours=tt,ln.minute=ln.minutes=sn,ln.second=ln.seconds=an,ln.millisecond=ln.milliseconds=un,ln.utcOffset=function(e,t,n){var s,i=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null!=e){if("string"==typeof e){if(null===(e=Ut(re,e)))return this}else Math.abs(e)<16&&!n&&(e*=60);return!this._isUTC&&t&&(s=Gt(this)),this._offset=e,this._isUTC=!0,null!=s&&this.add(s,"m"),i!==e&&(!t||this._changeInProgress?$t(this,At(e-i,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,c.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?i:Gt(this)},ln.utc=function(e){return this.utcOffset(0,e)},ln.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Gt(this),"m")),this},ln.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=Ut(ie,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this},ln.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?Tt(e).utcOffset():0,(this.utcOffset()-e)%60==0)},ln.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},ln.isLocal=function(){return!!this.isValid()&&!this._isUTC},ln.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},ln.isUtc=Vt,ln.isUTC=Vt,ln.zoneAbbr=function(){return this._isUTC?"UTC":""},ln.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},ln.dates=n("dates accessor is deprecated. Use date instead.",nn),ln.months=n("months accessor is deprecated. Use month instead",Fe),ln.years=n("years accessor is deprecated. Use year instead",Oe),ln.zone=n("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}),ln.isDSTShifted=n("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!l(this._isDSTShifted))return this._isDSTShifted;var e={};if(w(e,this),(e=Yt(e))._a){var t=e._isUTC?y(e._a):Tt(e._a);this._isDSTShifted=this.isValid()&&0<a(e._a,t.toArray())}else this._isDSTShifted=!1;return this._isDSTShifted});var hn=P.prototype;function cn(e,t,n,s){var i=lt(),r=y().set(s,t);return i[n](r,e)}function fn(e,t,n){if(d(e)&&(t=e,e=void 0),e=e||"",null!=t)return cn(e,t,n,"month");var s,i=[];for(s=0;s<12;s++)i[s]=cn(e,s,n,"month");return i}function mn(e,t,n,s){"boolean"==typeof e?d(t)&&(n=t,t=void 0):(t=e,e=!1,d(n=t)&&(n=t,t=void 0)),t=t||"";var i,r=lt(),a=e?r._week.dow:0;if(null!=n)return cn(t,(n+a)%7,s,"day");var o=[];for(i=0;i<7;i++)o[i]=cn(t,(i+a)%7,s,"day");return o}hn.calendar=function(e,t,n){var s=this._calendar[e]||this._calendar.sameElse;return x(s)?s.call(t,n):s},hn.longDateFormat=function(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return t||!n?t:(this._longDateFormat[e]=n.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e])},hn.invalidDate=function(){return this._invalidDate},hn.ordinal=function(e){return this._ordinal.replace("%d",e)},hn.preparse=dn,hn.postformat=dn,hn.relativeTime=function(e,t,n,s){var i=this._relativeTime[n];return x(i)?i(e,t,n,s):i.replace(/%d/i,e)},hn.pastFuture=function(e,t){var n=this._relativeTime[0<e?"future":"past"];return x(n)?n(t):n.replace(/%s/i,t)},hn.set=function(e){var t,n;for(n in e)x(t=e[n])?this[n]=t:this["_"+n]=t;this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},hn.months=function(e,t){return e?o(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||We).test(t)?"format":"standalone"][e.month()]:o(this._months)?this._months:this._months.standalone},hn.monthsShort=function(e,t){return e?o(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[We.test(t)?"format":"standalone"][e.month()]:o(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},hn.monthsParse=function(e,t,n){var s,i,r;if(this._monthsParseExact)return function(e,t,n){var s,i,r,a=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],s=0;s<12;++s)r=y([2e3,s]),this._shortMonthsParse[s]=this.monthsShort(r,"").toLocaleLowerCase(),this._longMonthsParse[s]=this.months(r,"").toLocaleLowerCase();return n?"MMM"===t?-1!==(i=Ye.call(this._shortMonthsParse,a))?i:null:-1!==(i=Ye.call(this._longMonthsParse,a))?i:null:"MMM"===t?-1!==(i=Ye.call(this._shortMonthsParse,a))?i:-1!==(i=Ye.call(this._longMonthsParse,a))?i:null:-1!==(i=Ye.call(this._longMonthsParse,a))?i:-1!==(i=Ye.call(this._shortMonthsParse,a))?i:null}.call(this,e,t,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),s=0;s<12;s++){if(i=y([2e3,s]),n&&!this._longMonthsParse[s]&&(this._longMonthsParse[s]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[s]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),n||this._monthsParse[s]||(r="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[s]=new RegExp(r.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[s].test(e))return s;if(n&&"MMM"===t&&this._shortMonthsParse[s].test(e))return s;if(!n&&this._monthsParse[s].test(e))return s}},hn.monthsRegex=function(e){return this._monthsParseExact?(m(this,"_monthsRegex")||Ne.call(this),e?this._monthsStrictRegex:this._monthsRegex):(m(this,"_monthsRegex")||(this._monthsRegex=Ue),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},hn.monthsShortRegex=function(e){return this._monthsParseExact?(m(this,"_monthsRegex")||Ne.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(m(this,"_monthsShortRegex")||(this._monthsShortRegex=Le),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},hn.week=function(e){return Ie(e,this._week.dow,this._week.doy).week},hn.firstDayOfYear=function(){return this._week.doy},hn.firstDayOfWeek=function(){return this._week.dow},hn.weekdays=function(e,t){return e?o(this._weekdays)?this._weekdays[e.day()]:this._weekdays[this._weekdays.isFormat.test(t)?"format":"standalone"][e.day()]:o(this._weekdays)?this._weekdays:this._weekdays.standalone},hn.weekdaysMin=function(e){return e?this._weekdaysMin[e.day()]:this._weekdaysMin},hn.weekdaysShort=function(e){return e?this._weekdaysShort[e.day()]:this._weekdaysShort},hn.weekdaysParse=function(e,t,n){var s,i,r;if(this._weekdaysParseExact)return function(e,t,n){var s,i,r,a=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],s=0;s<7;++s)r=y([2e3,1]).day(s),this._minWeekdaysParse[s]=this.weekdaysMin(r,"").toLocaleLowerCase(),this._shortWeekdaysParse[s]=this.weekdaysShort(r,"").toLocaleLowerCase(),this._weekdaysParse[s]=this.weekdays(r,"").toLocaleLowerCase();return n?"dddd"===t?-1!==(i=Ye.call(this._weekdaysParse,a))?i:null:"ddd"===t?-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:null:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:null:"dddd"===t?-1!==(i=Ye.call(this._weekdaysParse,a))?i:-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:null:"ddd"===t?-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:-1!==(i=Ye.call(this._weekdaysParse,a))?i:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:null:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:-1!==(i=Ye.call(this._weekdaysParse,a))?i:-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:null}.call(this,e,t,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),s=0;s<7;s++){if(i=y([2e3,1]).day(s),n&&!this._fullWeekdaysParse[s]&&(this._fullWeekdaysParse[s]=new RegExp("^"+this.weekdays(i,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[s]=new RegExp("^"+this.weekdaysShort(i,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[s]=new RegExp("^"+this.weekdaysMin(i,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[s]||(r="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[s]=new RegExp(r.replace(".",""),"i")),n&&"dddd"===t&&this._fullWeekdaysParse[s].test(e))return s;if(n&&"ddd"===t&&this._shortWeekdaysParse[s].test(e))return s;if(n&&"dd"===t&&this._minWeekdaysParse[s].test(e))return s;if(!n&&this._weekdaysParse[s].test(e))return s}},hn.weekdaysRegex=function(e){return this._weekdaysParseExact?(m(this,"_weekdaysRegex")||Be.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(m(this,"_weekdaysRegex")||(this._weekdaysRegex=$e),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},hn.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(m(this,"_weekdaysRegex")||Be.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(m(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=qe),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},hn.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(m(this,"_weekdaysRegex")||Be.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(m(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Je),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},hn.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},hn.meridiem=function(e,t,n){return 11<e?n?"pm":"PM":n?"am":"AM"},ot("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===k(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),c.lang=n("moment.lang is deprecated. Use moment.locale instead.",ot),c.langData=n("moment.langData is deprecated. Use moment.localeData instead.",lt);var _n=Math.abs;function yn(e,t,n,s){var i=At(t,n);return e._milliseconds+=s*i._milliseconds,e._days+=s*i._days,e._months+=s*i._months,e._bubble()}function gn(e){return e<0?Math.floor(e):Math.ceil(e)}function pn(e){return 4800*e/146097}function vn(e){return 146097*e/4800}function wn(e){return function(){return this.as(e)}}var Mn=wn("ms"),Sn=wn("s"),Dn=wn("m"),kn=wn("h"),Yn=wn("d"),On=wn("w"),Tn=wn("M"),xn=wn("y");function bn(e){return function(){return this.isValid()?this._data[e]:NaN}}var Pn=bn("milliseconds"),Wn=bn("seconds"),Hn=bn("minutes"),Rn=bn("hours"),Cn=bn("days"),Fn=bn("months"),Ln=bn("years");var Un=Math.round,Nn={ss:44,s:45,m:45,h:22,d:26,M:11};var Gn=Math.abs;function Vn(e){return(0<e)-(e<0)||+e}function En(){if(!this.isValid())return this.localeData().invalidDate();var e,t,n=Gn(this._milliseconds)/1e3,s=Gn(this._days),i=Gn(this._months);t=D((e=D(n/60))/60),n%=60,e%=60;var r=D(i/12),a=i%=12,o=s,u=t,l=e,d=n?n.toFixed(3).replace(/\.?0+$/,""):"",h=this.asSeconds();if(!h)return"P0D";var c=h<0?"-":"",f=Vn(this._months)!==Vn(h)?"-":"",m=Vn(this._days)!==Vn(h)?"-":"",_=Vn(this._milliseconds)!==Vn(h)?"-":"";return c+"P"+(r?f+r+"Y":"")+(a?f+a+"M":"")+(o?m+o+"D":"")+(u||l||d?"T":"")+(u?_+u+"H":"")+(l?_+l+"M":"")+(d?_+d+"S":"")}var In=Ht.prototype;return In.isValid=function(){return this._isValid},In.abs=function(){var e=this._data;return this._milliseconds=_n(this._milliseconds),this._days=_n(this._days),this._months=_n(this._months),e.milliseconds=_n(e.milliseconds),e.seconds=_n(e.seconds),e.minutes=_n(e.minutes),e.hours=_n(e.hours),e.months=_n(e.months),e.years=_n(e.years),this},In.add=function(e,t){return yn(this,e,t,1)},In.subtract=function(e,t){return yn(this,e,t,-1)},In.as=function(e){if(!this.isValid())return NaN;var t,n,s=this._milliseconds;if("month"===(e=R(e))||"year"===e)return t=this._days+s/864e5,n=this._months+pn(t),"month"===e?n:n/12;switch(t=this._days+Math.round(vn(this._months)),e){case"week":return t/7+s/6048e5;case"day":return t+s/864e5;case"hour":return 24*t+s/36e5;case"minute":return 1440*t+s/6e4;case"second":return 86400*t+s/1e3;case"millisecond":return Math.floor(864e5*t)+s;default:throw new Error("Unknown unit "+e)}},In.asMilliseconds=Mn,In.asSeconds=Sn,In.asMinutes=Dn,In.asHours=kn,In.asDays=Yn,In.asWeeks=On,In.asMonths=Tn,In.asYears=xn,In.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*k(this._months/12):NaN},In._bubble=function(){var e,t,n,s,i,r=this._milliseconds,a=this._days,o=this._months,u=this._data;return 0<=r&&0<=a&&0<=o||r<=0&&a<=0&&o<=0||(r+=864e5*gn(vn(o)+a),o=a=0),u.milliseconds=r%1e3,e=D(r/1e3),u.seconds=e%60,t=D(e/60),u.minutes=t%60,n=D(t/60),u.hours=n%24,o+=i=D(pn(a+=D(n/24))),a-=gn(vn(i)),s=D(o/12),o%=12,u.days=a,u.months=o,u.years=s,this},In.clone=function(){return At(this)},In.get=function(e){return e=R(e),this.isValid()?this[e+"s"]():NaN},In.milliseconds=Pn,In.seconds=Wn,In.minutes=Hn,In.hours=Rn,In.days=Cn,In.weeks=function(){return D(this.days()/7)},In.months=Fn,In.years=Ln,In.humanize=function(e){if(!this.isValid())return this.localeData().invalidDate();var t,n,s,i,r,a,o,u,l,d,h,c=this.localeData(),f=(n=!e,s=c,i=At(t=this).abs(),r=Un(i.as("s")),a=Un(i.as("m")),o=Un(i.as("h")),u=Un(i.as("d")),l=Un(i.as("M")),d=Un(i.as("y")),(h=r<=Nn.ss&&["s",r]||r<Nn.s&&["ss",r]||a<=1&&["m"]||a<Nn.m&&["mm",a]||o<=1&&["h"]||o<Nn.h&&["hh",o]||u<=1&&["d"]||u<Nn.d&&["dd",u]||l<=1&&["M"]||l<Nn.M&&["MM",l]||d<=1&&["y"]||["yy",d])[2]=n,h[3]=0<+t,h[4]=s,function(e,t,n,s,i){return i.relativeTime(t||1,!!n,e,s)}.apply(null,h));return e&&(f=c.pastFuture(+this,f)),c.postformat(f)},In.toISOString=En,In.toString=En,In.toJSON=En,In.locale=Qt,In.localeData=Kt,In.toIsoString=n("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",En),In.lang=Xt,I("X",0,0,"unix"),I("x",0,0,"valueOf"),ue("x",se),ue("X",/[+-]?\d+(\.\d{1,3})?/),ce("X",function(e,t,n){n._d=new Date(1e3*parseFloat(e,10))}),ce("x",function(e,t,n){n._d=new Date(k(e))}),c.version="2.22.2",e=Tt,c.fn=ln,c.min=function(){return Pt("isBefore",[].slice.call(arguments,0))},c.max=function(){return Pt("isAfter",[].slice.call(arguments,0))},c.now=function(){return Date.now?Date.now():+new Date},c.utc=y,c.unix=function(e){return Tt(1e3*e)},c.months=function(e,t){return fn(e,t,"months")},c.isDate=h,c.locale=ot,c.invalid=v,c.duration=At,c.isMoment=S,c.weekdays=function(e,t,n){return mn(e,t,n,"weekdays")},c.parseZone=function(){return Tt.apply(null,arguments).parseZone()},c.localeData=lt,c.isDuration=Rt,c.monthsShort=function(e,t){return fn(e,t,"monthsShort")},c.weekdaysMin=function(e,t,n){return mn(e,t,n,"weekdaysMin")},c.defineLocale=ut,c.updateLocale=function(e,t){if(null!=t){var n,s,i=nt;null!=(s=at(e))&&(i=s._config),(n=new P(t=b(i,t))).parentLocale=st[e],st[e]=n,ot(e)}else null!=st[e]&&(null!=st[e].parentLocale?st[e]=st[e].parentLocale:null!=st[e]&&delete st[e]);return st[e]},c.locales=function(){return s(st)},c.weekdaysShort=function(e,t,n){return mn(e,t,n,"weekdaysShort")},c.normalizeUnits=R,c.relativeTimeRounding=function(e){return void 0===e?Un:"function"==typeof e&&(Un=e,!0)},c.relativeTimeThreshold=function(e,t){return void 0!==Nn[e]&&(void 0===t?Nn[e]:(Nn[e]=t,"s"===e&&(Nn.ss=t-1),!0))},c.calendarFormat=function(e,t){var n=e.diff(t,"days",!0);return n<-6?"sameElse":n<-1?"lastWeek":n<0?"lastDay":n<1?"sameDay":n<2?"nextDay":n<7?"nextWeek":"sameElse"},c.prototype=ln,c.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"YYYY-[W]WW",MONTH:"YYYY-MM"},c});
$(document).ready(function(){

	//виджет оценки компании
	$(".issue-rate-btn").click(function(){
		$(this).parents(".issue-rate").find(".issue-rate-stars-wrap").slideDown();
	});

	function initIssueRating(callback) {
		callback();
	}

	// обработка клика по звездочкам в модальном окне
	var barRatingIssue = function () {
		var issue_rate_class = "issue-rate";
		$('.issue-rate-stars').barrating({
			theme: 'fontawesome-stars',
			showValues: false,
			onSelect: function (value, text, event) {
				preloader('show');
				var issue_rate_date = Date();
				issue_rate_date = moment(issue_rate_date).format('DD.MM.YYYY HH:mm');
				$.ajax({
					type: 'POST',
					url: '/tc/manager/ajax-rate/', // ### ДЛЯ ПРОГЕРОВ: ### здесь изменить ссылку на /tc/issue/rate/ или др.
					data: {
						mark: value,
						date: issue_rate_date,
						comment: $('textarea.quality-comment').length ? $('textarea.quality-comment').val() : null
					},
					success: function (data) {
						console.log(data);
						var class_rating = "";
						if (value >= 1 && value <= 6) {
							class_rating = " bad";
						} else if (value >= 7 && value <= 8) {
							class_rating = " good";
						} else if (value >= 9 && value <= 10) {
							class_rating = " best";
						} else {
							class_rating = " text";
						}
						$("."+issue_rate_class).attr('class', issue_rate_class+class_rating).find('.issue-rate-stars-wrap').slideUp();
						$(".issue-rate-count-digit-date-value").text(issue_rate_date);
						$(".issue-rate-count-digit-number").text(value);
						preloader('hide');
					}
				});
			}
		});
	};

	initIssueRating(barRatingIssue);

	$(".issue-form-add-item__label-info-trigger").click(function(){
		$(this).parents(".issue-form-add-item__label-info").toggleClass("active");
	});

	$(document).mouseup(function (e){
		var div = $(".issue-form-add-item__label-info");
		if (!div.is(e.target) && div.has(e.target).length === 0) div.removeClass("active");
	});

	$(".issue-form-add-item__drop-title").click(function(){
		$(this).toggleClass("open");
		$(this).next(".issue-form-add-item__drop-list").slideToggle();
	});

	$(".issue-form-add-item__drop-list-item").click(function(){
		var issue_form_title = $(this).text();
		$(".issue-form-add-item__drop-title").text(issue_form_title);
		$(this).parents(".issue-form-add-item__drop-list").slideUp();
	});

	function issue_sliced_link () {
		$(".issue-table-body-item").each(function(){
			var item = $(this),
				item_link = item.find(".issue-table-info-item-link"),
				item_title = item.find(".issue-table-info-item-title"),
				item_link_text = item_link.text(),
				wd = $(window).width(),
				item_sliced_count = 30; //по умолчанию
			if (item_title[0].hasAttribute("data-word")) {
				if (item_title.attr("data-word") <= 30) item_sliced_count = item_title.attr("data-word");
			}
			if ((item_link.text().length > item_sliced_count) && (wd > 800)) {
				var item_link_sliced = item_link_text.slice(0,item_sliced_count);
				item_link_sliced += "...";
				item_link.text(item_link_sliced);
				item_link.attr("data-full-text",item_link_text);
				var item_title_width = item_title.width();
				item_title.width(item_title_width);
				item_title.addClass("popupExists");
				$(".issue-table-popup").text(item_link.attr("data-full-text"));
			} else if (wd < 1370) {
				item_link.text(item_link_text);
			}
		});
	}

	issue_sliced_link();

	$(".issue-table-info-item-title.popupExists .issue-table-info-item-link").hover(
		function(){
			var issue_popup_top   = $(this).parents(".issue-table-body-item").offset().top+35,
				issue_popup_left  = $(this).parents(".issue-table-body-item").offset().left+20;
			$(".issue-table-popup").css({"position":"fixed", "margin-top":issue_popup_top, "margin-left":issue_popup_left}).addClass("open");
		},
		function(){
			$(".issue-table-popup").removeClass("open");
		}
	);

	$(".issue-table-info-item-link").click(function(){
		var current_issue = $(this).parents(".issue-table-body-item").find(".issue-table-wrap");
		$(".issue-table-wrap").not(current_issue).slideUp();
		$(this).parents(".issue-table-body-item").find(".issue-table-wrap").slideToggle();
	});

	$(".issue-table-msg-top-btn__closetext").click(function(){
		$(this).parents().find(".issue-table-wrap").slideUp();
	});

	$(".issue-table-section").mCustomScrollbar({
		axis: "x",
		mouseWheel: {
			enable: false,
			scrollAmount: "auto",
			axis: "x",
			preventDefault: false,
			deltaFactor: "auto",
			normalizeDelta: false,
			invert: false,
			disableOver: ["table"]
		}
	});

	//фильтр по типу обращения
	$(".issue-filter-item").click(function(){
		$(".issue-filter-item").not($(this)).removeClass("active");
		$(this).addClass("active");
		var issue_type = $(this).attr("data-type");
		if (issue_type != undefined) {
			$(".issue-table-body-item").hide();
			$(".issue-table-body-item[data-type='"+issue_type+"']").show();
		} else {
			$(".issue-table-body-item").show();
		}
	});

});
/*!
  * Bootstrap v4.3.1 (https://getbootstrap.com/)
  * Copyright 2011-2019 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
  */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("jquery")):"function"==typeof define&&define.amd?define(["exports","jquery"],e):e((t=t||self).bootstrap={},t.jQuery)}(this,function(t,p){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function l(o){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},e=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),e.forEach(function(t){var e,n,i;e=o,i=r[n=t],n in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i})}return o}p=p&&p.hasOwnProperty("default")?p.default:p;var e="transitionend";function n(t){var e=this,n=!1;return p(this).one(m.TRANSITION_END,function(){n=!0}),setTimeout(function(){n||m.triggerTransitionEnd(e)},t),this}var m={TRANSITION_END:"bsTransitionEnd",getUID:function(t){for(;t+=~~(1e6*Math.random()),document.getElementById(t););return t},getSelectorFromElement:function(t){var e=t.getAttribute("data-target");if(!e||"#"===e){var n=t.getAttribute("href");e=n&&"#"!==n?n.trim():""}try{return document.querySelector(e)?e:null}catch(t){return null}},getTransitionDurationFromElement:function(t){if(!t)return 0;var e=p(t).css("transition-duration"),n=p(t).css("transition-delay"),i=parseFloat(e),o=parseFloat(n);return i||o?(e=e.split(",")[0],n=n.split(",")[0],1e3*(parseFloat(e)+parseFloat(n))):0},reflow:function(t){return t.offsetHeight},triggerTransitionEnd:function(t){p(t).trigger(e)},supportsTransitionEnd:function(){return Boolean(e)},isElement:function(t){return(t[0]||t).nodeType},typeCheckConfig:function(t,e,n){for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)){var o=n[i],r=e[i],s=r&&m.isElement(r)?"element":(a=r,{}.toString.call(a).match(/\s([a-z]+)/i)[1].toLowerCase());if(!new RegExp(o).test(s))throw new Error(t.toUpperCase()+': Option "'+i+'" provided type "'+s+'" but expected type "'+o+'".')}var a},findShadowRoot:function(t){if(!document.documentElement.attachShadow)return null;if("function"!=typeof t.getRootNode)return t instanceof ShadowRoot?t:t.parentNode?m.findShadowRoot(t.parentNode):null;var e=t.getRootNode();return e instanceof ShadowRoot?e:null}};p.fn.emulateTransitionEnd=n,p.event.special[m.TRANSITION_END]={bindType:e,delegateType:e,handle:function(t){if(p(t.target).is(this))return t.handleObj.handler.apply(this,arguments)}};var o="alert",r="bs.alert",a="."+r,c=p.fn[o],h={CLOSE:"close"+a,CLOSED:"closed"+a,CLICK_DATA_API:"click"+a+".data-api"},u="alert",f="fade",d="show",g=function(){function i(t){this._element=t}var t=i.prototype;return t.close=function(t){var e=this._element;t&&(e=this._getRootElement(t)),this._triggerCloseEvent(e).isDefaultPrevented()||this._removeElement(e)},t.dispose=function(){p.removeData(this._element,r),this._element=null},t._getRootElement=function(t){var e=m.getSelectorFromElement(t),n=!1;return e&&(n=document.querySelector(e)),n||(n=p(t).closest("."+u)[0]),n},t._triggerCloseEvent=function(t){var e=p.Event(h.CLOSE);return p(t).trigger(e),e},t._removeElement=function(e){var n=this;if(p(e).removeClass(d),p(e).hasClass(f)){var t=m.getTransitionDurationFromElement(e);p(e).one(m.TRANSITION_END,function(t){return n._destroyElement(e,t)}).emulateTransitionEnd(t)}else this._destroyElement(e)},t._destroyElement=function(t){p(t).detach().trigger(h.CLOSED).remove()},i._jQueryInterface=function(n){return this.each(function(){var t=p(this),e=t.data(r);e||(e=new i(this),t.data(r,e)),"close"===n&&e[n](this)})},i._handleDismiss=function(e){return function(t){t&&t.preventDefault(),e.close(this)}},s(i,null,[{key:"VERSION",get:function(){return"4.3.1"}}]),i}();p(document).on(h.CLICK_DATA_API,'[data-dismiss="alert"]',g._handleDismiss(new g)),p.fn[o]=g._jQueryInterface,p.fn[o].Constructor=g,p.fn[o].noConflict=function(){return p.fn[o]=c,g._jQueryInterface};var _="button",v="bs.button",y="."+v,E=".data-api",b=p.fn[_],w="active",C="btn",T="focus",S='[data-toggle^="button"]',D='[data-toggle="buttons"]',I='input:not([type="hidden"])',A=".active",O=".btn",N={CLICK_DATA_API:"click"+y+E,FOCUS_BLUR_DATA_API:"focus"+y+E+" blur"+y+E},k=function(){function n(t){this._element=t}var t=n.prototype;return t.toggle=function(){var t=!0,e=!0,n=p(this._element).closest(D)[0];if(n){var i=this._element.querySelector(I);if(i){if("radio"===i.type)if(i.checked&&this._element.classList.contains(w))t=!1;else{var o=n.querySelector(A);o&&p(o).removeClass(w)}if(t){if(i.hasAttribute("disabled")||n.hasAttribute("disabled")||i.classList.contains("disabled")||n.classList.contains("disabled"))return;i.checked=!this._element.classList.contains(w),p(i).trigger("change")}i.focus(),e=!1}}e&&this._element.setAttribute("aria-pressed",!this._element.classList.contains(w)),t&&p(this._element).toggleClass(w)},t.dispose=function(){p.removeData(this._element,v),this._element=null},n._jQueryInterface=function(e){return this.each(function(){var t=p(this).data(v);t||(t=new n(this),p(this).data(v,t)),"toggle"===e&&t[e]()})},s(n,null,[{key:"VERSION",get:function(){return"4.3.1"}}]),n}();p(document).on(N.CLICK_DATA_API,S,function(t){t.preventDefault();var e=t.target;p(e).hasClass(C)||(e=p(e).closest(O)),k._jQueryInterface.call(p(e),"toggle")}).on(N.FOCUS_BLUR_DATA_API,S,function(t){var e=p(t.target).closest(O)[0];p(e).toggleClass(T,/^focus(in)?$/.test(t.type))}),p.fn[_]=k._jQueryInterface,p.fn[_].Constructor=k,p.fn[_].noConflict=function(){return p.fn[_]=b,k._jQueryInterface};var L="carousel",x="bs.carousel",P="."+x,H=".data-api",j=p.fn[L],R={interval:5e3,keyboard:!0,slide:!1,pause:"hover",wrap:!0,touch:!0},F={interval:"(number|boolean)",keyboard:"boolean",slide:"(boolean|string)",pause:"(string|boolean)",wrap:"boolean",touch:"boolean"},M="next",W="prev",U="left",B="right",q={SLIDE:"slide"+P,SLID:"slid"+P,KEYDOWN:"keydown"+P,MOUSEENTER:"mouseenter"+P,MOUSELEAVE:"mouseleave"+P,TOUCHSTART:"touchstart"+P,TOUCHMOVE:"touchmove"+P,TOUCHEND:"touchend"+P,POINTERDOWN:"pointerdown"+P,POINTERUP:"pointerup"+P,DRAG_START:"dragstart"+P,LOAD_DATA_API:"load"+P+H,CLICK_DATA_API:"click"+P+H},K="carousel",Q="active",V="slide",Y="carousel-item-right",z="carousel-item-left",X="carousel-item-next",G="carousel-item-prev",$="pointer-event",J=".active",Z=".active.carousel-item",tt=".carousel-item",et=".carousel-item img",nt=".carousel-item-next, .carousel-item-prev",it=".carousel-indicators",ot="[data-slide], [data-slide-to]",rt='[data-ride="carousel"]',st={TOUCH:"touch",PEN:"pen"},at=function(){function r(t,e){this._items=null,this._interval=null,this._activeElement=null,this._isPaused=!1,this._isSliding=!1,this.touchTimeout=null,this.touchStartX=0,this.touchDeltaX=0,this._config=this._getConfig(e),this._element=t,this._indicatorsElement=this._element.querySelector(it),this._touchSupported="ontouchstart"in document.documentElement||0<navigator.maxTouchPoints,this._pointerEvent=Boolean(window.PointerEvent||window.MSPointerEvent),this._addEventListeners()}var t=r.prototype;return t.next=function(){this._isSliding||this._slide(M)},t.nextWhenVisible=function(){!document.hidden&&p(this._element).is(":visible")&&"hidden"!==p(this._element).css("visibility")&&this.next()},t.prev=function(){this._isSliding||this._slide(W)},t.pause=function(t){t||(this._isPaused=!0),this._element.querySelector(nt)&&(m.triggerTransitionEnd(this._element),this.cycle(!0)),clearInterval(this._interval),this._interval=null},t.cycle=function(t){t||(this._isPaused=!1),this._interval&&(clearInterval(this._interval),this._interval=null),this._config.interval&&!this._isPaused&&(this._interval=setInterval((document.visibilityState?this.nextWhenVisible:this.next).bind(this),this._config.interval))},t.to=function(t){var e=this;this._activeElement=this._element.querySelector(Z);var n=this._getItemIndex(this._activeElement);if(!(t>this._items.length-1||t<0))if(this._isSliding)p(this._element).one(q.SLID,function(){return e.to(t)});else{if(n===t)return this.pause(),void this.cycle();var i=n<t?M:W;this._slide(i,this._items[t])}},t.dispose=function(){p(this._element).off(P),p.removeData(this._element,x),this._items=null,this._config=null,this._element=null,this._interval=null,this._isPaused=null,this._isSliding=null,this._activeElement=null,this._indicatorsElement=null},t._getConfig=function(t){return t=l({},R,t),m.typeCheckConfig(L,t,F),t},t._handleSwipe=function(){var t=Math.abs(this.touchDeltaX);if(!(t<=40)){var e=t/this.touchDeltaX;0<e&&this.prev(),e<0&&this.next()}},t._addEventListeners=function(){var e=this;this._config.keyboard&&p(this._element).on(q.KEYDOWN,function(t){return e._keydown(t)}),"hover"===this._config.pause&&p(this._element).on(q.MOUSEENTER,function(t){return e.pause(t)}).on(q.MOUSELEAVE,function(t){return e.cycle(t)}),this._config.touch&&this._addTouchEventListeners()},t._addTouchEventListeners=function(){var n=this;if(this._touchSupported){var e=function(t){n._pointerEvent&&st[t.originalEvent.pointerType.toUpperCase()]?n.touchStartX=t.originalEvent.clientX:n._pointerEvent||(n.touchStartX=t.originalEvent.touches[0].clientX)},i=function(t){n._pointerEvent&&st[t.originalEvent.pointerType.toUpperCase()]&&(n.touchDeltaX=t.originalEvent.clientX-n.touchStartX),n._handleSwipe(),"hover"===n._config.pause&&(n.pause(),n.touchTimeout&&clearTimeout(n.touchTimeout),n.touchTimeout=setTimeout(function(t){return n.cycle(t)},500+n._config.interval))};p(this._element.querySelectorAll(et)).on(q.DRAG_START,function(t){return t.preventDefault()}),this._pointerEvent?(p(this._element).on(q.POINTERDOWN,function(t){return e(t)}),p(this._element).on(q.POINTERUP,function(t){return i(t)}),this._element.classList.add($)):(p(this._element).on(q.TOUCHSTART,function(t){return e(t)}),p(this._element).on(q.TOUCHMOVE,function(t){var e;(e=t).originalEvent.touches&&1<e.originalEvent.touches.length?n.touchDeltaX=0:n.touchDeltaX=e.originalEvent.touches[0].clientX-n.touchStartX}),p(this._element).on(q.TOUCHEND,function(t){return i(t)}))}},t._keydown=function(t){if(!/input|textarea/i.test(t.target.tagName))switch(t.which){case 37:t.preventDefault(),this.prev();break;case 39:t.preventDefault(),this.next()}},t._getItemIndex=function(t){return this._items=t&&t.parentNode?[].slice.call(t.parentNode.querySelectorAll(tt)):[],this._items.indexOf(t)},t._getItemByDirection=function(t,e){var n=t===M,i=t===W,o=this._getItemIndex(e),r=this._items.length-1;if((i&&0===o||n&&o===r)&&!this._config.wrap)return e;var s=(o+(t===W?-1:1))%this._items.length;return-1===s?this._items[this._items.length-1]:this._items[s]},t._triggerSlideEvent=function(t,e){var n=this._getItemIndex(t),i=this._getItemIndex(this._element.querySelector(Z)),o=p.Event(q.SLIDE,{relatedTarget:t,direction:e,from:i,to:n});return p(this._element).trigger(o),o},t._setActiveIndicatorElement=function(t){if(this._indicatorsElement){var e=[].slice.call(this._indicatorsElement.querySelectorAll(J));p(e).removeClass(Q);var n=this._indicatorsElement.children[this._getItemIndex(t)];n&&p(n).addClass(Q)}},t._slide=function(t,e){var n,i,o,r=this,s=this._element.querySelector(Z),a=this._getItemIndex(s),l=e||s&&this._getItemByDirection(t,s),c=this._getItemIndex(l),h=Boolean(this._interval);if(o=t===M?(n=z,i=X,U):(n=Y,i=G,B),l&&p(l).hasClass(Q))this._isSliding=!1;else if(!this._triggerSlideEvent(l,o).isDefaultPrevented()&&s&&l){this._isSliding=!0,h&&this.pause(),this._setActiveIndicatorElement(l);var u=p.Event(q.SLID,{relatedTarget:l,direction:o,from:a,to:c});if(p(this._element).hasClass(V)){p(l).addClass(i),m.reflow(l),p(s).addClass(n),p(l).addClass(n);var f=parseInt(l.getAttribute("data-interval"),10);this._config.interval=f?(this._config.defaultInterval=this._config.defaultInterval||this._config.interval,f):this._config.defaultInterval||this._config.interval;var d=m.getTransitionDurationFromElement(s);p(s).one(m.TRANSITION_END,function(){p(l).removeClass(n+" "+i).addClass(Q),p(s).removeClass(Q+" "+i+" "+n),r._isSliding=!1,setTimeout(function(){return p(r._element).trigger(u)},0)}).emulateTransitionEnd(d)}else p(s).removeClass(Q),p(l).addClass(Q),this._isSliding=!1,p(this._element).trigger(u);h&&this.cycle()}},r._jQueryInterface=function(i){return this.each(function(){var t=p(this).data(x),e=l({},R,p(this).data());"object"==typeof i&&(e=l({},e,i));var n="string"==typeof i?i:e.slide;if(t||(t=new r(this,e),p(this).data(x,t)),"number"==typeof i)t.to(i);else if("string"==typeof n){if("undefined"==typeof t[n])throw new TypeError('No method named "'+n+'"');t[n]()}else e.interval&&e.ride&&(t.pause(),t.cycle())})},r._dataApiClickHandler=function(t){var e=m.getSelectorFromElement(this);if(e){var n=p(e)[0];if(n&&p(n).hasClass(K)){var i=l({},p(n).data(),p(this).data()),o=this.getAttribute("data-slide-to");o&&(i.interval=!1),r._jQueryInterface.call(p(n),i),o&&p(n).data(x).to(o),t.preventDefault()}}},s(r,null,[{key:"VERSION",get:function(){return"4.3.1"}},{key:"Default",get:function(){return R}}]),r}();p(document).on(q.CLICK_DATA_API,ot,at._dataApiClickHandler),p(window).on(q.LOAD_DATA_API,function(){for(var t=[].slice.call(document.querySelectorAll(rt)),e=0,n=t.length;e<n;e++){var i=p(t[e]);at._jQueryInterface.call(i,i.data())}}),p.fn[L]=at._jQueryInterface,p.fn[L].Constructor=at,p.fn[L].noConflict=function(){return p.fn[L]=j,at._jQueryInterface};var lt="collapse",ct="bs.collapse",ht="."+ct,ut=p.fn[lt],ft={toggle:!0,parent:""},dt={toggle:"boolean",parent:"(string|element)"},pt={SHOW:"show"+ht,SHOWN:"shown"+ht,HIDE:"hide"+ht,HIDDEN:"hidden"+ht,CLICK_DATA_API:"click"+ht+".data-api"},mt="show",gt="collapse",_t="collapsing",vt="collapsed",yt="width",Et="height",bt=".show, .collapsing",wt='[data-toggle="collapse"]',Ct=function(){function a(e,t){this._isTransitioning=!1,this._element=e,this._config=this._getConfig(t),this._triggerArray=[].slice.call(document.querySelectorAll('[data-toggle="collapse"][href="#'+e.id+'"],[data-toggle="collapse"][data-target="#'+e.id+'"]'));for(var n=[].slice.call(document.querySelectorAll(wt)),i=0,o=n.length;i<o;i++){var r=n[i],s=m.getSelectorFromElement(r),a=[].slice.call(document.querySelectorAll(s)).filter(function(t){return t===e});null!==s&&0<a.length&&(this._selector=s,this._triggerArray.push(r))}this._parent=this._config.parent?this._getParent():null,this._config.parent||this._addAriaAndCollapsedClass(this._element,this._triggerArray),this._config.toggle&&this.toggle()}var t=a.prototype;return t.toggle=function(){p(this._element).hasClass(mt)?this.hide():this.show()},t.show=function(){var t,e,n=this;if(!this._isTransitioning&&!p(this._element).hasClass(mt)&&(this._parent&&0===(t=[].slice.call(this._parent.querySelectorAll(bt)).filter(function(t){return"string"==typeof n._config.parent?t.getAttribute("data-parent")===n._config.parent:t.classList.contains(gt)})).length&&(t=null),!(t&&(e=p(t).not(this._selector).data(ct))&&e._isTransitioning))){var i=p.Event(pt.SHOW);if(p(this._element).trigger(i),!i.isDefaultPrevented()){t&&(a._jQueryInterface.call(p(t).not(this._selector),"hide"),e||p(t).data(ct,null));var o=this._getDimension();p(this._element).removeClass(gt).addClass(_t),this._element.style[o]=0,this._triggerArray.length&&p(this._triggerArray).removeClass(vt).attr("aria-expanded",!0),this.setTransitioning(!0);var r="scroll"+(o[0].toUpperCase()+o.slice(1)),s=m.getTransitionDurationFromElement(this._element);p(this._element).one(m.TRANSITION_END,function(){p(n._element).removeClass(_t).addClass(gt).addClass(mt),n._element.style[o]="",n.setTransitioning(!1),p(n._element).trigger(pt.SHOWN)}).emulateTransitionEnd(s),this._element.style[o]=this._element[r]+"px"}}},t.hide=function(){var t=this;if(!this._isTransitioning&&p(this._element).hasClass(mt)){var e=p.Event(pt.HIDE);if(p(this._element).trigger(e),!e.isDefaultPrevented()){var n=this._getDimension();this._element.style[n]=this._element.getBoundingClientRect()[n]+"px",m.reflow(this._element),p(this._element).addClass(_t).removeClass(gt).removeClass(mt);var i=this._triggerArray.length;if(0<i)for(var o=0;o<i;o++){var r=this._triggerArray[o],s=m.getSelectorFromElement(r);if(null!==s)p([].slice.call(document.querySelectorAll(s))).hasClass(mt)||p(r).addClass(vt).attr("aria-expanded",!1)}this.setTransitioning(!0);this._element.style[n]="";var a=m.getTransitionDurationFromElement(this._element);p(this._element).one(m.TRANSITION_END,function(){t.setTransitioning(!1),p(t._element).removeClass(_t).addClass(gt).trigger(pt.HIDDEN)}).emulateTransitionEnd(a)}}},t.setTransitioning=function(t){this._isTransitioning=t},t.dispose=function(){p.removeData(this._element,ct),this._config=null,this._parent=null,this._element=null,this._triggerArray=null,this._isTransitioning=null},t._getConfig=function(t){return(t=l({},ft,t)).toggle=Boolean(t.toggle),m.typeCheckConfig(lt,t,dt),t},t._getDimension=function(){return p(this._element).hasClass(yt)?yt:Et},t._getParent=function(){var t,n=this;m.isElement(this._config.parent)?(t=this._config.parent,"undefined"!=typeof this._config.parent.jquery&&(t=this._config.parent[0])):t=document.querySelector(this._config.parent);var e='[data-toggle="collapse"][data-parent="'+this._config.parent+'"]',i=[].slice.call(t.querySelectorAll(e));return p(i).each(function(t,e){n._addAriaAndCollapsedClass(a._getTargetFromElement(e),[e])}),t},t._addAriaAndCollapsedClass=function(t,e){var n=p(t).hasClass(mt);e.length&&p(e).toggleClass(vt,!n).attr("aria-expanded",n)},a._getTargetFromElement=function(t){var e=m.getSelectorFromElement(t);return e?document.querySelector(e):null},a._jQueryInterface=function(i){return this.each(function(){var t=p(this),e=t.data(ct),n=l({},ft,t.data(),"object"==typeof i&&i?i:{});if(!e&&n.toggle&&/show|hide/.test(i)&&(n.toggle=!1),e||(e=new a(this,n),t.data(ct,e)),"string"==typeof i){if("undefined"==typeof e[i])throw new TypeError('No method named "'+i+'"');e[i]()}})},s(a,null,[{key:"VERSION",get:function(){return"4.3.1"}},{key:"Default",get:function(){return ft}}]),a}();p(document).on(pt.CLICK_DATA_API,wt,function(t){"A"===t.currentTarget.tagName&&t.preventDefault();var n=p(this),e=m.getSelectorFromElement(this),i=[].slice.call(document.querySelectorAll(e));p(i).each(function(){var t=p(this),e=t.data(ct)?"toggle":n.data();Ct._jQueryInterface.call(t,e)})}),p.fn[lt]=Ct._jQueryInterface,p.fn[lt].Constructor=Ct,p.fn[lt].noConflict=function(){return p.fn[lt]=ut,Ct._jQueryInterface};for(var Tt="undefined"!=typeof window&&"undefined"!=typeof document,St=["Edge","Trident","Firefox"],Dt=0,It=0;It<St.length;It+=1)if(Tt&&0<=navigator.userAgent.indexOf(St[It])){Dt=1;break}var At=Tt&&window.Promise?function(t){var e=!1;return function(){e||(e=!0,window.Promise.resolve().then(function(){e=!1,t()}))}}:function(t){var e=!1;return function(){e||(e=!0,setTimeout(function(){e=!1,t()},Dt))}};function Ot(t){return t&&"[object Function]"==={}.toString.call(t)}function Nt(t,e){if(1!==t.nodeType)return[];var n=t.ownerDocument.defaultView.getComputedStyle(t,null);return e?n[e]:n}function kt(t){return"HTML"===t.nodeName?t:t.parentNode||t.host}function Lt(t){if(!t)return document.body;switch(t.nodeName){case"HTML":case"BODY":return t.ownerDocument.body;case"#document":return t.body}var e=Nt(t),n=e.overflow,i=e.overflowX,o=e.overflowY;return/(auto|scroll|overlay)/.test(n+o+i)?t:Lt(kt(t))}var xt=Tt&&!(!window.MSInputMethodContext||!document.documentMode),Pt=Tt&&/MSIE 10/.test(navigator.userAgent);function Ht(t){return 11===t?xt:10===t?Pt:xt||Pt}function jt(t){if(!t)return document.documentElement;for(var e=Ht(10)?document.body:null,n=t.offsetParent||null;n===e&&t.nextElementSibling;)n=(t=t.nextElementSibling).offsetParent;var i=n&&n.nodeName;return i&&"BODY"!==i&&"HTML"!==i?-1!==["TH","TD","TABLE"].indexOf(n.nodeName)&&"static"===Nt(n,"position")?jt(n):n:t?t.ownerDocument.documentElement:document.documentElement}function Rt(t){return null!==t.parentNode?Rt(t.parentNode):t}function Ft(t,e){if(!(t&&t.nodeType&&e&&e.nodeType))return document.documentElement;var n=t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_FOLLOWING,i=n?t:e,o=n?e:t,r=document.createRange();r.setStart(i,0),r.setEnd(o,0);var s,a,l=r.commonAncestorContainer;if(t!==l&&e!==l||i.contains(o))return"BODY"===(a=(s=l).nodeName)||"HTML"!==a&&jt(s.firstElementChild)!==s?jt(l):l;var c=Rt(t);return c.host?Ft(c.host,e):Ft(t,Rt(e).host)}function Mt(t){var e="top"===(1<arguments.length&&void 0!==arguments[1]?arguments[1]:"top")?"scrollTop":"scrollLeft",n=t.nodeName;if("BODY"!==n&&"HTML"!==n)return t[e];var i=t.ownerDocument.documentElement;return(t.ownerDocument.scrollingElement||i)[e]}function Wt(t,e){var n="x"===e?"Left":"Top",i="Left"===n?"Right":"Bottom";return parseFloat(t["border"+n+"Width"],10)+parseFloat(t["border"+i+"Width"],10)}function Ut(t,e,n,i){return Math.max(e["offset"+t],e["scroll"+t],n["client"+t],n["offset"+t],n["scroll"+t],Ht(10)?parseInt(n["offset"+t])+parseInt(i["margin"+("Height"===t?"Top":"Left")])+parseInt(i["margin"+("Height"===t?"Bottom":"Right")]):0)}function Bt(t){var e=t.body,n=t.documentElement,i=Ht(10)&&getComputedStyle(n);return{height:Ut("Height",e,n,i),width:Ut("Width",e,n,i)}}var qt=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),Kt=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},Qt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};function Vt(t){return Qt({},t,{right:t.left+t.width,bottom:t.top+t.height})}function Yt(t){var e={};try{if(Ht(10)){e=t.getBoundingClientRect();var n=Mt(t,"top"),i=Mt(t,"left");e.top+=n,e.left+=i,e.bottom+=n,e.right+=i}else e=t.getBoundingClientRect()}catch(t){}var o={left:e.left,top:e.top,width:e.right-e.left,height:e.bottom-e.top},r="HTML"===t.nodeName?Bt(t.ownerDocument):{},s=r.width||t.clientWidth||o.right-o.left,a=r.height||t.clientHeight||o.bottom-o.top,l=t.offsetWidth-s,c=t.offsetHeight-a;if(l||c){var h=Nt(t);l-=Wt(h,"x"),c-=Wt(h,"y"),o.width-=l,o.height-=c}return Vt(o)}function zt(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=Ht(10),o="HTML"===e.nodeName,r=Yt(t),s=Yt(e),a=Lt(t),l=Nt(e),c=parseFloat(l.borderTopWidth,10),h=parseFloat(l.borderLeftWidth,10);n&&o&&(s.top=Math.max(s.top,0),s.left=Math.max(s.left,0));var u=Vt({top:r.top-s.top-c,left:r.left-s.left-h,width:r.width,height:r.height});if(u.marginTop=0,u.marginLeft=0,!i&&o){var f=parseFloat(l.marginTop,10),d=parseFloat(l.marginLeft,10);u.top-=c-f,u.bottom-=c-f,u.left-=h-d,u.right-=h-d,u.marginTop=f,u.marginLeft=d}return(i&&!n?e.contains(a):e===a&&"BODY"!==a.nodeName)&&(u=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=Mt(e,"top"),o=Mt(e,"left"),r=n?-1:1;return t.top+=i*r,t.bottom+=i*r,t.left+=o*r,t.right+=o*r,t}(u,e)),u}function Xt(t){if(!t||!t.parentElement||Ht())return document.documentElement;for(var e=t.parentElement;e&&"none"===Nt(e,"transform");)e=e.parentElement;return e||document.documentElement}function Gt(t,e,n,i){var o=4<arguments.length&&void 0!==arguments[4]&&arguments[4],r={top:0,left:0},s=o?Xt(t):Ft(t,e);if("viewport"===i)r=function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=t.ownerDocument.documentElement,i=zt(t,n),o=Math.max(n.clientWidth,window.innerWidth||0),r=Math.max(n.clientHeight,window.innerHeight||0),s=e?0:Mt(n),a=e?0:Mt(n,"left");return Vt({top:s-i.top+i.marginTop,left:a-i.left+i.marginLeft,width:o,height:r})}(s,o);else{var a=void 0;"scrollParent"===i?"BODY"===(a=Lt(kt(e))).nodeName&&(a=t.ownerDocument.documentElement):a="window"===i?t.ownerDocument.documentElement:i;var l=zt(a,s,o);if("HTML"!==a.nodeName||function t(e){var n=e.nodeName;if("BODY"===n||"HTML"===n)return!1;if("fixed"===Nt(e,"position"))return!0;var i=kt(e);return!!i&&t(i)}(s))r=l;else{var c=Bt(t.ownerDocument),h=c.height,u=c.width;r.top+=l.top-l.marginTop,r.bottom=h+l.top,r.left+=l.left-l.marginLeft,r.right=u+l.left}}var f="number"==typeof(n=n||0);return r.left+=f?n:n.left||0,r.top+=f?n:n.top||0,r.right-=f?n:n.right||0,r.bottom-=f?n:n.bottom||0,r}function $t(t,e,i,n,o){var r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0;if(-1===t.indexOf("auto"))return t;var s=Gt(i,n,r,o),a={top:{width:s.width,height:e.top-s.top},right:{width:s.right-e.right,height:s.height},bottom:{width:s.width,height:s.bottom-e.bottom},left:{width:e.left-s.left,height:s.height}},l=Object.keys(a).map(function(t){return Qt({key:t},a[t],{area:(e=a[t],e.width*e.height)});var e}).sort(function(t,e){return e.area-t.area}),c=l.filter(function(t){var e=t.width,n=t.height;return e>=i.clientWidth&&n>=i.clientHeight}),h=0<c.length?c[0].key:l[0].key,u=t.split("-")[1];return h+(u?"-"+u:"")}function Jt(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return zt(n,i?Xt(e):Ft(e,n),i)}function Zt(t){var e=t.ownerDocument.defaultView.getComputedStyle(t),n=parseFloat(e.marginTop||0)+parseFloat(e.marginBottom||0),i=parseFloat(e.marginLeft||0)+parseFloat(e.marginRight||0);return{width:t.offsetWidth+i,height:t.offsetHeight+n}}function te(t){var e={left:"right",right:"left",bottom:"top",top:"bottom"};return t.replace(/left|right|bottom|top/g,function(t){return e[t]})}function ee(t,e,n){n=n.split("-")[0];var i=Zt(t),o={width:i.width,height:i.height},r=-1!==["right","left"].indexOf(n),s=r?"top":"left",a=r?"left":"top",l=r?"height":"width",c=r?"width":"height";return o[s]=e[s]+e[l]/2-i[l]/2,o[a]=n===a?e[a]-i[c]:e[te(a)],o}function ne(t,e){return Array.prototype.find?t.find(e):t.filter(e)[0]}function ie(t,n,e){return(void 0===e?t:t.slice(0,function(t,e,n){if(Array.prototype.findIndex)return t.findIndex(function(t){return t[e]===n});var i=ne(t,function(t){return t[e]===n});return t.indexOf(i)}(t,"name",e))).forEach(function(t){t.function&&console.warn("`modifier.function` is deprecated, use `modifier.fn`!");var e=t.function||t.fn;t.enabled&&Ot(e)&&(n.offsets.popper=Vt(n.offsets.popper),n.offsets.reference=Vt(n.offsets.reference),n=e(n,t))}),n}function oe(t,n){return t.some(function(t){var e=t.name;return t.enabled&&e===n})}function re(t){for(var e=[!1,"ms","Webkit","Moz","O"],n=t.charAt(0).toUpperCase()+t.slice(1),i=0;i<e.length;i++){var o=e[i],r=o?""+o+n:t;if("undefined"!=typeof document.body.style[r])return r}return null}function se(t){var e=t.ownerDocument;return e?e.defaultView:window}function ae(t,e,n,i){n.updateBound=i,se(t).addEventListener("resize",n.updateBound,{passive:!0});var o=Lt(t);return function t(e,n,i,o){var r="BODY"===e.nodeName,s=r?e.ownerDocument.defaultView:e;s.addEventListener(n,i,{passive:!0}),r||t(Lt(s.parentNode),n,i,o),o.push(s)}(o,"scroll",n.updateBound,n.scrollParents),n.scrollElement=o,n.eventsEnabled=!0,n}function le(){var t,e;this.state.eventsEnabled&&(cancelAnimationFrame(this.scheduleUpdate),this.state=(t=this.reference,e=this.state,se(t).removeEventListener("resize",e.updateBound),e.scrollParents.forEach(function(t){t.removeEventListener("scroll",e.updateBound)}),e.updateBound=null,e.scrollParents=[],e.scrollElement=null,e.eventsEnabled=!1,e))}function ce(t){return""!==t&&!isNaN(parseFloat(t))&&isFinite(t)}function he(n,i){Object.keys(i).forEach(function(t){var e="";-1!==["width","height","top","right","bottom","left"].indexOf(t)&&ce(i[t])&&(e="px"),n.style[t]=i[t]+e})}var ue=Tt&&/Firefox/i.test(navigator.userAgent);function fe(t,e,n){var i=ne(t,function(t){return t.name===e}),o=!!i&&t.some(function(t){return t.name===n&&t.enabled&&t.order<i.order});if(!o){var r="`"+e+"`",s="`"+n+"`";console.warn(s+" modifier is required by "+r+" modifier in order to work, be sure to include it before "+r+"!")}return o}var de=["auto-start","auto","auto-end","top-start","top","top-end","right-start","right","right-end","bottom-end","bottom","bottom-start","left-end","left","left-start"],pe=de.slice(3);function me(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=pe.indexOf(t),i=pe.slice(n+1).concat(pe.slice(0,n));return e?i.reverse():i}var ge="flip",_e="clockwise",ve="counterclockwise";function ye(t,o,r,e){var s=[0,0],a=-1!==["right","left"].indexOf(e),n=t.split(/(\+|\-)/).map(function(t){return t.trim()}),i=n.indexOf(ne(n,function(t){return-1!==t.search(/,|\s/)}));n[i]&&-1===n[i].indexOf(",")&&console.warn("Offsets separated by white space(s) are deprecated, use a comma (,) instead.");var l=/\s*,\s*|\s+/,c=-1!==i?[n.slice(0,i).concat([n[i].split(l)[0]]),[n[i].split(l)[1]].concat(n.slice(i+1))]:[n];return(c=c.map(function(t,e){var n=(1===e?!a:a)?"height":"width",i=!1;return t.reduce(function(t,e){return""===t[t.length-1]&&-1!==["+","-"].indexOf(e)?(t[t.length-1]=e,i=!0,t):i?(t[t.length-1]+=e,i=!1,t):t.concat(e)},[]).map(function(t){return function(t,e,n,i){var o=t.match(/((?:\-|\+)?\d*\.?\d*)(.*)/),r=+o[1],s=o[2];if(!r)return t;if(0!==s.indexOf("%"))return"vh"!==s&&"vw"!==s?r:("vh"===s?Math.max(document.documentElement.clientHeight,window.innerHeight||0):Math.max(document.documentElement.clientWidth,window.innerWidth||0))/100*r;var a=void 0;switch(s){case"%p":a=n;break;case"%":case"%r":default:a=i}return Vt(a)[e]/100*r}(t,n,o,r)})})).forEach(function(n,i){n.forEach(function(t,e){ce(t)&&(s[i]+=t*("-"===n[e-1]?-1:1))})}),s}var Ee={placement:"bottom",positionFixed:!1,eventsEnabled:!0,removeOnDestroy:!1,onCreate:function(){},onUpdate:function(){},modifiers:{shift:{order:100,enabled:!0,fn:function(t){var e=t.placement,n=e.split("-")[0],i=e.split("-")[1];if(i){var o=t.offsets,r=o.reference,s=o.popper,a=-1!==["bottom","top"].indexOf(n),l=a?"left":"top",c=a?"width":"height",h={start:Kt({},l,r[l]),end:Kt({},l,r[l]+r[c]-s[c])};t.offsets.popper=Qt({},s,h[i])}return t}},offset:{order:200,enabled:!0,fn:function(t,e){var n=e.offset,i=t.placement,o=t.offsets,r=o.popper,s=o.reference,a=i.split("-")[0],l=void 0;return l=ce(+n)?[+n,0]:ye(n,r,s,a),"left"===a?(r.top+=l[0],r.left-=l[1]):"right"===a?(r.top+=l[0],r.left+=l[1]):"top"===a?(r.left+=l[0],r.top-=l[1]):"bottom"===a&&(r.left+=l[0],r.top+=l[1]),t.popper=r,t},offset:0},preventOverflow:{order:300,enabled:!0,fn:function(t,i){var e=i.boundariesElement||jt(t.instance.popper);t.instance.reference===e&&(e=jt(e));var n=re("transform"),o=t.instance.popper.style,r=o.top,s=o.left,a=o[n];o.top="",o.left="",o[n]="";var l=Gt(t.instance.popper,t.instance.reference,i.padding,e,t.positionFixed);o.top=r,o.left=s,o[n]=a,i.boundaries=l;var c=i.priority,h=t.offsets.popper,u={primary:function(t){var e=h[t];return h[t]<l[t]&&!i.escapeWithReference&&(e=Math.max(h[t],l[t])),Kt({},t,e)},secondary:function(t){var e="right"===t?"left":"top",n=h[e];return h[t]>l[t]&&!i.escapeWithReference&&(n=Math.min(h[e],l[t]-("right"===t?h.width:h.height))),Kt({},e,n)}};return c.forEach(function(t){var e=-1!==["left","top"].indexOf(t)?"primary":"secondary";h=Qt({},h,u[e](t))}),t.offsets.popper=h,t},priority:["left","right","top","bottom"],padding:5,boundariesElement:"scrollParent"},keepTogether:{order:400,enabled:!0,fn:function(t){var e=t.offsets,n=e.popper,i=e.reference,o=t.placement.split("-")[0],r=Math.floor,s=-1!==["top","bottom"].indexOf(o),a=s?"right":"bottom",l=s?"left":"top",c=s?"width":"height";return n[a]<r(i[l])&&(t.offsets.popper[l]=r(i[l])-n[c]),n[l]>r(i[a])&&(t.offsets.popper[l]=r(i[a])),t}},arrow:{order:500,enabled:!0,fn:function(t,e){var n;if(!fe(t.instance.modifiers,"arrow","keepTogether"))return t;var i=e.element;if("string"==typeof i){if(!(i=t.instance.popper.querySelector(i)))return t}else if(!t.instance.popper.contains(i))return console.warn("WARNING: `arrow.element` must be child of its popper element!"),t;var o=t.placement.split("-")[0],r=t.offsets,s=r.popper,a=r.reference,l=-1!==["left","right"].indexOf(o),c=l?"height":"width",h=l?"Top":"Left",u=h.toLowerCase(),f=l?"left":"top",d=l?"bottom":"right",p=Zt(i)[c];a[d]-p<s[u]&&(t.offsets.popper[u]-=s[u]-(a[d]-p)),a[u]+p>s[d]&&(t.offsets.popper[u]+=a[u]+p-s[d]),t.offsets.popper=Vt(t.offsets.popper);var m=a[u]+a[c]/2-p/2,g=Nt(t.instance.popper),_=parseFloat(g["margin"+h],10),v=parseFloat(g["border"+h+"Width"],10),y=m-t.offsets.popper[u]-_-v;return y=Math.max(Math.min(s[c]-p,y),0),t.arrowElement=i,t.offsets.arrow=(Kt(n={},u,Math.round(y)),Kt(n,f,""),n),t},element:"[x-arrow]"},flip:{order:600,enabled:!0,fn:function(p,m){if(oe(p.instance.modifiers,"inner"))return p;if(p.flipped&&p.placement===p.originalPlacement)return p;var g=Gt(p.instance.popper,p.instance.reference,m.padding,m.boundariesElement,p.positionFixed),_=p.placement.split("-")[0],v=te(_),y=p.placement.split("-")[1]||"",E=[];switch(m.behavior){case ge:E=[_,v];break;case _e:E=me(_);break;case ve:E=me(_,!0);break;default:E=m.behavior}return E.forEach(function(t,e){if(_!==t||E.length===e+1)return p;_=p.placement.split("-")[0],v=te(_);var n,i=p.offsets.popper,o=p.offsets.reference,r=Math.floor,s="left"===_&&r(i.right)>r(o.left)||"right"===_&&r(i.left)<r(o.right)||"top"===_&&r(i.bottom)>r(o.top)||"bottom"===_&&r(i.top)<r(o.bottom),a=r(i.left)<r(g.left),l=r(i.right)>r(g.right),c=r(i.top)<r(g.top),h=r(i.bottom)>r(g.bottom),u="left"===_&&a||"right"===_&&l||"top"===_&&c||"bottom"===_&&h,f=-1!==["top","bottom"].indexOf(_),d=!!m.flipVariations&&(f&&"start"===y&&a||f&&"end"===y&&l||!f&&"start"===y&&c||!f&&"end"===y&&h);(s||u||d)&&(p.flipped=!0,(s||u)&&(_=E[e+1]),d&&(y="end"===(n=y)?"start":"start"===n?"end":n),p.placement=_+(y?"-"+y:""),p.offsets.popper=Qt({},p.offsets.popper,ee(p.instance.popper,p.offsets.reference,p.placement)),p=ie(p.instance.modifiers,p,"flip"))}),p},behavior:"flip",padding:5,boundariesElement:"viewport"},inner:{order:700,enabled:!1,fn:function(t){var e=t.placement,n=e.split("-")[0],i=t.offsets,o=i.popper,r=i.reference,s=-1!==["left","right"].indexOf(n),a=-1===["top","left"].indexOf(n);return o[s?"left":"top"]=r[n]-(a?o[s?"width":"height"]:0),t.placement=te(e),t.offsets.popper=Vt(o),t}},hide:{order:800,enabled:!0,fn:function(t){if(!fe(t.instance.modifiers,"hide","preventOverflow"))return t;var e=t.offsets.reference,n=ne(t.instance.modifiers,function(t){return"preventOverflow"===t.name}).boundaries;if(e.bottom<n.top||e.left>n.right||e.top>n.bottom||e.right<n.left){if(!0===t.hide)return t;t.hide=!0,t.attributes["x-out-of-boundaries"]=""}else{if(!1===t.hide)return t;t.hide=!1,t.attributes["x-out-of-boundaries"]=!1}return t}},computeStyle:{order:850,enabled:!0,fn:function(t,e){var n=e.x,i=e.y,o=t.offsets.popper,r=ne(t.instance.modifiers,function(t){return"applyStyle"===t.name}).gpuAcceleration;void 0!==r&&console.warn("WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!");var s,a,l,c,h,u,f,d,p,m,g,_,v,y,E=void 0!==r?r:e.gpuAcceleration,b=jt(t.instance.popper),w=Yt(b),C={position:o.position},T=(s=t,a=window.devicePixelRatio<2||!ue,l=s.offsets,c=l.popper,h=l.reference,u=Math.round,f=Math.floor,d=function(t){return t},p=u(h.width),m=u(c.width),g=-1!==["left","right"].indexOf(s.placement),_=-1!==s.placement.indexOf("-"),y=a?u:d,{left:(v=a?g||_||p%2==m%2?u:f:d)(p%2==1&&m%2==1&&!_&&a?c.left-1:c.left),top:y(c.top),bottom:y(c.bottom),right:v(c.right)}),S="bottom"===n?"top":"bottom",D="right"===i?"left":"right",I=re("transform"),A=void 0,O=void 0;if(O="bottom"===S?"HTML"===b.nodeName?-b.clientHeight+T.bottom:-w.height+T.bottom:T.top,A="right"===D?"HTML"===b.nodeName?-b.clientWidth+T.right:-w.width+T.right:T.left,E&&I)C[I]="translate3d("+A+"px, "+O+"px, 0)",C[S]=0,C[D]=0,C.willChange="transform";else{var N="bottom"===S?-1:1,k="right"===D?-1:1;C[S]=O*N,C[D]=A*k,C.willChange=S+", "+D}var L={"x-placement":t.placement};return t.attributes=Qt({},L,t.attributes),t.styles=Qt({},C,t.styles),t.arrowStyles=Qt({},t.offsets.arrow,t.arrowStyles),t},gpuAcceleration:!0,x:"bottom",y:"right"},applyStyle:{order:900,enabled:!0,fn:function(t){var e,n;return he(t.instance.popper,t.styles),e=t.instance.popper,n=t.attributes,Object.keys(n).forEach(function(t){!1!==n[t]?e.setAttribute(t,n[t]):e.removeAttribute(t)}),t.arrowElement&&Object.keys(t.arrowStyles).length&&he(t.arrowElement,t.arrowStyles),t},onLoad:function(t,e,n,i,o){var r=Jt(o,e,t,n.positionFixed),s=$t(n.placement,r,e,t,n.modifiers.flip.boundariesElement,n.modifiers.flip.padding);return e.setAttribute("x-placement",s),he(e,{position:n.positionFixed?"fixed":"absolute"}),n},gpuAcceleration:void 0}}},be=function(){function r(t,e){var n=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),this.scheduleUpdate=function(){return requestAnimationFrame(n.update)},this.update=At(this.update.bind(this)),this.options=Qt({},r.Defaults,i),this.state={isDestroyed:!1,isCreated:!1,scrollParents:[]},this.reference=t&&t.jquery?t[0]:t,this.popper=e&&e.jquery?e[0]:e,this.options.modifiers={},Object.keys(Qt({},r.Defaults.modifiers,i.modifiers)).forEach(function(t){n.options.modifiers[t]=Qt({},r.Defaults.modifiers[t]||{},i.modifiers?i.modifiers[t]:{})}),this.modifiers=Object.keys(this.options.modifiers).map(function(t){return Qt({name:t},n.options.modifiers[t])}).sort(function(t,e){return t.order-e.order}),this.modifiers.forEach(function(t){t.enabled&&Ot(t.onLoad)&&t.onLoad(n.reference,n.popper,n.options,t,n.state)}),this.update();var o=this.options.eventsEnabled;o&&this.enableEventListeners(),this.state.eventsEnabled=o}return qt(r,[{key:"update",value:function(){return function(){if(!this.state.isDestroyed){var t={instance:this,styles:{},arrowStyles:{},attributes:{},flipped:!1,offsets:{}};t.offsets.reference=Jt(this.state,this.popper,this.reference,this.options.positionFixed),t.placement=$t(this.options.placement,t.offsets.reference,this.popper,this.reference,this.options.modifiers.flip.boundariesElement,this.options.modifiers.flip.padding),t.originalPlacement=t.placement,t.positionFixed=this.options.positionFixed,t.offsets.popper=ee(this.popper,t.offsets.reference,t.placement),t.offsets.popper.position=this.options.positionFixed?"fixed":"absolute",t=ie(this.modifiers,t),this.state.isCreated?this.options.onUpdate(t):(this.state.isCreated=!0,this.options.onCreate(t))}}.call(this)}},{key:"destroy",value:function(){return function(){return this.state.isDestroyed=!0,oe(this.modifiers,"applyStyle")&&(this.popper.removeAttribute("x-placement"),this.popper.style.position="",this.popper.style.top="",this.popper.style.left="",this.popper.style.right="",this.popper.style.bottom="",this.popper.style.willChange="",this.popper.style[re("transform")]=""),this.disableEventListeners(),this.options.removeOnDestroy&&this.popper.parentNode.removeChild(this.popper),this}.call(this)}},{key:"enableEventListeners",value:function(){return function(){this.state.eventsEnabled||(this.state=ae(this.reference,this.options,this.state,this.scheduleUpdate))}.call(this)}},{key:"disableEventListeners",value:function(){return le.call(this)}}]),r}();be.Utils=("undefined"!=typeof window?window:global).PopperUtils,be.placements=de,be.Defaults=Ee;var we="dropdown",Ce="bs.dropdown",Te="."+Ce,Se=".data-api",De=p.fn[we],Ie=new RegExp("38|40|27"),Ae={HIDE:"hide"+Te,HIDDEN:"hidden"+Te,SHOW:"show"+Te,SHOWN:"shown"+Te,CLICK:"click"+Te,CLICK_DATA_API:"click"+Te+Se,KEYDOWN_DATA_API:"keydown"+Te+Se,KEYUP_DATA_API:"keyup"+Te+Se},Oe="disabled",Ne="show",ke="dropup",Le="dropright",xe="dropleft",Pe="dropdown-menu-right",He="position-static",je='[data-toggle="dropdown"]',Re=".dropdown form",Fe=".dropdown-menu",Me=".navbar-nav",We=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",Ue="top-start",Be="top-end",qe="bottom-start",Ke="bottom-end",Qe="right-start",Ve="left-start",Ye={offset:0,flip:!0,boundary:"scrollParent",reference:"toggle",display:"dynamic"},ze={offset:"(number|string|function)",flip:"boolean",boundary:"(string|element)",reference:"(string|element)",display:"string"},Xe=function(){function c(t,e){this._element=t,this._popper=null,this._config=this._getConfig(e),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar(),this._addEventListeners()}var t=c.prototype;return t.toggle=function(){if(!this._element.disabled&&!p(this._element).hasClass(Oe)){var t=c._getParentFromElement(this._element),e=p(this._menu).hasClass(Ne);if(c._clearMenus(),!e){var n={relatedTarget:this._element},i=p.Event(Ae.SHOW,n);if(p(t).trigger(i),!i.isDefaultPrevented()){if(!this._inNavbar){if("undefined"==typeof be)throw new TypeError("Bootstrap's dropdowns require Popper.js (https://popper.js.org/)");var o=this._element;"parent"===this._config.reference?o=t:m.isElement(this._config.reference)&&(o=this._config.reference,"undefined"!=typeof this._config.reference.jquery&&(o=this._config.reference[0])),"scrollParent"!==this._config.boundary&&p(t).addClass(He),this._popper=new be(o,this._menu,this._getPopperConfig())}"ontouchstart"in document.documentElement&&0===p(t).closest(Me).length&&p(document.body).children().on("mouseover",null,p.noop),this._element.focus(),this._element.setAttribute("aria-expanded",!0),p(this._menu).toggleClass(Ne),p(t).toggleClass(Ne).trigger(p.Event(Ae.SHOWN,n))}}}},t.show=function(){if(!(this._element.disabled||p(this._element).hasClass(Oe)||p(this._menu).hasClass(Ne))){var t={relatedTarget:this._element},e=p.Event(Ae.SHOW,t),n=c._getParentFromElement(this._element);p(n).trigger(e),e.isDefaultPrevented()||(p(this._menu).toggleClass(Ne),p(n).toggleClass(Ne).trigger(p.Event(Ae.SHOWN,t)))}},t.hide=function(){if(!this._element.disabled&&!p(this._element).hasClass(Oe)&&p(this._menu).hasClass(Ne)){var t={relatedTarget:this._element},e=p.Event(Ae.HIDE,t),n=c._getParentFromElement(this._element);p(n).trigger(e),e.isDefaultPrevented()||(p(this._menu).toggleClass(Ne),p(n).toggleClass(Ne).trigger(p.Event(Ae.HIDDEN,t)))}},t.dispose=function(){p.removeData(this._element,Ce),p(this._element).off(Te),this._element=null,(this._menu=null)!==this._popper&&(this._popper.destroy(),this._popper=null)},t.update=function(){this._inNavbar=this._detectNavbar(),null!==this._popper&&this._popper.scheduleUpdate()},t._addEventListeners=function(){var e=this;p(this._element).on(Ae.CLICK,function(t){t.preventDefault(),t.stopPropagation(),e.toggle()})},t._getConfig=function(t){return t=l({},this.constructor.Default,p(this._element).data(),t),m.typeCheckConfig(we,t,this.constructor.DefaultType),t},t._getMenuElement=function(){if(!this._menu){var t=c._getParentFromElement(this._element);t&&(this._menu=t.querySelector(Fe))}return this._menu},t._getPlacement=function(){var t=p(this._element.parentNode),e=qe;return t.hasClass(ke)?(e=Ue,p(this._menu).hasClass(Pe)&&(e=Be)):t.hasClass(Le)?e=Qe:t.hasClass(xe)?e=Ve:p(this._menu).hasClass(Pe)&&(e=Ke),e},t._detectNavbar=function(){return 0<p(this._element).closest(".navbar").length},t._getOffset=function(){var e=this,t={};return"function"==typeof this._config.offset?t.fn=function(t){return t.offsets=l({},t.offsets,e._config.offset(t.offsets,e._element)||{}),t}:t.offset=this._config.offset,t},t._getPopperConfig=function(){var t={placement:this._getPlacement(),modifiers:{offset:this._getOffset(),flip:{enabled:this._config.flip},preventOverflow:{boundariesElement:this._config.boundary}}};return"static"===this._config.display&&(t.modifiers.applyStyle={enabled:!1}),t},c._jQueryInterface=function(e){return this.each(function(){var t=p(this).data(Ce);if(t||(t=new c(this,"object"==typeof e?e:null),p(this).data(Ce,t)),"string"==typeof e){if("undefined"==typeof t[e])throw new TypeError('No method named "'+e+'"');t[e]()}})},c._clearMenus=function(t){if(!t||3!==t.which&&("keyup"!==t.type||9===t.which))for(var e=[].slice.call(document.querySelectorAll(je)),n=0,i=e.length;n<i;n++){var o=c._getParentFromElement(e[n]),r=p(e[n]).data(Ce),s={relatedTarget:e[n]};if(t&&"click"===t.type&&(s.clickEvent=t),r){var a=r._menu;if(p(o).hasClass(Ne)&&!(t&&("click"===t.type&&/input|textarea/i.test(t.target.tagName)||"keyup"===t.type&&9===t.which)&&p.contains(o,t.target))){var l=p.Event(Ae.HIDE,s);p(o).trigger(l),l.isDefaultPrevented()||("ontouchstart"in document.documentElement&&p(document.body).children().off("mouseover",null,p.noop),e[n].setAttribute("aria-expanded","false"),p(a).removeClass(Ne),p(o).removeClass(Ne).trigger(p.Event(Ae.HIDDEN,s)))}}}},c._getParentFromElement=function(t){var e,n=m.getSelectorFromElement(t);return n&&(e=document.querySelector(n)),e||t.parentNode},c._dataApiKeydownHandler=function(t){if((/input|textarea/i.test(t.target.tagName)?!(32===t.which||27!==t.which&&(40!==t.which&&38!==t.which||p(t.target).closest(Fe).length)):Ie.test(t.which))&&(t.preventDefault(),t.stopPropagation(),!this.disabled&&!p(this).hasClass(Oe))){var e=c._getParentFromElement(this),n=p(e).hasClass(Ne);if(n&&(!n||27!==t.which&&32!==t.which)){var i=[].slice.call(e.querySelectorAll(We));if(0!==i.length){var o=i.indexOf(t.target);38===t.which&&0<o&&o--,40===t.which&&o<i.length-1&&o++,o<0&&(o=0),i[o].focus()}}else{if(27===t.which){var r=e.querySelector(je);p(r).trigger("focus")}p(this).trigger("click")}}},s(c,null,[{key:"VERSION",get:function(){return"4.3.1"}},{key:"Default",get:function(){return Ye}},{key:"DefaultType",get:function(){return ze}}]),c}();p(document).on(Ae.KEYDOWN_DATA_API,je,Xe._dataApiKeydownHandler).on(Ae.KEYDOWN_DATA_API,Fe,Xe._dataApiKeydownHandler).on(Ae.CLICK_DATA_API+" "+Ae.KEYUP_DATA_API,Xe._clearMenus).on(Ae.CLICK_DATA_API,je,function(t){t.preventDefault(),t.stopPropagation(),Xe._jQueryInterface.call(p(this),"toggle")}).on(Ae.CLICK_DATA_API,Re,function(t){t.stopPropagation()}),p.fn[we]=Xe._jQueryInterface,p.fn[we].Constructor=Xe,p.fn[we].noConflict=function(){return p.fn[we]=De,Xe._jQueryInterface};var Ge="modal",$e="bs.modal",Je="."+$e,Ze=p.fn[Ge],tn={backdrop:!0,keyboard:!0,focus:!0,show:!0},en={backdrop:"(boolean|string)",keyboard:"boolean",focus:"boolean",show:"boolean"},nn={HIDE:"hide"+Je,HIDDEN:"hidden"+Je,SHOW:"show"+Je,SHOWN:"shown"+Je,FOCUSIN:"focusin"+Je,RESIZE:"resize"+Je,CLICK_DISMISS:"click.dismiss"+Je,KEYDOWN_DISMISS:"keydown.dismiss"+Je,MOUSEUP_DISMISS:"mouseup.dismiss"+Je,MOUSEDOWN_DISMISS:"mousedown.dismiss"+Je,CLICK_DATA_API:"click"+Je+".data-api"},on="modal-dialog-scrollable",rn="modal-scrollbar-measure",sn="modal-backdrop",an="modal-open",ln="fade",cn="show",hn=".modal-dialog",un=".modal-body",fn='[data-toggle="modal"]',dn='[data-dismiss="modal"]',pn=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",mn=".sticky-top",gn=function(){function o(t,e){this._config=this._getConfig(e),this._element=t,this._dialog=t.querySelector(hn),this._backdrop=null,this._isShown=!1,this._isBodyOverflowing=!1,this._ignoreBackdropClick=!1,this._isTransitioning=!1,this._scrollbarWidth=0}var t=o.prototype;return t.toggle=function(t){return this._isShown?this.hide():this.show(t)},t.show=function(t){var e=this;if(!this._isShown&&!this._isTransitioning){p(this._element).hasClass(ln)&&(this._isTransitioning=!0);var n=p.Event(nn.SHOW,{relatedTarget:t});p(this._element).trigger(n),this._isShown||n.isDefaultPrevented()||(this._isShown=!0,this._checkScrollbar(),this._setScrollbar(),this._adjustDialog(),this._setEscapeEvent(),this._setResizeEvent(),p(this._element).on(nn.CLICK_DISMISS,dn,function(t){return e.hide(t)}),p(this._dialog).on(nn.MOUSEDOWN_DISMISS,function(){p(e._element).one(nn.MOUSEUP_DISMISS,function(t){p(t.target).is(e._element)&&(e._ignoreBackdropClick=!0)})}),this._showBackdrop(function(){return e._showElement(t)}))}},t.hide=function(t){var e=this;if(t&&t.preventDefault(),this._isShown&&!this._isTransitioning){var n=p.Event(nn.HIDE);if(p(this._element).trigger(n),this._isShown&&!n.isDefaultPrevented()){this._isShown=!1;var i=p(this._element).hasClass(ln);if(i&&(this._isTransitioning=!0),this._setEscapeEvent(),this._setResizeEvent(),p(document).off(nn.FOCUSIN),p(this._element).removeClass(cn),p(this._element).off(nn.CLICK_DISMISS),p(this._dialog).off(nn.MOUSEDOWN_DISMISS),i){var o=m.getTransitionDurationFromElement(this._element);p(this._element).one(m.TRANSITION_END,function(t){return e._hideModal(t)}).emulateTransitionEnd(o)}else this._hideModal()}}},t.dispose=function(){[window,this._element,this._dialog].forEach(function(t){return p(t).off(Je)}),p(document).off(nn.FOCUSIN),p.removeData(this._element,$e),this._config=null,this._element=null,this._dialog=null,this._backdrop=null,this._isShown=null,this._isBodyOverflowing=null,this._ignoreBackdropClick=null,this._isTransitioning=null,this._scrollbarWidth=null},t.handleUpdate=function(){this._adjustDialog()},t._getConfig=function(t){return t=l({},tn,t),m.typeCheckConfig(Ge,t,en),t},t._showElement=function(t){var e=this,n=p(this._element).hasClass(ln);this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE||document.body.appendChild(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),p(this._dialog).hasClass(on)?this._dialog.querySelector(un).scrollTop=0:this._element.scrollTop=0,n&&m.reflow(this._element),p(this._element).addClass(cn),this._config.focus&&this._enforceFocus();var i=p.Event(nn.SHOWN,{relatedTarget:t}),o=function(){e._config.focus&&e._element.focus(),e._isTransitioning=!1,p(e._element).trigger(i)};if(n){var r=m.getTransitionDurationFromElement(this._dialog);p(this._dialog).one(m.TRANSITION_END,o).emulateTransitionEnd(r)}else o()},t._enforceFocus=function(){var e=this;p(document).off(nn.FOCUSIN).on(nn.FOCUSIN,function(t){document!==t.target&&e._element!==t.target&&0===p(e._element).has(t.target).length&&e._element.focus()})},t._setEscapeEvent=function(){var e=this;this._isShown&&this._config.keyboard?p(this._element).on(nn.KEYDOWN_DISMISS,function(t){27===t.which&&(t.preventDefault(),e.hide())}):this._isShown||p(this._element).off(nn.KEYDOWN_DISMISS)},t._setResizeEvent=function(){var e=this;this._isShown?p(window).on(nn.RESIZE,function(t){return e.handleUpdate(t)}):p(window).off(nn.RESIZE)},t._hideModal=function(){var t=this;this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._isTransitioning=!1,this._showBackdrop(function(){p(document.body).removeClass(an),t._resetAdjustments(),t._resetScrollbar(),p(t._element).trigger(nn.HIDDEN)})},t._removeBackdrop=function(){this._backdrop&&(p(this._backdrop).remove(),this._backdrop=null)},t._showBackdrop=function(t){var e=this,n=p(this._element).hasClass(ln)?ln:"";if(this._isShown&&this._config.backdrop){if(this._backdrop=document.createElement("div"),this._backdrop.className=sn,n&&this._backdrop.classList.add(n),p(this._backdrop).appendTo(document.body),p(this._element).on(nn.CLICK_DISMISS,function(t){e._ignoreBackdropClick?e._ignoreBackdropClick=!1:t.target===t.currentTarget&&("static"===e._config.backdrop?e._element.focus():e.hide())}),n&&m.reflow(this._backdrop),p(this._backdrop).addClass(cn),!t)return;if(!n)return void t();var i=m.getTransitionDurationFromElement(this._backdrop);p(this._backdrop).one(m.TRANSITION_END,t).emulateTransitionEnd(i)}else if(!this._isShown&&this._backdrop){p(this._backdrop).removeClass(cn);var o=function(){e._removeBackdrop(),t&&t()};if(p(this._element).hasClass(ln)){var r=m.getTransitionDurationFromElement(this._backdrop);p(this._backdrop).one(m.TRANSITION_END,o).emulateTransitionEnd(r)}else o()}else t&&t()},t._adjustDialog=function(){var t=this._element.scrollHeight>document.documentElement.clientHeight;!this._isBodyOverflowing&&t&&(this._element.style.paddingLeft=this._scrollbarWidth+"px"),this._isBodyOverflowing&&!t&&(this._element.style.paddingRight=this._scrollbarWidth+"px")},t._resetAdjustments=function(){this._element.style.paddingLeft="",this._element.style.paddingRight=""},t._checkScrollbar=function(){var t=document.body.getBoundingClientRect();this._isBodyOverflowing=t.left+t.right<window.innerWidth,this._scrollbarWidth=this._getScrollbarWidth()},t._setScrollbar=function(){var o=this;if(this._isBodyOverflowing){var t=[].slice.call(document.querySelectorAll(pn)),e=[].slice.call(document.querySelectorAll(mn));p(t).each(function(t,e){var n=e.style.paddingRight,i=p(e).css("padding-right");p(e).data("padding-right",n).css("padding-right",parseFloat(i)+o._scrollbarWidth+"px")}),p(e).each(function(t,e){var n=e.style.marginRight,i=p(e).css("margin-right");p(e).data("margin-right",n).css("margin-right",parseFloat(i)-o._scrollbarWidth+"px")});var n=document.body.style.paddingRight,i=p(document.body).css("padding-right");p(document.body).data("padding-right",n).css("padding-right",parseFloat(i)+this._scrollbarWidth+"px")}p(document.body).addClass(an)},t._resetScrollbar=function(){var t=[].slice.call(document.querySelectorAll(pn));p(t).each(function(t,e){var n=p(e).data("padding-right");p(e).removeData("padding-right"),e.style.paddingRight=n||""});var e=[].slice.call(document.querySelectorAll(""+mn));p(e).each(function(t,e){var n=p(e).data("margin-right");"undefined"!=typeof n&&p(e).css("margin-right",n).removeData("margin-right")});var n=p(document.body).data("padding-right");p(document.body).removeData("padding-right"),document.body.style.paddingRight=n||""},t._getScrollbarWidth=function(){var t=document.createElement("div");t.className=rn,document.body.appendChild(t);var e=t.getBoundingClientRect().width-t.clientWidth;return document.body.removeChild(t),e},o._jQueryInterface=function(n,i){return this.each(function(){var t=p(this).data($e),e=l({},tn,p(this).data(),"object"==typeof n&&n?n:{});if(t||(t=new o(this,e),p(this).data($e,t)),"string"==typeof n){if("undefined"==typeof t[n])throw new TypeError('No method named "'+n+'"');t[n](i)}else e.show&&t.show(i)})},s(o,null,[{key:"VERSION",get:function(){return"4.3.1"}},{key:"Default",get:function(){return tn}}]),o}();p(document).on(nn.CLICK_DATA_API,fn,function(t){var e,n=this,i=m.getSelectorFromElement(this);i&&(e=document.querySelector(i));var o=p(e).data($e)?"toggle":l({},p(e).data(),p(this).data());"A"!==this.tagName&&"AREA"!==this.tagName||t.preventDefault();var r=p(e).one(nn.SHOW,function(t){t.isDefaultPrevented()||r.one(nn.HIDDEN,function(){p(n).is(":visible")&&n.focus()})});gn._jQueryInterface.call(p(e),o,this)}),p.fn[Ge]=gn._jQueryInterface,p.fn[Ge].Constructor=gn,p.fn[Ge].noConflict=function(){return p.fn[Ge]=Ze,gn._jQueryInterface};var _n=["background","cite","href","itemtype","longdesc","poster","src","xlink:href"],vn={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},yn=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,En=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+/]+=*$/i;function bn(t,s,e){if(0===t.length)return t;if(e&&"function"==typeof e)return e(t);for(var n=(new window.DOMParser).parseFromString(t,"text/html"),a=Object.keys(s),l=[].slice.call(n.body.querySelectorAll("*")),i=function(t,e){var n=l[t],i=n.nodeName.toLowerCase();if(-1===a.indexOf(n.nodeName.toLowerCase()))return n.parentNode.removeChild(n),"continue";var o=[].slice.call(n.attributes),r=[].concat(s["*"]||[],s[i]||[]);o.forEach(function(t){(function(t,e){var n=t.nodeName.toLowerCase();if(-1!==e.indexOf(n))return-1===_n.indexOf(n)||Boolean(t.nodeValue.match(yn)||t.nodeValue.match(En));for(var i=e.filter(function(t){return t instanceof RegExp}),o=0,r=i.length;o<r;o++)if(n.match(i[o]))return!0;return!1})(t,r)||n.removeAttribute(t.nodeName)})},o=0,r=l.length;o<r;o++)i(o);return n.body.innerHTML}var wn="tooltip",Cn="bs.tooltip",Tn="."+Cn,Sn=p.fn[wn],Dn="bs-tooltip",In=new RegExp("(^|\\s)"+Dn+"\\S+","g"),An=["sanitize","whiteList","sanitizeFn"],On={animation:"boolean",template:"string",title:"(string|element|function)",trigger:"string",delay:"(number|object)",html:"boolean",selector:"(string|boolean)",placement:"(string|function)",offset:"(number|string|function)",container:"(string|element|boolean)",fallbackPlacement:"(string|array)",boundary:"(string|element)",sanitize:"boolean",sanitizeFn:"(null|function)",whiteList:"object"},Nn={AUTO:"auto",TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"},kn={animation:!0,template:'<div class="tooltip" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,selector:!1,placement:"top",offset:0,container:!1,fallbackPlacement:"flip",boundary:"scrollParent",sanitize:!0,sanitizeFn:null,whiteList:vn},Ln="show",xn="out",Pn={HIDE:"hide"+Tn,HIDDEN:"hidden"+Tn,SHOW:"show"+Tn,SHOWN:"shown"+Tn,INSERTED:"inserted"+Tn,CLICK:"click"+Tn,FOCUSIN:"focusin"+Tn,FOCUSOUT:"focusout"+Tn,MOUSEENTER:"mouseenter"+Tn,MOUSELEAVE:"mouseleave"+Tn},Hn="fade",jn="show",Rn=".tooltip-inner",Fn=".arrow",Mn="hover",Wn="focus",Un="click",Bn="manual",qn=function(){function i(t,e){if("undefined"==typeof be)throw new TypeError("Bootstrap's tooltips require Popper.js (https://popper.js.org/)");this._isEnabled=!0,this._timeout=0,this._hoverState="",this._activeTrigger={},this._popper=null,this.element=t,this.config=this._getConfig(e),this.tip=null,this._setListeners()}var t=i.prototype;return t.enable=function(){this._isEnabled=!0},t.disable=function(){this._isEnabled=!1},t.toggleEnabled=function(){this._isEnabled=!this._isEnabled},t.toggle=function(t){if(this._isEnabled)if(t){var e=this.constructor.DATA_KEY,n=p(t.currentTarget).data(e);n||(n=new this.constructor(t.currentTarget,this._getDelegateConfig()),p(t.currentTarget).data(e,n)),n._activeTrigger.click=!n._activeTrigger.click,n._isWithActiveTrigger()?n._enter(null,n):n._leave(null,n)}else{if(p(this.getTipElement()).hasClass(jn))return void this._leave(null,this);this._enter(null,this)}},t.dispose=function(){clearTimeout(this._timeout),p.removeData(this.element,this.constructor.DATA_KEY),p(this.element).off(this.constructor.EVENT_KEY),p(this.element).closest(".modal").off("hide.bs.modal"),this.tip&&p(this.tip).remove(),this._isEnabled=null,this._timeout=null,this._hoverState=null,(this._activeTrigger=null)!==this._popper&&this._popper.destroy(),this._popper=null,this.element=null,this.config=null,this.tip=null},t.show=function(){var e=this;if("none"===p(this.element).css("display"))throw new Error("Please use show on visible elements");var t=p.Event(this.constructor.Event.SHOW);if(this.isWithContent()&&this._isEnabled){p(this.element).trigger(t);var n=m.findShadowRoot(this.element),i=p.contains(null!==n?n:this.element.ownerDocument.documentElement,this.element);if(t.isDefaultPrevented()||!i)return;var o=this.getTipElement(),r=m.getUID(this.constructor.NAME);o.setAttribute("id",r),this.element.setAttribute("aria-describedby",r),this.setContent(),this.config.animation&&p(o).addClass(Hn);var s="function"==typeof this.config.placement?this.config.placement.call(this,o,this.element):this.config.placement,a=this._getAttachment(s);this.addAttachmentClass(a);var l=this._getContainer();p(o).data(this.constructor.DATA_KEY,this),p.contains(this.element.ownerDocument.documentElement,this.tip)||p(o).appendTo(l),p(this.element).trigger(this.constructor.Event.INSERTED),this._popper=new be(this.element,o,{placement:a,modifiers:{offset:this._getOffset(),flip:{behavior:this.config.fallbackPlacement},arrow:{element:Fn},preventOverflow:{boundariesElement:this.config.boundary}},onCreate:function(t){t.originalPlacement!==t.placement&&e._handlePopperPlacementChange(t)},onUpdate:function(t){return e._handlePopperPlacementChange(t)}}),p(o).addClass(jn),"ontouchstart"in document.documentElement&&p(document.body).children().on("mouseover",null,p.noop);var c=function(){e.config.animation&&e._fixTransition();var t=e._hoverState;e._hoverState=null,p(e.element).trigger(e.constructor.Event.SHOWN),t===xn&&e._leave(null,e)};if(p(this.tip).hasClass(Hn)){var h=m.getTransitionDurationFromElement(this.tip);p(this.tip).one(m.TRANSITION_END,c).emulateTransitionEnd(h)}else c()}},t.hide=function(t){var e=this,n=this.getTipElement(),i=p.Event(this.constructor.Event.HIDE),o=function(){e._hoverState!==Ln&&n.parentNode&&n.parentNode.removeChild(n),e._cleanTipClass(),e.element.removeAttribute("aria-describedby"),p(e.element).trigger(e.constructor.Event.HIDDEN),null!==e._popper&&e._popper.destroy(),t&&t()};if(p(this.element).trigger(i),!i.isDefaultPrevented()){if(p(n).removeClass(jn),"ontouchstart"in document.documentElement&&p(document.body).children().off("mouseover",null,p.noop),this._activeTrigger[Un]=!1,this._activeTrigger[Wn]=!1,this._activeTrigger[Mn]=!1,p(this.tip).hasClass(Hn)){var r=m.getTransitionDurationFromElement(n);p(n).one(m.TRANSITION_END,o).emulateTransitionEnd(r)}else o();this._hoverState=""}},t.update=function(){null!==this._popper&&this._popper.scheduleUpdate()},t.isWithContent=function(){return Boolean(this.getTitle())},t.addAttachmentClass=function(t){p(this.getTipElement()).addClass(Dn+"-"+t)},t.getTipElement=function(){return this.tip=this.tip||p(this.config.template)[0],this.tip},t.setContent=function(){var t=this.getTipElement();this.setElementContent(p(t.querySelectorAll(Rn)),this.getTitle()),p(t).removeClass(Hn+" "+jn)},t.setElementContent=function(t,e){"object"!=typeof e||!e.nodeType&&!e.jquery?this.config.html?(this.config.sanitize&&(e=bn(e,this.config.whiteList,this.config.sanitizeFn)),t.html(e)):t.text(e):this.config.html?p(e).parent().is(t)||t.empty().append(e):t.text(p(e).text())},t.getTitle=function(){var t=this.element.getAttribute("data-original-title");return t||(t="function"==typeof this.config.title?this.config.title.call(this.element):this.config.title),t},t._getOffset=function(){var e=this,t={};return"function"==typeof this.config.offset?t.fn=function(t){return t.offsets=l({},t.offsets,e.config.offset(t.offsets,e.element)||{}),t}:t.offset=this.config.offset,t},t._getContainer=function(){return!1===this.config.container?document.body:m.isElement(this.config.container)?p(this.config.container):p(document).find(this.config.container)},t._getAttachment=function(t){return Nn[t.toUpperCase()]},t._setListeners=function(){var i=this;this.config.trigger.split(" ").forEach(function(t){if("click"===t)p(i.element).on(i.constructor.Event.CLICK,i.config.selector,function(t){return i.toggle(t)});else if(t!==Bn){var e=t===Mn?i.constructor.Event.MOUSEENTER:i.constructor.Event.FOCUSIN,n=t===Mn?i.constructor.Event.MOUSELEAVE:i.constructor.Event.FOCUSOUT;p(i.element).on(e,i.config.selector,function(t){return i._enter(t)}).on(n,i.config.selector,function(t){return i._leave(t)})}}),p(this.element).closest(".modal").on("hide.bs.modal",function(){i.element&&i.hide()}),this.config.selector?this.config=l({},this.config,{trigger:"manual",selector:""}):this._fixTitle()},t._fixTitle=function(){var t=typeof this.element.getAttribute("data-original-title");(this.element.getAttribute("title")||"string"!==t)&&(this.element.setAttribute("data-original-title",this.element.getAttribute("title")||""),this.element.setAttribute("title",""))},t._enter=function(t,e){var n=this.constructor.DATA_KEY;(e=e||p(t.currentTarget).data(n))||(e=new this.constructor(t.currentTarget,this._getDelegateConfig()),p(t.currentTarget).data(n,e)),t&&(e._activeTrigger["focusin"===t.type?Wn:Mn]=!0),p(e.getTipElement()).hasClass(jn)||e._hoverState===Ln?e._hoverState=Ln:(clearTimeout(e._timeout),e._hoverState=Ln,e.config.delay&&e.config.delay.show?e._timeout=setTimeout(function(){e._hoverState===Ln&&e.show()},e.config.delay.show):e.show())},t._leave=function(t,e){var n=this.constructor.DATA_KEY;(e=e||p(t.currentTarget).data(n))||(e=new this.constructor(t.currentTarget,this._getDelegateConfig()),p(t.currentTarget).data(n,e)),t&&(e._activeTrigger["focusout"===t.type?Wn:Mn]=!1),e._isWithActiveTrigger()||(clearTimeout(e._timeout),e._hoverState=xn,e.config.delay&&e.config.delay.hide?e._timeout=setTimeout(function(){e._hoverState===xn&&e.hide()},e.config.delay.hide):e.hide())},t._isWithActiveTrigger=function(){for(var t in this._activeTrigger)if(this._activeTrigger[t])return!0;return!1},t._getConfig=function(t){var e=p(this.element).data();return Object.keys(e).forEach(function(t){-1!==An.indexOf(t)&&delete e[t]}),"number"==typeof(t=l({},this.constructor.Default,e,"object"==typeof t&&t?t:{})).delay&&(t.delay={show:t.delay,hide:t.delay}),"number"==typeof t.title&&(t.title=t.title.toString()),"number"==typeof t.content&&(t.content=t.content.toString()),m.typeCheckConfig(wn,t,this.constructor.DefaultType),t.sanitize&&(t.template=bn(t.template,t.whiteList,t.sanitizeFn)),t},t._getDelegateConfig=function(){var t={};if(this.config)for(var e in this.config)this.constructor.Default[e]!==this.config[e]&&(t[e]=this.config[e]);return t},t._cleanTipClass=function(){var t=p(this.getTipElement()),e=t.attr("class").match(In);null!==e&&e.length&&t.removeClass(e.join(""))},t._handlePopperPlacementChange=function(t){var e=t.instance;this.tip=e.popper,this._cleanTipClass(),this.addAttachmentClass(this._getAttachment(t.placement))},t._fixTransition=function(){var t=this.getTipElement(),e=this.config.animation;null===t.getAttribute("x-placement")&&(p(t).removeClass(Hn),this.config.animation=!1,this.hide(),this.show(),this.config.animation=e)},i._jQueryInterface=function(n){return this.each(function(){var t=p(this).data(Cn),e="object"==typeof n&&n;if((t||!/dispose|hide/.test(n))&&(t||(t=new i(this,e),p(this).data(Cn,t)),"string"==typeof n)){if("undefined"==typeof t[n])throw new TypeError('No method named "'+n+'"');t[n]()}})},s(i,null,[{key:"VERSION",get:function(){return"4.3.1"}},{key:"Default",get:function(){return kn}},{key:"NAME",get:function(){return wn}},{key:"DATA_KEY",get:function(){return Cn}},{key:"Event",get:function(){return Pn}},{key:"EVENT_KEY",get:function(){return Tn}},{key:"DefaultType",get:function(){return On}}]),i}();p.fn[wn]=qn._jQueryInterface,p.fn[wn].Constructor=qn,p.fn[wn].noConflict=function(){return p.fn[wn]=Sn,qn._jQueryInterface};var Kn="popover",Qn="bs.popover",Vn="."+Qn,Yn=p.fn[Kn],zn="bs-popover",Xn=new RegExp("(^|\\s)"+zn+"\\S+","g"),Gn=l({},qn.Default,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'}),$n=l({},qn.DefaultType,{content:"(string|element|function)"}),Jn="fade",Zn="show",ti=".popover-header",ei=".popover-body",ni={HIDE:"hide"+Vn,HIDDEN:"hidden"+Vn,SHOW:"show"+Vn,SHOWN:"shown"+Vn,INSERTED:"inserted"+Vn,CLICK:"click"+Vn,FOCUSIN:"focusin"+Vn,FOCUSOUT:"focusout"+Vn,MOUSEENTER:"mouseenter"+Vn,MOUSELEAVE:"mouseleave"+Vn},ii=function(t){var e,n;function i(){return t.apply(this,arguments)||this}n=t,(e=i).prototype=Object.create(n.prototype),(e.prototype.constructor=e).__proto__=n;var o=i.prototype;return o.isWithContent=function(){return this.getTitle()||this._getContent()},o.addAttachmentClass=function(t){p(this.getTipElement()).addClass(zn+"-"+t)},o.getTipElement=function(){return this.tip=this.tip||p(this.config.template)[0],this.tip},o.setContent=function(){var t=p(this.getTipElement());this.setElementContent(t.find(ti),this.getTitle());var e=this._getContent();"function"==typeof e&&(e=e.call(this.element)),this.setElementContent(t.find(ei),e),t.removeClass(Jn+" "+Zn)},o._getContent=function(){return this.element.getAttribute("data-content")||this.config.content},o._cleanTipClass=function(){var t=p(this.getTipElement()),e=t.attr("class").match(Xn);null!==e&&0<e.length&&t.removeClass(e.join(""))},i._jQueryInterface=function(n){return this.each(function(){var t=p(this).data(Qn),e="object"==typeof n?n:null;if((t||!/dispose|hide/.test(n))&&(t||(t=new i(this,e),p(this).data(Qn,t)),"string"==typeof n)){if("undefined"==typeof t[n])throw new TypeError('No method named "'+n+'"');t[n]()}})},s(i,null,[{key:"VERSION",get:function(){return"4.3.1"}},{key:"Default",get:function(){return Gn}},{key:"NAME",get:function(){return Kn}},{key:"DATA_KEY",get:function(){return Qn}},{key:"Event",get:function(){return ni}},{key:"EVENT_KEY",get:function(){return Vn}},{key:"DefaultType",get:function(){return $n}}]),i}(qn);p.fn[Kn]=ii._jQueryInterface,p.fn[Kn].Constructor=ii,p.fn[Kn].noConflict=function(){return p.fn[Kn]=Yn,ii._jQueryInterface};var oi="scrollspy",ri="bs.scrollspy",si="."+ri,ai=p.fn[oi],li={offset:10,method:"auto",target:""},ci={offset:"number",method:"string",target:"(string|element)"},hi={ACTIVATE:"activate"+si,SCROLL:"scroll"+si,LOAD_DATA_API:"load"+si+".data-api"},ui="dropdown-item",fi="active",di='[data-spy="scroll"]',pi=".nav, .list-group",mi=".nav-link",gi=".nav-item",_i=".list-group-item",vi=".dropdown",yi=".dropdown-item",Ei=".dropdown-toggle",bi="offset",wi="position",Ci=function(){function n(t,e){var n=this;this._element=t,this._scrollElement="BODY"===t.tagName?window:t,this._config=this._getConfig(e),this._selector=this._config.target+" "+mi+","+this._config.target+" "+_i+","+this._config.target+" "+yi,this._offsets=[],this._targets=[],this._activeTarget=null,this._scrollHeight=0,p(this._scrollElement).on(hi.SCROLL,function(t){return n._process(t)}),this.refresh(),this._process()}var t=n.prototype;return t.refresh=function(){var e=this,t=this._scrollElement===this._scrollElement.window?bi:wi,o="auto"===this._config.method?t:this._config.method,r=o===wi?this._getScrollTop():0;this._offsets=[],this._targets=[],this._scrollHeight=this._getScrollHeight(),[].slice.call(document.querySelectorAll(this._selector)).map(function(t){var e,n=m.getSelectorFromElement(t);if(n&&(e=document.querySelector(n)),e){var i=e.getBoundingClientRect();if(i.width||i.height)return[p(e)[o]().top+r,n]}return null}).filter(function(t){return t}).sort(function(t,e){return t[0]-e[0]}).forEach(function(t){e._offsets.push(t[0]),e._targets.push(t[1])})},t.dispose=function(){p.removeData(this._element,ri),p(this._scrollElement).off(si),this._element=null,this._scrollElement=null,this._config=null,this._selector=null,this._offsets=null,this._targets=null,this._activeTarget=null,this._scrollHeight=null},t._getConfig=function(t){if("string"!=typeof(t=l({},li,"object"==typeof t&&t?t:{})).target){var e=p(t.target).attr("id");e||(e=m.getUID(oi),p(t.target).attr("id",e)),t.target="#"+e}return m.typeCheckConfig(oi,t,ci),t},t._getScrollTop=function(){return this._scrollElement===window?this._scrollElement.pageYOffset:this._scrollElement.scrollTop},t._getScrollHeight=function(){return this._scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)},t._getOffsetHeight=function(){return this._scrollElement===window?window.innerHeight:this._scrollElement.getBoundingClientRect().height},t._process=function(){var t=this._getScrollTop()+this._config.offset,e=this._getScrollHeight(),n=this._config.offset+e-this._getOffsetHeight();if(this._scrollHeight!==e&&this.refresh(),n<=t){var i=this._targets[this._targets.length-1];this._activeTarget!==i&&this._activate(i)}else{if(this._activeTarget&&t<this._offsets[0]&&0<this._offsets[0])return this._activeTarget=null,void this._clear();for(var o=this._offsets.length;o--;){this._activeTarget!==this._targets[o]&&t>=this._offsets[o]&&("undefined"==typeof this._offsets[o+1]||t<this._offsets[o+1])&&this._activate(this._targets[o])}}},t._activate=function(e){this._activeTarget=e,this._clear();var t=this._selector.split(",").map(function(t){return t+'[data-target="'+e+'"],'+t+'[href="'+e+'"]'}),n=p([].slice.call(document.querySelectorAll(t.join(","))));n.hasClass(ui)?(n.closest(vi).find(Ei).addClass(fi),n.addClass(fi)):(n.addClass(fi),n.parents(pi).prev(mi+", "+_i).addClass(fi),n.parents(pi).prev(gi).children(mi).addClass(fi)),p(this._scrollElement).trigger(hi.ACTIVATE,{relatedTarget:e})},t._clear=function(){[].slice.call(document.querySelectorAll(this._selector)).filter(function(t){return t.classList.contains(fi)}).forEach(function(t){return t.classList.remove(fi)})},n._jQueryInterface=function(e){return this.each(function(){var t=p(this).data(ri);if(t||(t=new n(this,"object"==typeof e&&e),p(this).data(ri,t)),"string"==typeof e){if("undefined"==typeof t[e])throw new TypeError('No method named "'+e+'"');t[e]()}})},s(n,null,[{key:"VERSION",get:function(){return"4.3.1"}},{key:"Default",get:function(){return li}}]),n}();p(window).on(hi.LOAD_DATA_API,function(){for(var t=[].slice.call(document.querySelectorAll(di)),e=t.length;e--;){var n=p(t[e]);Ci._jQueryInterface.call(n,n.data())}}),p.fn[oi]=Ci._jQueryInterface,p.fn[oi].Constructor=Ci,p.fn[oi].noConflict=function(){return p.fn[oi]=ai,Ci._jQueryInterface};var Ti="bs.tab",Si="."+Ti,Di=p.fn.tab,Ii={HIDE:"hide"+Si,HIDDEN:"hidden"+Si,SHOW:"show"+Si,SHOWN:"shown"+Si,CLICK_DATA_API:"click"+Si+".data-api"},Ai="dropdown-menu",Oi="active",Ni="disabled",ki="fade",Li="show",xi=".dropdown",Pi=".nav, .list-group",Hi=".active",ji="> li > .active",Ri='[data-toggle="tab"], [data-toggle="pill"], [data-toggle="list"]',Fi=".dropdown-toggle",Mi="> .dropdown-menu .active",Wi=function(){function i(t){this._element=t}var t=i.prototype;return t.show=function(){var n=this;if(!(this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE&&p(this._element).hasClass(Oi)||p(this._element).hasClass(Ni))){var t,i,e=p(this._element).closest(Pi)[0],o=m.getSelectorFromElement(this._element);if(e){var r="UL"===e.nodeName||"OL"===e.nodeName?ji:Hi;i=(i=p.makeArray(p(e).find(r)))[i.length-1]}var s=p.Event(Ii.HIDE,{relatedTarget:this._element}),a=p.Event(Ii.SHOW,{relatedTarget:i});if(i&&p(i).trigger(s),p(this._element).trigger(a),!a.isDefaultPrevented()&&!s.isDefaultPrevented()){o&&(t=document.querySelector(o)),this._activate(this._element,e);var l=function(){var t=p.Event(Ii.HIDDEN,{relatedTarget:n._element}),e=p.Event(Ii.SHOWN,{relatedTarget:i});p(i).trigger(t),p(n._element).trigger(e)};t?this._activate(t,t.parentNode,l):l()}}},t.dispose=function(){p.removeData(this._element,Ti),this._element=null},t._activate=function(t,e,n){var i=this,o=(!e||"UL"!==e.nodeName&&"OL"!==e.nodeName?p(e).children(Hi):p(e).find(ji))[0],r=n&&o&&p(o).hasClass(ki),s=function(){return i._transitionComplete(t,o,n)};if(o&&r){var a=m.getTransitionDurationFromElement(o);p(o).removeClass(Li).one(m.TRANSITION_END,s).emulateTransitionEnd(a)}else s()},t._transitionComplete=function(t,e,n){if(e){p(e).removeClass(Oi);var i=p(e.parentNode).find(Mi)[0];i&&p(i).removeClass(Oi),"tab"===e.getAttribute("role")&&e.setAttribute("aria-selected",!1)}if(p(t).addClass(Oi),"tab"===t.getAttribute("role")&&t.setAttribute("aria-selected",!0),m.reflow(t),t.classList.contains(ki)&&t.classList.add(Li),t.parentNode&&p(t.parentNode).hasClass(Ai)){var o=p(t).closest(xi)[0];if(o){var r=[].slice.call(o.querySelectorAll(Fi));p(r).addClass(Oi)}t.setAttribute("aria-expanded",!0)}n&&n()},i._jQueryInterface=function(n){return this.each(function(){var t=p(this),e=t.data(Ti);if(e||(e=new i(this),t.data(Ti,e)),"string"==typeof n){if("undefined"==typeof e[n])throw new TypeError('No method named "'+n+'"');e[n]()}})},s(i,null,[{key:"VERSION",get:function(){return"4.3.1"}}]),i}();p(document).on(Ii.CLICK_DATA_API,Ri,function(t){t.preventDefault(),Wi._jQueryInterface.call(p(this),"show")}),p.fn.tab=Wi._jQueryInterface,p.fn.tab.Constructor=Wi,p.fn.tab.noConflict=function(){return p.fn.tab=Di,Wi._jQueryInterface};var Ui="toast",Bi="bs.toast",qi="."+Bi,Ki=p.fn[Ui],Qi={CLICK_DISMISS:"click.dismiss"+qi,HIDE:"hide"+qi,HIDDEN:"hidden"+qi,SHOW:"show"+qi,SHOWN:"shown"+qi},Vi="fade",Yi="hide",zi="show",Xi="showing",Gi={animation:"boolean",autohide:"boolean",delay:"number"},$i={animation:!0,autohide:!0,delay:500},Ji='[data-dismiss="toast"]',Zi=function(){function i(t,e){this._element=t,this._config=this._getConfig(e),this._timeout=null,this._setListeners()}var t=i.prototype;return t.show=function(){var t=this;p(this._element).trigger(Qi.SHOW),this._config.animation&&this._element.classList.add(Vi);var e=function(){t._element.classList.remove(Xi),t._element.classList.add(zi),p(t._element).trigger(Qi.SHOWN),t._config.autohide&&t.hide()};if(this._element.classList.remove(Yi),this._element.classList.add(Xi),this._config.animation){var n=m.getTransitionDurationFromElement(this._element);p(this._element).one(m.TRANSITION_END,e).emulateTransitionEnd(n)}else e()},t.hide=function(t){var e=this;this._element.classList.contains(zi)&&(p(this._element).trigger(Qi.HIDE),t?this._close():this._timeout=setTimeout(function(){e._close()},this._config.delay))},t.dispose=function(){clearTimeout(this._timeout),this._timeout=null,this._element.classList.contains(zi)&&this._element.classList.remove(zi),p(this._element).off(Qi.CLICK_DISMISS),p.removeData(this._element,Bi),this._element=null,this._config=null},t._getConfig=function(t){return t=l({},$i,p(this._element).data(),"object"==typeof t&&t?t:{}),m.typeCheckConfig(Ui,t,this.constructor.DefaultType),t},t._setListeners=function(){var t=this;p(this._element).on(Qi.CLICK_DISMISS,Ji,function(){return t.hide(!0)})},t._close=function(){var t=this,e=function(){t._element.classList.add(Yi),p(t._element).trigger(Qi.HIDDEN)};if(this._element.classList.remove(zi),this._config.animation){var n=m.getTransitionDurationFromElement(this._element);p(this._element).one(m.TRANSITION_END,e).emulateTransitionEnd(n)}else e()},i._jQueryInterface=function(n){return this.each(function(){var t=p(this),e=t.data(Bi);if(e||(e=new i(this,"object"==typeof n&&n),t.data(Bi,e)),"string"==typeof n){if("undefined"==typeof e[n])throw new TypeError('No method named "'+n+'"');e[n](this)}})},s(i,null,[{key:"VERSION",get:function(){return"4.3.1"}},{key:"DefaultType",get:function(){return Gi}},{key:"Default",get:function(){return $i}}]),i}();p.fn[Ui]=Zi._jQueryInterface,p.fn[Ui].Constructor=Zi,p.fn[Ui].noConflict=function(){return p.fn[Ui]=Ki,Zi._jQueryInterface},function(){if("undefined"==typeof p)throw new TypeError("Bootstrap's JavaScript requires jQuery. jQuery must be included before Bootstrap's JavaScript.");var t=p.fn.jquery.split(" ")[0].split(".");if(t[0]<2&&t[1]<9||1===t[0]&&9===t[1]&&t[2]<1||4<=t[0])throw new Error("Bootstrap's JavaScript requires at least jQuery v1.9.1 but less than v4.0.0")}(),t.Util=m,t.Alert=g,t.Button=k,t.Carousel=at,t.Collapse=Ct,t.Dropdown=Xe,t.Modal=gn,t.Popover=ii,t.Scrollspy=Ci,t.Tab=Wi,t.Toast=Zi,t.Tooltip=qn,Object.defineProperty(t,"__esModule",{value:!0})});
// В shareadHead шаблоне в js переменной Bc_tip_page_type назначается имя контроллера и экшена
// Пустые значения контроллера или экшена будут заменяться на index
// Для добавления новой подсказки tc.phtml шаблоне нужно создать div с классом: контроллер-экшен-tip-step

Bc.tip = {
	onload: function () {
		if ($('.' + Bc_tip_page_type + '-tip-step' + '.tip-step').length == 0) {
			$('.show-page-tip').hide();
		}
	},
	show: function (element) {
		$('.tip-block .tip-step').hide();
		$('.help-in-show').show();
		$('.helpers-view').css({"z-index":99999});
		$('.group-btn').css('zIndex', 99999);
		$('.group-btns, .more-maps.topper, .more-maps .worked-tender, .more-maps .inform-edit-block, .helps-visual .submit-block,  .helps-visual,  .helper-head, table.default.my-otchet td.status').addClass('helper-view');
		$('table.default.favorit tr.helpers-view').addClass('visible');
		$(' td.hide-for-print.helpers-view.chan').addClass('view');
		if ($(element + '.tip-step').length > 0) {
			$('.tip-block').show();
			$(element + '.tip-step').show();
			//$('body').css('overflow','hidden');
		} 
	},
	hide: function () {
		$('.tip-block').hide();
		$('.tip-block .tip-step').hide();
		$('.helpers-view').removeAttr('style');
		$('.group-btns, .more-maps.topper, .more-maps .worked-tender, .more-maps .inform-edit-block, .helps-visual .submit-block, .helps-visual, .helper-head, table.default.my-otchet td.status').removeClass('helper-view');
		$('table.default.favorit tr.helpers-view, table.default.my-otchet td.status').removeClass('visible');
		$(' td.hide-for-print.helpers-view.chan').removeClass('view');
		//$('body').css('overflow', 'visible');
		$('.help-in-show').hide();
	},
	showPageTip: function () {
		Bc.tip.show('.' + Bc_tip_page_type + '-tip-step');
	}
};

$(document).ready(function(){
	Bc.tip.onload();

	var $closeTipA = $('.tip-wrap, .close-tip-block-link');
	$closeTipA.click(function(){
		Bc.tip.hide();
	});

	$('.show-page-tip').click(function(){
		Bc.tip.showPageTip();
	});
});
function showHideBanner(){
	// console.log('showHideBanner');
	$('#banner-auto-funnel .banner-bico').slideToggle({
		duration: 'slow',
		easing: 'linear'
	});

	$('#banner-auto-funnel .banner-bico').toggleClass('status-hidden');

	if ($("#banner-auto-funnel .banner-bico").hasClass('status-hidden')) {
		Bc.Cookie.set('tcHideBanner', 1);
	} else {
		Bc.Cookie.set('tcHideBanner', 0);
	}

	 // console.log($(".funnel-bitrix24 .banner-bico").hasClass('status-hidden'));
}

$(document).ready(function() {
	// console.log('document ready');
	//  console.log($(".funnel-bitrix24 .banner-bico").hasClass('status-hidden'));
	$('.btn-banner').click(function () {
		showHideBanner();
	});
});
Bc.WidgetManager.define('tc/LayoutHorizontalScroll', {
	init: function ($elem, o) {
		let self = this;

		this.$scrollElements = $('[data-horizontal-scroll-block]');

		this.observeWidthChange($('#menu'));

		this.observeWidthChange($('#content'));

		$(window).resize(function() {
			self.setPositions();
		});

		let scrollLeft = 0;
		$(window).scroll(function() {
			let newScrollLeft = $(window).scrollLeft();
			if (scrollLeft != newScrollLeft) {
				scrollLeft = newScrollLeft;
				self.setPositions();
			}
		});

		self.setPositions();
	},

	observeWidthChange: function ($elem) {
		let self = this;
		$elem.data('observedWidth', $elem.width());
		new ResizeObserver(() => {
			let newWidth = $elem.width();
			if ($elem.data('observedWidth') !== newWidth) {
				$elem.data('observedWidth', newWidth);
				self.setPositions();
			}
		}).observe($elem.get(0));
	},

	setPositions: function () {
		let windowWidth = Math.ceil($(window).width());
		let documentWidth = Math.ceil($(document).width());
		if (Math.abs(windowWidth - documentWidth) <= 1) {
			this.$scrollElements.css({ width: '', left: '', position: '' });
			return;
		}

		let menuWidth = $('#menu').width();
		let scrollLeft = $(window).scrollLeft();
		let leftShift = Math.max(scrollLeft - menuWidth, 0);
		let menuViewedWidth = Math.max(menuWidth - scrollLeft, 0);
		let contentViewWidth = windowWidth - menuViewedWidth - 1;

		this.$scrollElements.css({
			width: contentViewWidth + 'px',
			left: leftShift + 'px',
			position: 'relative'
		});
	}
});
